library(dplyr)
library(Seurat)
library(patchwork)
library(ggplot2)
library(readr)
library(tidyr)
library(MAST)
library(readxl)
library(openxlsx)
library(enrichR)

data<- readRDS("Data/PSC_processed_march16_2021.rds")
DefaultAssay(data) = "RNA"

# Inflamed vs Non-Inflamed
library(enrichR)

DefaultAssay(data) = "RNA"

# general markers
Idents(data)<-"celltypes"
IplusNI_cellularmarkers<-FindAllMarkers(data,test.use = "MAST", only.pos = T )
write.csv(IplusNI_cellularmarkers, "Results/DE/IplusNI_cellularmarkers.csv")
Idents(data)<-"inflammation"
I_cellularmarkers<-FindAllMarkers(data,subset.ident = "I", group.by = "celltypes",test.use = "MAST", only.pos = T )
write.csv(I_cellularmarkers, "Results/DE/I_cellularmarkers.csv")
NI_cellularmarkers<-FindAllMarkers(data,subset.ident = "NI", group.by = "celltypes",test.use = "MAST", only.pos = T )
write.csv(NI_cellularmarkers, "Results/DE/NI_cellularmarkers.csv")
Idents(data)<-"state"
PSC_NI<-subset(data, ident = "PSC-NI")
UC_NI<-subset(data, ident="UC-NI")
HC_NI<-subset(data, ident="HC-NI")
Idents(PSC_NI)<-"celltypes"
Idents(UC_NI)<-"celltypes"
Idents(HC_NI)<-"celltypes"
PSCNI_cellularmarkers<-FindAllMarkers(PSC_NI, test.use = "MAST", only.pos = T )
write.csv(PSCNI_cellularmarkers, "Results/DE/PSCNI_cellularmarkers.csv")
UCNI_cellularmarkers<-FindAllMarkers(UC_NI,test.use = "MAST", only.pos = T )
write.csv(UCNI_cellularmarkers, "Results/DE/UCNI_cellularmarkers.csv")
HCNI_cellularmarkers<-FindAllMarkers(HC_NI,test.use = "MAST", only.pos = T )
write.csv(HCNI_cellularmarkers, "Results/DE/HCNI_cellularmarkers.csv")

#####
# epithelial markers
data@meta.data$cell_cat<-"other"

data@meta.data$cell_cat[data@meta.data$celltypes == "Immature_enterocyte"]<-"epithelial"
data@meta.data$cell_cat[data@meta.data$celltypes == "Cycling_TA"]<-"epithelial"
data@meta.data$cell_cat[data@meta.data$celltypes == "Absorptive_enterocyte"]<-"epithelial"
data@meta.data$cell_cat[data@meta.data$celltypes == "Ribo_TA"]<-"epithelial"
data@meta.data$cell_cat[data@meta.data$celltypes == "Stem"]<-"epithelial"

data@meta.data$cell_cat[data@meta.data$celltypes == "Immature_goblet"]<-"epithelial"
data@meta.data$cell_cat[data@meta.data$celltypes == "BEST4_enterocyte"]<-"epithelial"
data@meta.data$cell_cat[data@meta.data$celltypes == "DUOX2_enterocyte"]<-"epithelial"
data@meta.data$cell_cat[data@meta.data$celltypes == "PLCG2_TA"]<-"epithelial"
data@meta.data$cell_cat[data@meta.data$celltypes == "Absorptive_TA"]<-"epithelial"
data@meta.data$cell_cat[data@meta.data$celltypes == "Tuft"]<-"epithelial"
data@meta.data$cell_cat[data@meta.data$celltypes == "REG_TA"]<-"epithelial"
data@meta.data$cell_cat[data@meta.data$celltypes == "Enteroendocrine"]<-"epithelial"

data@meta.data$cell_cat[data@meta.data$celltypes == "Goblet"]<-"epithelial"

Idents(data)<-"cell_cat"
markers_epi_UCI_NI<-FindMarkers(data, subset.ident = "epithelial", group.by="state", test.use = "MAST", ident.1 = "UC-I", ident.2 = "UC-NI")
markers_epi_PSCI_NI<-FindMarkers(data, subset.ident = "epithelial", group.by="state", test.use = "MAST", ident.1 = "PSC-I", ident.2 = "PSC-NI")
markers_epi_UCNI_HC<-FindMarkers(data, subset.ident = "epithelial", group.by="state", test.use = "MAST", ident.1 = "UC-NI", ident.2 = "HC-NI")
markers_epi_PSCNI_HC<-FindMarkers(data, subset.ident = "epithelial", group.by="state", test.use = "MAST", ident.1 = "PSC-NI", ident.2 = "HC-NI")

write.csv(markers_epi_UCI_NI, "Results/DE/epithelium_ucI_vs_ucNI.csv")
write.csv(markers_epi_PSCI_NI, "Results/DE/epithelium_pscI_vs_pscNI.csv")
write.csv(markers_epi_UCNI_HC, "Results/DE/epithelium_ucNI_vs_HC.csv")
write.csv(markers_epi_PSCNI_HC, "Results/DE/epithelium_pscNI_vs_HC.csv")





# Inflamed vs Non-Inflamed
Idents(data) <- "inflammation"
Inflammation = FindAllMarkers(data, test.use = "MAST", only.pos = T)
Inflammation <- filter(Inflammation, Inflammation$p_val_adj < 0.05)
write.csv(Inflammation, "Results/DE/inflammation_markers.csv")

#############
Idents(data) <- "celltypes"
Inflammation_IgG <- FindMarkers(data, subset.ident = "IgG_plasma", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_IgG <- filter(Inflammation_IgG, Inflammation_IgG$p_val_adj < 0.05)
Inflammation_IgG$cluster = ifelse(Inflammation_IgG$avg_logFC > 0,"I","NI")
Inflammation_IgG$gene = rownames(Inflammation_IgG)
Iup_IgG = filter(Inflammation_IgG, Inflammation_IgG$cluster == "I")
NIup_IgG = filter(Inflammation_IgG, Inflammation_IgG$cluster == "NI")
write.csv(Iup_IgG, "Results/DE/Iup_IgG.csv")
write.csv(NIup_IgG, "Results/DE/NIup_IgG.csv")

Inflammation_Treg <- FindMarkers(data, subset.ident = "Treg", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_Treg <- filter(Inflammation_Treg, Inflammation_Treg$p_val_adj < 0.05)
Inflammation_Treg$cluster = ifelse(Inflammation_Treg$avg_logFC > 0,"I","NI")
Inflammation_Treg$gene = rownames(Inflammation_Treg)
Iup_Treg = filter(Inflammation_Treg, Inflammation_Treg$cluster == "I")
NIup_Treg = filter(Inflammation_Treg, Inflammation_Treg$cluster == "NI")
write.csv(Iup_Treg, "Results/DE/Iup_Treg.csv")
write.csv(NIup_Treg, "Results/DE/NIup_Treg.csv")

Inflammation_Immature_entero <- FindMarkers(data, subset.ident = "Immature_enterocyte", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_Immature_entero <- filter(Inflammation_Immature_entero, Inflammation_Immature_entero$p_val_adj < 0.05)
Inflammation_Immature_entero$cluster = ifelse(Inflammation_Immature_entero$avg_logFC > 0,"I","NI")
Inflammation_Immature_entero$gene = rownames(Inflammation_Immature_entero)
Iup_Immature_entero = filter(Inflammation_Immature_entero, Inflammation_Immature_entero$cluster == "I")
NIup_Immature_entero = filter(Inflammation_Immature_entero, Inflammation_Immature_entero$cluster == "NI")
write.csv(Iup_Immature_entero, "Results/DE/Iup_Immature_entero.csv")
write.csv(NIup_Immature_entero, "Results/DE/NIup_Immature_entero.csv")

Inflammation_abs_TA <- FindMarkers(data, subset.ident = "Absorptive_TA", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_abs_TA <- filter(Inflammation_abs_TA, Inflammation_abs_TA$p_val_adj < 0.05)
Inflammation_abs_TA$cluster = ifelse(Inflammation_abs_TA$avg_logFC > 0,"I","NI")
Inflammation_abs_TA$gene = rownames(Inflammation_abs_TA)
Iup_abs_TA = filter(Inflammation_abs_TA, Inflammation_abs_TA$cluster == "I")
NIup_abs_TA = filter(Inflammation_abs_TA, Inflammation_abs_TA$cluster == "NI")
write.csv(Iup_abs_TA, "Results/DE/Iup_abs_TA.csv")
write.csv(NIup_abs_TA, "Results/DE/NIup_abs_TA.csv")

Inflammation_Absorptive_enterocyte <- FindMarkers(data, subset.ident = "Absorptive_enterocyte", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_Absorptive_enterocyte <- filter(Inflammation_Absorptive_enterocyte, Inflammation_Absorptive_enterocyte$p_val_adj < 0.05)
Inflammation_Absorptive_enterocyte$cluster = ifelse(Inflammation_Absorptive_enterocyte$avg_logFC > 0,"I","NI")
Inflammation_Absorptive_enterocyte$gene = rownames(Inflammation_Absorptive_enterocyte)
Iup_Absorptive_enterocyte = filter(Inflammation_Absorptive_enterocyte, Inflammation_Absorptive_enterocyte$cluster == "I")
NIup_Absorptive_enterocyte = filter(Inflammation_Absorptive_enterocyte, Inflammation_Absorptive_enterocyte$cluster == "NI")
write.csv(Iup_Absorptive_enterocyte, "Results/DE/Iup_Absorptive_enterocyte.csv")
write.csv(NIup_Absorptive_enterocyte, "Results/DE/NIup_Absorptive_enterocyte.csv")

Inflammation_DUOX2_entero <- FindMarkers(data, subset.ident = "DUOX2_enterocyte", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_DUOX2_entero <- filter(Inflammation_DUOX2_entero, Inflammation_DUOX2_entero$p_val_adj < 0.05)
Inflammation_DUOX2_entero$cluster = ifelse(Inflammation_DUOX2_entero$avg_logFC > 0,"I","NI")
Inflammation_DUOX2_entero$gene = rownames(Inflammation_DUOX2_entero)
Iup_DUOX2_entero = filter(Inflammation_DUOX2_entero, Inflammation_DUOX2_entero$cluster == "I")
NIup_DUOX2_entero = filter(Inflammation_DUOX2_entero, Inflammation_DUOX2_entero$cluster == "NI")
write.csv(Iup_DUOX2_entero, "Results/DE/Iup_DUOX2_entero.csv")
write.csv(NIup_DUOX2_entero, "Results/DE/NIup_DUOX2_entero.csv")

Inflammation_Cycling_TA <- FindMarkers(data, subset.ident = "Cycling_TA", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_Cycling_TA <- filter(Inflammation_Cycling_TA, Inflammation_Cycling_TA$p_val_adj < 0.05)
Inflammation_Cycling_TA$cluster = ifelse(Inflammation_Cycling_TA$avg_logFC > 0,"I","NI")
Inflammation_Cycling_TA$gene = rownames(Inflammation_Cycling_TA)
Iup_Cycling_TA = filter(Inflammation_Cycling_TA, Inflammation_Cycling_TA$cluster == "I")
NIup_Cycling_TA = filter(Inflammation_Cycling_TA, Inflammation_Cycling_TA$cluster == "NI")
write.csv(Iup_Cycling_TA, "Results/DE/Iup_Cycling_TA.csv")
write.csv(NIup_Cycling_TA, "Results/DE/NIup_Cycling_TA.csv")

Inflammation_Cycling_B <- FindMarkers(data, subset.ident = "Cycling_B", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_Cycling_B <- filter(Inflammation_Cycling_B, Inflammation_Cycling_B$p_val_adj < 0.05)
Inflammation_Cycling_B$cluster = ifelse(Inflammation_Cycling_B$avg_logFC > 0,"I","NI")
Inflammation_Cycling_B$gene = rownames(Inflammation_Cycling_B)
Iup_Cycling_B = filter(Inflammation_Cycling_B, Inflammation_Cycling_B$cluster == "I")
NIup_Cycling_B = filter(Inflammation_Cycling_B, Inflammation_Cycling_B$cluster == "NI")
write.csv(Iup_Cycling_B, "Results/DE/Iup_Cycling_B.csv")
write.csv(NIup_Cycling_B, "Results/DE/NIup_Cycling_B.csv")


Inflammation_BEST4_entero <- FindMarkers(data, subset.ident = "BEST4_enterocyte", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_BEST4_entero <- filter(Inflammation_BEST4_entero, Inflammation_BEST4_entero$p_val_adj < 0.05)
Inflammation_BEST4_entero$cluster = ifelse(Inflammation_BEST4_entero$avg_logFC > 0,"I","NI")
Inflammation_BEST4_entero$gene = rownames(Inflammation_BEST4_entero)
Iup_BEST4_entero = filter(Inflammation_BEST4_entero, Inflammation_BEST4_entero$cluster == "I")
NIup_BEST4_entero = filter(Inflammation_BEST4_entero, Inflammation_BEST4_entero$cluster == "NI")
write.csv(Iup_BEST4_entero, "Results/DE/Iup_BEST4_entero.csv")
write.csv(NIup_BEST4_entero, "Results/DE/NIup_BEST4_entero.csv")

Inflammation_Memory_B <- FindMarkers(data, subset.ident = "Memory_B", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_Memory_B <- filter(Inflammation_Memory_B, Inflammation_Memory_B$p_val_adj < 0.05)
Inflammation_Memory_B$cluster = ifelse(Inflammation_Memory_B$avg_logFC > 0,"I","NI")
Inflammation_Memory_B$gene = rownames(Inflammation_Memory_B)
Iup_Memory_B = filter(Inflammation_Memory_B, Inflammation_Memory_B$cluster == "I")
NIup_Memory_B = filter(Inflammation_Memory_B, Inflammation_Memory_B$cluster == "NI")
write.csv(Iup_Memory_B, "Results/DE/Iup_Memory_B.csv")
write.csv(NIup_Memory_B, "Results/DE/NIup_Memory_B.csv")

Inflammation_MAIT <- FindMarkers(data, subset.ident = "MAIT", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_MAIT <- filter(Inflammation_MAIT, Inflammation_MAIT$p_val_adj < 0.05)
Inflammation_MAIT$cluster = ifelse(Inflammation_MAIT$avg_logFC > 0,"I","NI")
Inflammation_MAIT$gene = rownames(Inflammation_MAIT)
Iup_MAIT = filter(Inflammation_MAIT, Inflammation_MAIT$cluster == "I")
NIup_MAIT = filter(Inflammation_MAIT, Inflammation_MAIT$cluster == "NI")
write.csv(Iup_MAIT, "Results/DE/Iup_MAIT.csv")
write.csv(NIup_MAIT, "Results/DE/NIup_MAIT.csv")

Inflammation_Inflam_fibro <- FindMarkers(data, subset.ident = "Inflammatory_fibroblast", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_Inflam_fibro <- filter(Inflammation_Inflam_fibro, Inflammation_Inflam_fibro$p_val_adj < 0.05)
Inflammation_Inflam_fibro$cluster = ifelse(Inflammation_Inflam_fibro$avg_logFC > 0,"I","NI")
Inflammation_Inflam_fibro$gene = rownames(Inflammation_Inflam_fibro)
Iup_Inflam_fibro = filter(Inflammation_Inflam_fibro, Inflammation_Inflam_fibro$cluster == "I")
NIup_Inflam_fibro = filter(Inflammation_Inflam_fibro, Inflammation_Inflam_fibro$cluster == "NI")
write.csv(Iup_Inflam_fibro, "Results/DE/Iup_Inflam_fibro.csv")
write.csv(NIup_Inflam_fibro, "Results/DE/NIup_Inflam_fibro.csv")

Inflammation_RSPO3 <- FindMarkers(data, subset.ident = "RSPO3_fibroblast", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_RSPO3 <- filter(Inflammation_RSPO3, Inflammation_RSPO3$p_val_adj < 0.05)
Inflammation_RSPO3$cluster = ifelse(Inflammation_RSPO3$avg_logFC > 0,"I","NI")
Inflammation_RSPO3$gene = rownames(Inflammation_RSPO3)
Iup_RSPO3 = filter(Inflammation_RSPO3, Inflammation_RSPO3$cluster == "I")
NIup_RSPO3 = filter(Inflammation_RSPO3, Inflammation_RSPO3$cluster == "NI")
write.csv(Iup_RSPO3, "Results/DE/Iup_RSPO3.csv")
write.csv(NIup_RSPO3, "Results/DE/NIup_RSPO3.csv")

Inflammation_stem <- FindMarkers(data, subset.ident = "Stem", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_stem <- filter(Inflammation_stem, Inflammation_stem$p_val_adj < 0.05)
Inflammation_stem$cluster = ifelse(Inflammation_stem$avg_logFC > 0,"I","NI")
Inflammation_stem$gene = rownames(Inflammation_stem)
Iup_stem = filter(Inflammation_stem, Inflammation_stem$cluster == "I")
NIup_stem = filter(Inflammation_stem, Inflammation_stem$cluster == "NI")
write.csv(Iup_stem, "Results/DE/Iup_stem.csv")
write.csv(NIup_stem, "Results/DE/NIup_stem.csv")

Inflammation_IgA <- FindMarkers(data, subset.ident = "IgA_plasma", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_IgA <- filter(Inflammation_IgA, Inflammation_IgA$p_val_adj < 0.05)
Inflammation_IgA$cluster = ifelse(Inflammation_IgA$avg_logFC > 0,"I","NI")
Inflammation_IgA$gene = rownames(Inflammation_IgA)
Iup_IgA = filter(Inflammation_IgA, Inflammation_IgA$cluster == "I")
NIup_IgA = filter(Inflammation_IgA, Inflammation_IgA$cluster == "NI")
write.csv(Iup_IgA, "Results/DE/Iup_IgA.csv")
write.csv(NIup_IgA, "Results/DE/NIup_IgA.csv")

Inflammation_Activated_B <- FindMarkers(data, subset.ident = "Activated_B", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_Activated_B <- filter(Inflammation_Activated_B, Inflammation_Activated_B$p_val_adj < 0.05)
Inflammation_Activated_B$cluster = ifelse(Inflammation_Activated_B$avg_logFC > 0,"I","NI")
Inflammation_Activated_B$gene = rownames(Inflammation_Activated_B)
Iup_Activated_B = filter(Inflammation_Activated_B, Inflammation_Activated_B$cluster == "I")
NIup_Activated_B = filter(Inflammation_Activated_B, Inflammation_Activated_B$cluster == "NI")
write.csv(Iup_Activated_B, "Results/DE/Iup_Activated_B.csv")
write.csv(NIup_Activated_B, "Results/DE/NIup_Activated_B.csv")



##########

########### novel immune cell types
#infl_vs_nINf

Idents(data)<-"celltypes"

Inflammation_Activated_cycling_B <- FindMarkers(data, subset.ident = "Activated_cycling_B", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_Activated_cycling_B <- filter(Inflammation_Activated_cycling_B, Inflammation_Activated_cycling_B$p_val_adj < 0.05)
Inflammation_Activated_cycling_B$cluster = ifelse(Inflammation_Activated_cycling_B$avg_logFC > 0,"I","NI")
Inflammation_Activated_cycling_B$gene = rownames(Inflammation_Activated_cycling_B)
Iup_Activated_cycling_B = filter(Inflammation_Activated_cycling_B, Inflammation_Activated_cycling_B$cluster == "I")
NIup_Activated_cycling_B = filter(Inflammation_Activated_cycling_B, Inflammation_Activated_cycling_B$cluster == "NI")
write.csv(Iup_Activated_cycling_B, "Results/DE/Iup_Activated_cycling_B.csv")
write.csv(NIup_Activated_cycling_B, "Results/DE/NIup_Activated_cycling_B.csv")

#IBD_vs_HC
Disease_Activated_cycling_B <- FindMarkers(data, subset.ident = "Activated_cycling_B", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_Activated_cycling_B <- filter(Disease_Activated_cycling_B, Disease_Activated_cycling_B$p_val_adj < 0.05)
Disease_Activated_cycling_B$cluster = ifelse(Disease_Activated_cycling_B$avg_logFC > 0,"IBD","HC")
Disease_Activated_cycling_B$gene = rownames(Disease_Activated_cycling_B)
IBDup_Activated_cycling_B = filter(Disease_Activated_cycling_B, Disease_Activated_cycling_B$cluster == "IBD")
HCup_Activated_cycling_B = filter(Disease_Activated_cycling_B, Disease_Activated_cycling_B$cluster == "HC")
write.csv(IBDup_Activated_cycling_B, "Results/DE/IBDup_Activated_cycling_B.csv")
write.csv(HCup_Activated_cycling_B, "Results/DE/HCup_Activated_cycling_B.csv")

## PSC vs non PSC

PSC_Activated_cycling_B <- FindMarkers(data, subset.ident = "Activated_cycling_B", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "HC"), ident.2 = "PSC")
PSC_Activated_cycling_B <- filter(PSC_Activated_cycling_B, PSC_Activated_cycling_B$p_val_adj < 0.05)
PSC_Activated_cycling_B$cluster = ifelse(PSC_Activated_cycling_B$avg_logFC > 0,"non-PSC","PSC")
PSC_Activated_cycling_B$gene = rownames(PSC_Activated_cycling_B)
nonPSCup_Activated_cycling_B = filter(PSC_Activated_cycling_B, PSC_Activated_cycling_B$cluster == "non-PSC")
PSCup_Activated_cycling_B = filter(PSC_Activated_cycling_B, PSC_Activated_cycling_B$cluster == "PSC")
write.csv(nonPSCup_Activated_cycling_B, "Results/DE/nonPSCup_Activated_cycling_B.csv")
write.csv(PSCup_Activated_cycling_B, "Results/DE/PSCup_Activated_cycling_B.csv")

## paired_PSC
PSCINI_Activated_cycling_B <- FindMarkers(data_PSC, subset.ident = "Activated_cycling_B", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Activated_cycling_B <- filter(PSCINI_Activated_cycling_B, PSCINI_Activated_cycling_B$p_val_adj < 0.05)
PSCINI_Activated_cycling_B$cluster = ifelse(PSCINI_Activated_cycling_B$avg_logFC > 0,"I","NI")
PSCINI_Activated_cycling_B$gene = rownames(PSCINI_Activated_cycling_B)
PSCIup_Activated_cycling_B = filter(PSCINI_Activated_cycling_B, PSCINI_Activated_cycling_B$cluster == "I")
PSCNIup_Activated_cycling_B = filter(PSCINI_Activated_cycling_B, PSCINI_Activated_cycling_B$cluster == "NI")
write.csv(PSCIup_Activated_cycling_B, "Results/DE/PSCIup_Activated_cycling_B.csv")
write.csv(PSCNIup_Activated_cycling_B, "Results/DE/PSCNIup_Activated_cycling_B.csv")
GO_PSCIup_Activated_cycling_B=enrichr(PSCIup_Activated_cycling_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Activated_cycling_B <- filter(GO_PSCIup_Activated_cycling_B, GO_PSCIup_Activated_cycling_B$Adjusted.P.value< 0.05)
GO_PSCNIup_Activated_cycling_B=enrichr(PSCNIup_Activated_cycling_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Activated_cycling_B <- filter(GO_PSCNIup_Activated_cycling_B, GO_PSCNIup_Activated_cycling_B$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Activated_cycling_B, "Results/DE/GO_PSCNIup_Activated_cycling_B.csv")
write.csv(GO_PSCIup_Activated_cycling_B, "Results/DE/GO_PSCIup_Activated_cycling_B.csv")

#UCI_NI
UCINI_Activated_cycling_B <- FindMarkers(data_UC, subset.ident = "Activated_cycling_B", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Activated_cycling_B <- filter(UCINI_Activated_cycling_B, UCINI_Activated_cycling_B$p_val_adj < 0.05)
UCINI_Activated_cycling_B$cluster = ifelse(UCINI_Activated_cycling_B$avg_logFC > 0,"I","NI")
UCINI_Activated_cycling_B$gene = rownames(UCINI_Activated_cycling_B)
UCIup_Activated_cycling_B = filter(UCINI_Activated_cycling_B, UCINI_Activated_cycling_B$cluster == "I")
UCNIup_Activated_cycling_B = filter(UCINI_Activated_cycling_B, UCINI_Activated_cycling_B$cluster == "NI")
write.csv(UCIup_Activated_cycling_B, "Results/DE/UCIup_Activated_cycling_B.csv")
write.csv(UCNIup_Activated_cycling_B, "Results/DE/UCNIup_Activated_cycling_B.csv")
GO_UCIup_Activated_cycling_B=enrichr(UCIup_Activated_cycling_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Activated_cycling_B <- filter(GO_UCIup_Activated_cycling_B, GO_UCIup_Activated_cycling_B$Adjusted.P.value< 0.05)
GO_UCNIup_Activated_cycling_B=enrichr(UCNIup_Activated_cycling_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Activated_cycling_B <- filter(GO_UCNIup_Activated_cycling_B, GO_UCNIup_Activated_cycling_B$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Activated_cycling_B, "Results/DE/GO_UCNIup_Activated_cycling_B.csv")
write.csv(GO_UCIup_Activated_cycling_B, "Results/DE/GO_UCIup_Activated_cycling_B.csv")

#
Disease2_Activated_cycling_B <- FindMarkers(data, subset.ident = "Activated_cycling_B", group.by = "state", test.use = "MAST", ident.1 = "UC-NI", ident.2 = "HC-NI")
Disease2_Activated_cycling_B <- filter(Disease2_Activated_cycling_B, Disease2_Activated_cycling_B$p_val_adj < 0.05)
Disease2_Activated_cycling_B$cluster = ifelse(Disease2_Activated_cycling_B$avg_logFC > 0,"UC-NI","HC-NI")
Disease2_Activated_cycling_B$gene = rownames(Disease2_Activated_cycling_B)
UC_NIup_Activated_cycling_B = filter(Disease2_Activated_cycling_B, Disease2_Activated_cycling_B$cluster == "UC-NI")
HC_NIup_Activated_cycling_B = filter(Disease2_Activated_cycling_B, Disease2_Activated_cycling_B$cluster == "HC-NI")
write.csv(UC_NIup_Activated_cycling_B, "Results/DE/UCNIupvsHC-NI_Activated_cycling_B.csv")
write.csv(HC_NIup_Activated_cycling_B, "Results/DE/HC_NIupvsUCNI_Activated_cycling_B.csv")

Disease1_Activated_cycling_B <- FindMarkers(data, subset.ident = "Activated_cycling_B", group.by = "state", test.use = "MAST", ident.1 = "PSC-NI", ident.2 = "HC-NI")
Disease1_Activated_cycling_B <- filter(Disease1_Activated_cycling_B, Disease1_Activated_cycling_B$p_val_adj < 0.05)
Disease1_Activated_cycling_B$cluster = ifelse(Disease1_Activated_cycling_B$avg_logFC > 0,"PSC-NI","HC-NI")
Disease1_Activated_cycling_B$gene = rownames(Disease1_Activated_cycling_B)
PSC_NIup_Activated_cycling_B = filter(Disease1_Activated_cycling_B, Disease1_Activated_cycling_B$cluster == "PSC-NI")
HC_NIup_Activated_cycling_B = filter(Disease1_Activated_cycling_B, Disease1_Activated_cycling_B$cluster == "HC-NI")
write.csv(PSC_NIup_Activated_cycling_B, "Results/DE/PSCNIupvsHC-NI_Activated_cycling_B.csv")
write.csv(HC_NIup_Activated_cycling_B, "Results/DE/HC_NIupvsPSCNI_Activated_cycling_B.csv")

Disease3_Activated_cycling_B <- FindMarkers(data, subset.ident = "Activated_cycling_B", group.by = "state", test.use = "MAST", ident.1 = "PSC-I", ident.2 = "HC-NI")
Disease3_Activated_cycling_B <- filter(Disease3_Activated_cycling_B, Disease3_Activated_cycling_B$p_val_adj < 0.05)
Disease3_Activated_cycling_B$cluster = ifelse(Disease3_Activated_cycling_B$avg_logFC > 0,"PSC-I","HC-NI")
Disease3_Activated_cycling_B$gene = rownames(Disease3_Activated_cycling_B)
PSC_Iup_Activated_cycling_B = filter(Disease3_Activated_cycling_B, Disease3_Activated_cycling_B$cluster == "PSC-I")
HC_NIup_Activated_cycling_B = filter(Disease3_Activated_cycling_B, Disease3_Activated_cycling_B$cluster == "HC-NI")
write.csv(PSC_Iup_Activated_cycling_B, "Results/DE/PSCIupvsHC-NI_Activated_cycling_B.csv")
write.csv(HC_NIup_Activated_cycling_B, "Results/DE/HC_NIupvsPSCI_Activated_cycling_B.csv")

Disease4_Activated_cycling_B <- FindMarkers(data, subset.ident = "Activated_cycling_B", group.by = "state", test.use = "MAST", ident.1 = "UC-I", ident.2 = "HC-NI")
Disease4_Activated_cycling_B <- filter(Disease4_Activated_cycling_B, Disease4_Activated_cycling_B$p_val_adj < 0.05)
Disease4_Activated_cycling_B$cluster = ifelse(Disease4_Activated_cycling_B$avg_logFC > 0,"UC-I","HC-NI")
Disease4_Activated_cycling_B$gene = rownames(Disease4_Activated_cycling_B)
UC_Iup_Activated_cycling_B = filter(Disease4_Activated_cycling_B, Disease4_Activated_cycling_B$cluster == "UC-I")
HC_NIup_Activated_cycling_B = filter(Disease4_Activated_cycling_B, Disease4_Activated_cycling_B$cluster == "HC-NI")
write.csv(UC_Iup_Activated_cycling_B, "Results/DE/UCIupvsHC-NI_Activated_cycling_B.csv")
write.csv(HC_NIup_Activated_cycling_B, "Results/DE/HC_NIupvsUCI_Activated_cycling_B.csv")



# IBD vs HC
Idents(data) <- "disease"
Disease = FindAllMarkers(data, test.use = "MAST", only.pos = T)
Disease <- filter(Disease, Disease$p_val_adj < 0.05)

Idents(data) <- "celltypes"
Disease_IgG <- FindMarkers(data, subset.ident = "IgG_plasma", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_IgG <- filter(Disease_IgG, Disease_IgG$p_val_adj < 0.05)
Disease_IgG$cluster = ifelse(Disease_IgG$avg_logFC > 0,"IBD","HC")
Disease_IgG$gene = rownames(Disease_IgG)
IBDup_IgG = filter(Disease_IgG, Disease_IgG$cluster == "IBD")
HCup_IgG = filter(Disease_IgG, Disease_IgG$cluster == "HC")
write.csv(IBDup_IgG, "Results/DE/IBDup_IgG.csv")
write.csv(HCup_IgG, "Results/DE/HCup_IgG.csv")

Disease_Treg <- FindMarkers(data, subset.ident = "Treg", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_Treg <- filter(Disease_Treg, Disease_Treg$p_val_adj < 0.05)
Disease_Treg$cluster = ifelse(Disease_Treg$avg_logFC > 0,"IBD","HC")
Disease_Treg$gene = rownames(Disease_Treg)
IBDup_Treg = filter(Disease_Treg, Disease_Treg$cluster == "IBD")
HCup_Treg = filter(Disease_Treg, Disease_Treg$cluster == "HC")
write.csv(IBDup_Treg, "Results/DE/IBDup_Treg.csv")
write.csv(HCup_Treg, "Results/DE/HCup_Treg.csv")

Disease_abs_TA <- FindMarkers(data, subset.ident = "Absorptive_TA", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_abs_TA <- filter(Disease_abs_TA, Disease_abs_TA$p_val_adj < 0.05)
Disease_abs_TA$cluster = ifelse(Disease_abs_TA$avg_logFC > 0,"IBD","HC")
Disease_abs_TA$gene = rownames(Disease_abs_TA)
IBDup_abs_TA = filter(Disease_abs_TA, Disease_abs_TA$cluster == "IBD")
HCup_abs_TA = filter(Disease_abs_TA, Disease_abs_TA$cluster == "HC")
write.csv(IBDup_abs_TA, "Results/DE/IBDup_abs_TA.csv")
write.csv(HCup_abs_TA, "Results/DE/HCup_abs_TA.csv")

Disease_DUOX2_entero <- FindMarkers(data, subset.ident = "DUOX2_enterocyte", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_DUOX2_entero <- filter(Disease_DUOX2_entero, Disease_DUOX2_entero$p_val_adj < 0.05)
Disease_DUOX2_entero$cluster = ifelse(Disease_DUOX2_entero$avg_logFC > 0,"IBD","HC")
Disease_DUOX2_entero$gene = rownames(Disease_DUOX2_entero)
IBDup_DUOX2_entero = filter(Disease_DUOX2_entero, Disease_DUOX2_entero$cluster == "IBD")
HCup_DUOX2_entero = filter(Disease_DUOX2_entero, Disease_DUOX2_entero$cluster == "HC")
write.csv(IBDup_DUOX2_entero, "Results/DE/IBDup_DUOX2_entero.csv")
write.csv(HCup_DUOX2_entero, "Results/DE/HCup_DUOX2_entero.csv")

Disease_Cycling_TA <- FindMarkers(data, subset.ident = "Cycling_TA", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_Cycling_TA <- filter(Disease_Cycling_TA, Disease_Cycling_TA$p_val_adj < 0.05)
Disease_Cycling_TA$cluster = ifelse(Disease_Cycling_TA$avg_logFC > 0,"IBD","HC")
Disease_Cycling_TA$gene = rownames(Disease_Cycling_TA)
IBDup_Cycling_TA = filter(Disease_Cycling_TA, Disease_Cycling_TA$cluster == "IBD")
HCup_Cycling_TA = filter(Disease_Cycling_TA, Disease_Cycling_TA$cluster == "HC")
write.csv(IBDup_Cycling_TA, "Results/DE/IBDup_Cycling_TA.csv")
write.csv(HCup_Cycling_TA, "Results/DE/HCup_Cycling_TA.csv")

Disease_BEST4_entero <- FindMarkers(data, subset.ident = "BEST4_enterocyte", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_BEST4_entero <- filter(Disease_BEST4_entero, Disease_BEST4_entero$p_val_adj < 0.05)
Disease_BEST4_entero$cluster = ifelse(Disease_BEST4_entero$avg_logFC > 0,"IBD","HC")
Disease_BEST4_entero$gene = rownames(Disease_BEST4_entero)
IBDup_BEST4_entero = filter(Disease_BEST4_entero, Disease_BEST4_entero$cluster == "IBD")
HCup_BEST4_entero = filter(Disease_BEST4_entero, Disease_BEST4_entero$cluster == "HC")
write.csv(IBDup_BEST4_entero, "Results/DE/IBDup_BEST4_entero.csv")
write.csv(HCup_BEST4_entero, "Results/DE/HCup_BEST4_entero.csv")

Disease_PLCG2_TA <- FindMarkers(data, subset.ident = "PLCG2_TA", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_PLCG2_TA <- filter(Disease_PLCG2_TA, Disease_PLCG2_TA$p_val_adj < 0.05)
Disease_PLCG2_TA$cluster = ifelse(Disease_PLCG2_TA$avg_logFC > 0,"IBD","HC")
Disease_PLCG2_TA$gene = rownames(Disease_PLCG2_TA)
IBDup_PLCG2_TA = filter(Disease_PLCG2_TA, Disease_PLCG2_TA$cluster == "IBD")
HCup_PLCG2_TA = filter(Disease_PLCG2_TA, Disease_PLCG2_TA$cluster == "HC")
write.csv(IBDup_PLCG2_TA, "Results/DE/IBDup_PLCG2_TA.csv")
write.csv(HCup_PLCG2_TA, "Results/DE/HCup_PLCG2_TA.csv")

Disease_Ribo_TA <- FindMarkers(data, subset.ident = "Ribo_TA", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_Ribo_TA <- filter(Disease_Ribo_TA, Disease_Ribo_TA$p_val_adj < 0.05)
Disease_Ribo_TA$cluster = ifelse(Disease_Ribo_TA$avg_logFC > 0,"IBD","HC")
Disease_Ribo_TA$gene = rownames(Disease_Ribo_TA)
IBDup_Ribo_TA = filter(Disease_Ribo_TA, Disease_Ribo_TA$cluster == "IBD")
HCup_Ribo_TA = filter(Disease_Ribo_TA, Disease_Ribo_TA$cluster == "HC")
write.csv(IBDup_Ribo_TA, "Results/DE/IBDup_Ribo_TA.csv")
write.csv(HCup_Ribo_TA, "Results/DE/HCup_Ribo_TA.csv")

Disease_Pericytes <- FindMarkers(data, subset.ident = "Pericytes", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_Pericytes <- filter(Disease_Pericytes, Disease_Pericytes$p_val_adj < 0.05)
Disease_Pericytes$cluster = ifelse(Disease_Pericytes$avg_logFC > 0,"IBD","HC")
Disease_Pericytes$gene = rownames(Disease_Pericytes)
IBDup_Pericytes = filter(Disease_Pericytes, Disease_Pericytes$cluster == "IBD")
HCup_Pericytes = filter(Disease_Pericytes, Disease_Pericytes$cluster == "HC")
write.csv(IBDup_Pericytes, "Results/DE/IBDup_Pericytes.csv")
write.csv(HCup_Pericytes, "Results/DE/HCup_Pericytes.csv")

Disease_PLCG2_TA <- FindMarkers(data, subset.ident = "PLCG2_TA", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_PLCG2_TA <- filter(Disease_PLCG2_TA, Disease_PLCG2_TA$p_val_adj < 0.05)
Disease_PLCG2_TA$cluster = ifelse(Disease_PLCG2_TA$avg_logFC > 0,"IBD","HC")
Disease_PLCG2_TA$gene = rownames(Disease_PLCG2_TA)
IBDup_PLCG2_TA = filter(Disease_PLCG2_TA, Disease_PLCG2_TA$cluster == "IBD")
HCup_PLCG2_TA = filter(Disease_PLCG2_TA, Disease_PLCG2_TA$cluster == "HC")
write.csv(IBDup_PLCG2_TA, "Results/DE/IBDup_PLCG2_TA.csv")
write.csv(HCup_PLCG2_TA, "Results/DE/HCup_PLCG2_TA.csv")

Disease_Ribo_TA <- FindMarkers(data, subset.ident = "Ribo_TA", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_Ribo_TA <- filter(Disease_Ribo_TA, Disease_Ribo_TA$p_val_adj < 0.05)
Disease_Ribo_TA$cluster = ifelse(Disease_Ribo_TA$avg_logFC > 0,"IBD","HC")
Disease_Ribo_TA$gene = rownames(Disease_Ribo_TA)
IBDup_Ribo_TA = filter(Disease_Ribo_TA, Disease_Ribo_TA$cluster == "IBD")
HCup_Ribo_TA = filter(Disease_Ribo_TA, Disease_Ribo_TA$cluster == "HC")
write.csv(IBDup_Ribo_TA, "Results/DE/IBDup_Ribo_TA.csv")
write.csv(HCup_Ribo_TA, "Results/DE/HCup_Ribo_TA.csv")

Disease_Pericytes <- FindMarkers(data, subset.ident = "Pericytes", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_Pericytes <- filter(Disease_Pericytes, Disease_Pericytes$p_val_adj < 0.05)
Disease_Pericytes$cluster = ifelse(Disease_Pericytes$avg_logFC > 0,"IBD","HC")
Disease_Pericytes$gene = rownames(Disease_Pericytes)
IBDup_Pericytes = filter(Disease_Pericytes, Disease_Pericytes$cluster == "IBD")
HCup_Pericytes = filter(Disease_Pericytes, Disease_Pericytes$cluster == "HC")
write.csv(IBDup_Pericytes, "Results/DE/IBDup_Pericytes.csv")
write.csv(HCup_Pericytes, "Results/DE/HCup_Pericytes.csv")

Disease_IgA <- FindMarkers(data, subset.ident = "IgA_plasma", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_IgA <- filter(Disease_IgA, Disease_IgA$p_val_adj < 0.05)
Disease_IgA$cluster = ifelse(Disease_IgA$avg_logFC > 0,"IBD","HC")
Disease_IgA$gene = rownames(Disease_IgA)
IBDup_IgA = filter(Disease_IgA, Disease_IgA$cluster == "IBD")
HCup_IgA = filter(Disease_IgA, Disease_IgA$cluster == "HC")
write.csv(IBDup_IgA, "Results/DE/IBDup_IgA.csv")
write.csv(HCup_IgA, "Results/DE/HCup_IgA.csv")

Disease_Memory_B <- FindMarkers(data, subset.ident = "Memory_B", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_Memory_B <- filter(Disease_Memory_B, Disease_Memory_B$p_val_adj < 0.05)
Disease_Memory_B$cluster = ifelse(Disease_Memory_B$avg_logFC > 0,"IBD","HC")
Disease_Memory_B$gene = rownames(Disease_Memory_B)
IBDup_Memory_B = filter(Disease_Memory_B, Disease_Memory_B$cluster == "IBD")
HCup_Memory_B = filter(Disease_Memory_B, Disease_Memory_B$cluster == "HC")
write.csv(IBDup_Memory_B, "Results/DE/IBDup_Memory_B.csv")
write.csv(HCup_Memory_B, "Results/DE/HCup_Memory_B.csv")

Disease_MAIT <- FindMarkers(data, subset.ident = "MAIT", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_MAIT <- filter(Disease_MAIT, Disease_MAIT$p_val_adj < 0.05)
Disease_MAIT$cluster = ifelse(Disease_MAIT$avg_logFC > 0,"IBD","HC")
Disease_MAIT$gene = rownames(Disease_MAIT)
IBDup_MAIT = filter(Disease_MAIT, Disease_MAIT$cluster == "IBD")
HCup_MAIT = filter(Disease_MAIT, Disease_MAIT$cluster == "HC")
write.csv(IBDup_MAIT, "Results/DE/IBDup_MAIT.csv")
write.csv(HCup_MAIT, "Results/DE/HCup_MAIT.csv")

Disease_Inflam_fibro <- FindMarkers(data, subset.ident = "Inflammatory_fibroblast", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_Inflam_fibro <- filter(Disease_Inflam_fibro, Disease_Inflam_fibro$p_val_adj < 0.05)
Disease_Inflam_fibro$cluster = ifelse(Disease_Inflam_fibro$avg_logFC > 0,"IBD","HC")
Disease_Inflam_fibro$gene = rownames(Disease_Inflam_fibro)
IBDup_Inflam_fibro = filter(Disease_Inflam_fibro, Disease_Inflam_fibro$cluster == "IBD")
HCup_Inflam_fibro = filter(Disease_Inflam_fibro, Disease_Inflam_fibro$cluster == "HC")
write.csv(IBDup_Inflam_fibro, "Results/DE/IBDup_Inflam_fibro.csv")
write.csv(HCup_Inflam_fibro, "Results/DE/HCup_Inflam_fibro.csv")

Disease_RSPO3 <- FindMarkers(data, subset.ident = "RSPO3_fibroblast", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_RSPO3 <- filter(Disease_RSPO3, Disease_RSPO3$p_val_adj < 0.05)
Disease_RSPO3$cluster = ifelse(Disease_RSPO3$avg_logFC > 0,"IBD","HC")
Disease_RSPO3$gene = rownames(Disease_RSPO3)
IBDup_RSPO3 = filter(Disease_RSPO3, Disease_RSPO3$cluster == "IBD")
HCup_RSPO3 = filter(Disease_RSPO3, Disease_RSPO3$cluster == "HC")
write.csv(IBDup_RSPO3, "Results/DE/IBDup_RSPO3.csv")
write.csv(HCup_RSPO3, "Results/DE/HCup_RSPO3.csv")

Disease_stem <- FindMarkers(data, subset.ident = "Stem", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_stem <- filter(Disease_stem, Disease_stem$p_val_adj < 0.05)
Disease_stem$cluster = ifelse(Disease_stem$avg_logFC > 0,"IBD","HC")
Disease_stem$gene = rownames(Disease_stem)
IBDup_stem = filter(Disease_stem, Disease_stem$cluster == "IBD")
HCup_stem = filter(Disease_stem, Disease_stem$cluster == "HC")
write.csv(IBDup_stem, "Results/DE/IBDup_stem.csv")
write.csv(HCup_stem, "Results/DE/HCup_stem.csv")

#########
##############
#UC-I vs HC-NI
Idents(data) <- "celltypes"
Disease_IgG <- FindMarkers(data, subset.ident = "IgG_plasma", group.by = "state", test.use = "MAST", ident.1 = "UC-I", ident.2 = "HC-NI")
Disease_IgG <- filter(Disease_IgG, Disease_IgG$p_val_adj < 0.05)
Disease_IgG$cluster = ifelse(Disease_IgG$avg_logFC > 0,"UC-I","HC-NI")
Disease_IgG$gene = rownames(Disease_IgG)
UC_Iup_IgG = filter(Disease_IgG, Disease_IgG$cluster == "UC-I")
HC_NIup_IgG = filter(Disease_IgG, Disease_IgG$cluster == "HC-NI")
write.csv(UC_Iup_IgG, "Results/DE/UCIupvsHC_NI_IgG.csv")
write.csv(HC_NIup_IgG, "Results/DE/HC_NIupvsUCI_IgG.csv")

Disease_Treg <- FindMarkers(data, subset.ident = "Treg", group.by = "state", test.use = "MAST", ident.1 = "UC-I", ident.2 = "HC-NI")
Disease_Treg <- filter(Disease_Treg, Disease_Treg$p_val_adj < 0.05)
Disease_Treg$cluster = ifelse(Disease_Treg$avg_logFC > 0,"UC-I","HC-NI")
Disease_Treg$gene = rownames(Disease_Treg)
UC_Iup_Treg = filter(Disease_Treg, Disease_Treg$cluster == "UC-I")
HC_NIup_Treg = filter(Disease_Treg, Disease_Treg$cluster == "HC-NI")
write.csv(UC_Iup_Treg, "Results/DE/UCIupvsHC_NI_Treg.csv")
write.csv(HC_NIup_Treg, "Results/DE/HC_NIupvsUCI_Treg.csv")

Disease_abs_TA <- FindMarkers(data, subset.ident = "Absorptive_TA", group.by = "state", test.use = "MAST", ident.1 = "UC-I", ident.2 = "HC-NI")
Disease_abs_TA <- filter(Disease_abs_TA, Disease_abs_TA$p_val_adj < 0.05)
Disease_abs_TA$cluster = ifelse(Disease_abs_TA$avg_logFC > 0,"UC-I","HC-NI")
Disease_abs_TA$gene = rownames(Disease_abs_TA)
UC_Iup_abs_TA = filter(Disease_abs_TA, Disease_abs_TA$cluster == "UC-I")
HC_NIup_abs_TA = filter(Disease_abs_TA, Disease_abs_TA$cluster == "HC-NI")
write.csv(UC_Iup_abs_TA, "Results/DE/UCIupvsHC_NI_abs_TA.csv")
write.csv(HC_NIup_abs_TA, "Results/DE/HC_NIupvsUCI_abs_TA.csv")

Disease_DUOX2_entero <- FindMarkers(data, subset.ident = "DUOX2_enterocyte", group.by = "state", test.use = "MAST", ident.1 = "UC-I", ident.2 = "HC-NI")
Disease_DUOX2_entero <- filter(Disease_DUOX2_entero, Disease_DUOX2_entero$p_val_adj < 0.05)
Disease_DUOX2_entero$cluster = ifelse(Disease_DUOX2_entero$avg_logFC > 0,"UC-I","HC-NI")
Disease_DUOX2_entero$gene = rownames(Disease_DUOX2_entero)
UC_Iup_DUOX2_entero = filter(Disease_DUOX2_entero, Disease_DUOX2_entero$cluster == "UC-I")
HC_NIup_DUOX2_entero = filter(Disease_DUOX2_entero, Disease_DUOX2_entero$cluster == "HC-NI")
write.csv(UC_Iup_DUOX2_entero, "Results/DE/UCIupvsHC_NI_DUOX2_entero.csv")
write.csv(HC_NIup_DUOX2_entero, "Results/DE/HC_NIupvsUCI_DUOX2_entero.csv")

Disease_Cycling_TA <- FindMarkers(data, subset.ident = "Cycling_TA", group.by = "state", test.use = "MAST", ident.1 = "UC-I", ident.2 = "HC-NI")
Disease_Cycling_TA <- filter(Disease_Cycling_TA, Disease_Cycling_TA$p_val_adj < 0.05)
Disease_Cycling_TA$cluster = ifelse(Disease_Cycling_TA$avg_logFC > 0,"UC-I","HC-NI")
Disease_Cycling_TA$gene = rownames(Disease_Cycling_TA)
UC_Iup_Cycling_TA = filter(Disease_Cycling_TA, Disease_Cycling_TA$cluster == "UC-I")
HC_NIup_Cycling_TA = filter(Disease_Cycling_TA, Disease_Cycling_TA$cluster == "HC-NI")
write.csv(UC_Iup_Cycling_TA, "Results/DE/UCIupvsHC_NI_Cycling_TA.csv")
write.csv(HC_NIup_Cycling_TA, "Results/DE/HC_NIupvsUCI_Cycling_TA.csv")

Disease_BEST4_entero <- FindMarkers(data, subset.ident = "BEST4_enterocyte", group.by = "state", test.use = "MAST", ident.1 = "UC-I", ident.2 = "HC-NI")
Disease_BEST4_entero <- filter(Disease_BEST4_entero, Disease_BEST4_entero$p_val_adj < 0.05)
Disease_BEST4_entero$cluster = ifelse(Disease_BEST4_entero$avg_logFC > 0,"UC-I","HC-NI")
Disease_BEST4_entero$gene = rownames(Disease_BEST4_entero)
UC_Iup_BEST4_entero = filter(Disease_BEST4_entero, Disease_BEST4_entero$cluster == "UC-I")
HC_NIup_BEST4_entero = filter(Disease_BEST4_entero, Disease_BEST4_entero$cluster == "HC-NI")
write.csv(UC_Iup_BEST4_entero, "Results/DE/UCIupvsHC_NI_BEST4_entero.csv")
write.csv(HC_NIup_BEST4_entero, "Results/DE/HC_NIupvsUCI_BEST4_entero.csv")

Disease_PLCG2_TA <- FindMarkers(data, subset.ident = "PLCG2_TA", group.by = "state", test.use = "MAST", ident.1 = "UC-I", ident.2 = "HC-NI")
Disease_PLCG2_TA <- filter(Disease_PLCG2_TA, Disease_PLCG2_TA$p_val_adj < 0.05)
Disease_PLCG2_TA$cluster = ifelse(Disease_PLCG2_TA$avg_logFC > 0,"UC-I","HC-NI")
Disease_PLCG2_TA$gene = rownames(Disease_PLCG2_TA)
UC_Iup_PLCG2_TA = filter(Disease_PLCG2_TA, Disease_PLCG2_TA$cluster == "UC-I")
HC_NIup_PLCG2_TA = filter(Disease_PLCG2_TA, Disease_PLCG2_TA$cluster == "HC-NI")
write.csv(UC_Iup_PLCG2_TA, "Results/DE/UCIupvsHC_NI_PLCG2_TA.csv")
write.csv(HC_NIup_PLCG2_TA, "Results/DE/HC_NIupvsUCI_PLCG2_TA.csv")

Disease_Ribo_TA <- FindMarkers(data, subset.ident = "Ribo_TA", group.by = "state", test.use = "MAST", ident.1 = "UC-I", ident.2 = "HC-NI")
Disease_Ribo_TA <- filter(Disease_Ribo_TA, Disease_Ribo_TA$p_val_adj < 0.05)
Disease_Ribo_TA$cluster = ifelse(Disease_Ribo_TA$avg_logFC > 0,"UC-I","HC-NI")
Disease_Ribo_TA$gene = rownames(Disease_Ribo_TA)
UC_Iup_Ribo_TA = filter(Disease_Ribo_TA, Disease_Ribo_TA$cluster == "UC-I")
HC_NIup_Ribo_TA = filter(Disease_Ribo_TA, Disease_Ribo_TA$cluster == "HC-NI")
write.csv(UC_Iup_Ribo_TA, "Results/DE/UCIupvsHC_NI_Ribo_TA.csv")
write.csv(HC_NIup_Ribo_TA, "Results/DE/HC_NIupvsUCI_Ribo_TA.csv")

Disease_Pericytes <- FindMarkers(data, subset.ident = "Pericytes", group.by = "state", test.use = "MAST", ident.1 = "UC-I", ident.2 = "HC-NI")
Disease_Pericytes <- filter(Disease_Pericytes, Disease_Pericytes$p_val_adj < 0.05)
Disease_Pericytes$cluster = ifelse(Disease_Pericytes$avg_logFC > 0,"UC-I","HC-NI")
Disease_Pericytes$gene = rownames(Disease_Pericytes)
UC_Iup_Pericytes = filter(Disease_Pericytes, Disease_Pericytes$cluster == "UC-I")
HC_NIup_Pericytes = filter(Disease_Pericytes, Disease_Pericytes$cluster == "HC-NI")
write.csv(UC_Iup_Pericytes, "Results/DE/UCIupvsHC_NI_Pericytes.csv")
write.csv(HC_NIup_Pericytes, "Results/DE/HC_NIupvsUCI_Pericytes.csv")

Disease_PLCG2_TA <- FindMarkers(data, subset.ident = "PLCG2_TA", group.by = "state", test.use = "MAST", ident.1 = "UC-I", ident.2 = "HC-NI")
Disease_PLCG2_TA <- filter(Disease_PLCG2_TA, Disease_PLCG2_TA$p_val_adj < 0.05)
Disease_PLCG2_TA$cluster = ifelse(Disease_PLCG2_TA$avg_logFC > 0,"UC-I","HC-NI")
Disease_PLCG2_TA$gene = rownames(Disease_PLCG2_TA)
UC_Iup_PLCG2_TA = filter(Disease_PLCG2_TA, Disease_PLCG2_TA$cluster == "UC-I")
HC_NIup_PLCG2_TA = filter(Disease_PLCG2_TA, Disease_PLCG2_TA$cluster == "HC-NI")
write.csv(UC_Iup_PLCG2_TA, "Results/DE/UCIupvsHC_NI_PLCG2_TA.csv")
write.csv(HC_NIup_PLCG2_TA, "Results/DE/HC_NIupvsUCI_PLCG2_TA.csv")

Disease_Ribo_TA <- FindMarkers(data, subset.ident = "Ribo_TA", group.by = "state", test.use = "MAST", ident.1 = "UC-I", ident.2 = "HC-NI")
Disease_Ribo_TA <- filter(Disease_Ribo_TA, Disease_Ribo_TA$p_val_adj < 0.05)
Disease_Ribo_TA$cluster = ifelse(Disease_Ribo_TA$avg_logFC > 0,"UC-I","HC-NI")
Disease_Ribo_TA$gene = rownames(Disease_Ribo_TA)
UC_Iup_Ribo_TA = filter(Disease_Ribo_TA, Disease_Ribo_TA$cluster == "UC-I")
HC_NIup_Ribo_TA = filter(Disease_Ribo_TA, Disease_Ribo_TA$cluster == "HC-NI")
write.csv(UC_Iup_Ribo_TA, "Results/DE/UCIupvsHC_NI_Ribo_TA.csv")
write.csv(HC_NIup_Ribo_TA, "Results/DE/HC_NIupvsUCI_Ribo_TA.csv")

Disease_Pericytes <- FindMarkers(data, subset.ident = "Pericytes", group.by = "state", test.use = "MAST", ident.1 = "UC-I", ident.2 = "HC-NI")
Disease_Pericytes <- filter(Disease_Pericytes, Disease_Pericytes$p_val_adj < 0.05)
Disease_Pericytes$cluster = ifelse(Disease_Pericytes$avg_logFC > 0,"UC-I","HC-NI")
Disease_Pericytes$gene = rownames(Disease_Pericytes)
UC_Iup_Pericytes = filter(Disease_Pericytes, Disease_Pericytes$cluster == "UC-I")
HC_NIup_Pericytes = filter(Disease_Pericytes, Disease_Pericytes$cluster == "HC-NI")
write.csv(UC_Iup_Pericytes, "Results/DE/UCIupvsHC_NI_Pericytes.csv")
write.csv(HC_NIup_Pericytes, "Results/DE/HC_NIupvsUCI_Pericytes.csv")

Disease_IgA <- FindMarkers(data, subset.ident = "IgA_plasma", group.by = "state", test.use = "MAST", ident.1 = "UC-I", ident.2 = "HC-NI")
Disease_IgA <- filter(Disease_IgA, Disease_IgA$p_val_adj < 0.05)
Disease_IgA$cluster = ifelse(Disease_IgA$avg_logFC > 0,"UC-I","HC-NI")
Disease_IgA$gene = rownames(Disease_IgA)
UC_Iup_IgA = filter(Disease_IgA, Disease_IgA$cluster == "UC-I")
HC_NIup_IgA = filter(Disease_IgA, Disease_IgA$cluster == "HC-NI")
write.csv(UC_Iup_IgA, "Results/DE/UCIupvsHC_NI_IgA.csv")
write.csv(HC_NIup_IgA, "Results/DE/HC_NIupvsUCI_IgA.csv")

Disease_Memory_B <- FindMarkers(data, subset.ident = "Memory_B", group.by = "state", test.use = "MAST", ident.1 = "UC-I", ident.2 = "HC-NI")
Disease_Memory_B <- filter(Disease_Memory_B, Disease_Memory_B$p_val_adj < 0.05)
Disease_Memory_B$cluster = ifelse(Disease_Memory_B$avg_logFC > 0,"UC-I","HC-NI")
Disease_Memory_B$gene = rownames(Disease_Memory_B)
UC_Iup_Memory_B = filter(Disease_Memory_B, Disease_Memory_B$cluster == "UC-I")
HC_NIup_Memory_B = filter(Disease_Memory_B, Disease_Memory_B$cluster == "HC-NI")
write.csv(UC_Iup_Memory_B, "Results/DE/UCIupvsHC_NI_Memory_B.csv")
write.csv(HC_NIup_Memory_B, "Results/DE/HC_NIupvsUCI_Memory_B.csv")

Disease_MAIT <- FindMarkers(data, subset.ident = "MAIT", group.by = "state", test.use = "MAST", ident.1 = "UC-I", ident.2 = "HC-NI")
Disease_MAIT <- filter(Disease_MAIT, Disease_MAIT$p_val_adj < 0.05)
Disease_MAIT$cluster = ifelse(Disease_MAIT$avg_logFC > 0,"UC-I","HC-NI")
Disease_MAIT$gene = rownames(Disease_MAIT)
UC_Iup_MAIT = filter(Disease_MAIT, Disease_MAIT$cluster == "UC-I")
HC_NIup_MAIT = filter(Disease_MAIT, Disease_MAIT$cluster == "HC-NI")
write.csv(UC_Iup_MAIT, "Results/DE/UCIupvsHC_NI_MAIT.csv")
write.csv(HC_NIup_MAIT, "Results/DE/HC_NIupvsUCI_MAIT.csv")

Disease_Inflam_fibro <- FindMarkers(data, subset.ident = "Inflammatory_fibroblast", group.by = "state", test.use = "MAST", ident.1 = "UC-I", ident.2 = "HC-NI")
Disease_Inflam_fibro <- filter(Disease_Inflam_fibro, Disease_Inflam_fibro$p_val_adj < 0.05)
Disease_Inflam_fibro$cluster = ifelse(Disease_Inflam_fibro$avg_logFC > 0,"UC-I","HC-NI")
Disease_Inflam_fibro$gene = rownames(Disease_Inflam_fibro)
UC_Iup_Inflam_fibro = filter(Disease_Inflam_fibro, Disease_Inflam_fibro$cluster == "UC-I")
HC_NIup_Inflam_fibro = filter(Disease_Inflam_fibro, Disease_Inflam_fibro$cluster == "HC-NI")
write.csv(UC_Iup_Inflam_fibro, "Results/DE/UCIupvsHC_NI_Inflam_fibro.csv")
write.csv(HC_NIup_Inflam_fibro, "Results/DE/HC_NIupvsUCI_Inflam_fibro.csv")

Disease_RSPO3 <- FindMarkers(data, subset.ident = "RSPO3_fibroblast", group.by = "state", test.use = "MAST", ident.1 = "UC-I", ident.2 = "HC-NI")
Disease_RSPO3 <- filter(Disease_RSPO3, Disease_RSPO3$p_val_adj < 0.05)
Disease_RSPO3$cluster = ifelse(Disease_RSPO3$avg_logFC > 0,"UC-I","HC-NI")
Disease_RSPO3$gene = rownames(Disease_RSPO3)
UC_Iup_RSPO3 = filter(Disease_RSPO3, Disease_RSPO3$cluster == "UC-I")
HC_NIup_RSPO3 = filter(Disease_RSPO3, Disease_RSPO3$cluster == "HC-NI")
write.csv(UC_Iup_RSPO3, "Results/DE/UCIupvsHC_NI_RSPO3.csv")
write.csv(HC_NIup_RSPO3, "Results/DE/HC_NIupvsUCI_RSPO3.csv")

Disease_stem <- FindMarkers(data, subset.ident = "Stem", group.by = "state", test.use = "MAST", ident.1 = "UC-I", ident.2 = "HC-NI")
Disease_stem <- filter(Disease_stem, Disease_stem$p_val_adj < 0.05)
Disease_stem$cluster = ifelse(Disease_stem$avg_logFC > 0,"UC-I","HC-NI")
Disease_stem$gene = rownames(Disease_stem)
UC_Iup_stem = filter(Disease_stem, Disease_stem$cluster == "UC-I")
HC_NIup_stem = filter(Disease_stem, Disease_stem$cluster == "HC-NI")
write.csv(UC_Iup_stem, "Results/DE/UCIupvsHC_NI_stem.csv")
write.csv(HC_NIup_stem, "Results/DE/HC_NIupvsUCI_stem.csv")

#############
#PSC-I vs HC-NI
Idents(data) <- "celltypes"
Disease3_IgG <- FindMarkers(data, subset.ident = "IgG_plasma", group.by = "state", test.use = "MAST", ident.1 = "PSC-I", ident.2 = "HC-NI")
Disease3_IgG <- filter(Disease3_IgG, Disease3_IgG$p_val_adj < 0.05)
Disease3_IgG$cluster = ifelse(Disease3_IgG$avg_logFC > 0,"PSC-I","HC-NI")
Disease3_IgG$gene = rownames(Disease3_IgG)
PSC_Iup_IgG = filter(Disease3_IgG, Disease3_IgG$cluster == "PSC-I")
HC_NIup_IgG = filter(Disease3_IgG, Disease3_IgG$cluster == "HC-NI")
write.csv(PSC_Iup_IgG, "Results/DE/PSCIupvsHC_NI_IgG.csv")
write.csv(HC_NIup_IgG, "Results/DE/HC_NIupvsPSCI_IgG.csv")

Disease3_Treg <- FindMarkers(data, subset.ident = "Treg", group.by = "state", test.use = "MAST", ident.1 = "PSC-I", ident.2 = "HC-NI")
Disease3_Treg <- filter(Disease3_Treg, Disease3_Treg$p_val_adj < 0.05)
Disease3_Treg$cluster = ifelse(Disease3_Treg$avg_logFC > 0,"PSC-I","HC-NI")
Disease3_Treg$gene = rownames(Disease3_Treg)
PSC_Iup_Treg = filter(Disease3_Treg, Disease3_Treg$cluster == "PSC-I")
HC_NIup_Treg = filter(Disease3_Treg, Disease3_Treg$cluster == "HC-NI")
write.csv(PSC_Iup_Treg, "Results/DE/PSCIupvsHC_NI_Treg.csv")
write.csv(HC_NIup_Treg, "Results/DE/HC_NIupvsPSCI_Treg.csv")

Disease3_abs_TA <- FindMarkers(data, subset.ident = "Absorptive_TA", group.by = "state", test.use = "MAST", ident.1 = "PSC-I", ident.2 = "HC-NI")
Disease3_abs_TA <- filter(Disease3_abs_TA, Disease3_abs_TA$p_val_adj < 0.05)
Disease3_abs_TA$cluster = ifelse(Disease3_abs_TA$avg_logFC > 0,"PSC-I","HC-NI")
Disease3_abs_TA$gene = rownames(Disease3_abs_TA)
PSC_Iup_abs_TA = filter(Disease3_abs_TA, Disease3_abs_TA$cluster == "PSC-I")
HC_NIup_abs_TA = filter(Disease3_abs_TA, Disease3_abs_TA$cluster == "HC-NI")
write.csv(PSC_Iup_abs_TA, "Results/DE/PSCIupvsHC_NI_abs_TA.csv")
write.csv(HC_NIup_abs_TA, "Results/DE/HC_NIupvsPSCI_abs_TA.csv")

Disease3_DUOX2_entero <- FindMarkers(data, subset.ident = "DUOX2_enterocyte", group.by = "state", test.use = "MAST", ident.1 = "PSC-I", ident.2 = "HC-NI")
Disease3_DUOX2_entero <- filter(Disease3_DUOX2_entero, Disease3_DUOX2_entero$p_val_adj < 0.05)
Disease3_DUOX2_entero$cluster = ifelse(Disease3_DUOX2_entero$avg_logFC > 0,"PSC-I","HC-NI")
Disease3_DUOX2_entero$gene = rownames(Disease3_DUOX2_entero)
PSC_Iup_DUOX2_entero = filter(Disease3_DUOX2_entero, Disease3_DUOX2_entero$cluster == "PSC-I")
HC_NIup_DUOX2_entero = filter(Disease3_DUOX2_entero, Disease3_DUOX2_entero$cluster == "HC-NI")
write.csv(PSC_Iup_DUOX2_entero, "Results/DE/PSCIupvsHC_NI_DUOX2_entero.csv")
write.csv(HC_NIup_DUOX2_entero, "Results/DE/HC_NIupvsPSCI_DUOX2_entero.csv")

Disease3_Cycling_TA <- FindMarkers(data, subset.ident = "Cycling_TA", group.by = "state", test.use = "MAST", ident.1 = "PSC-I", ident.2 = "HC-NI")
Disease3_Cycling_TA <- filter(Disease3_Cycling_TA, Disease3_Cycling_TA$p_val_adj < 0.05)
Disease3_Cycling_TA$cluster = ifelse(Disease3_Cycling_TA$avg_logFC > 0,"PSC-I","HC-NI")
Disease3_Cycling_TA$gene = rownames(Disease3_Cycling_TA)
PSC_Iup_Cycling_TA = filter(Disease3_Cycling_TA, Disease3_Cycling_TA$cluster == "PSC-I")
HC_NIup_Cycling_TA = filter(Disease3_Cycling_TA, Disease3_Cycling_TA$cluster == "HC-NI")
write.csv(PSC_Iup_Cycling_TA, "Results/DE/PSCIupvsHC_NI_Cycling_TA.csv")
write.csv(HC_NIup_Cycling_TA, "Results/DE/HC_NIupvsPSCI_Cycling_TA.csv")

Disease3_BEST4_entero <- FindMarkers(data, subset.ident = "BEST4_enterocyte", group.by = "state", test.use = "MAST", ident.1 = "PSC-I", ident.2 = "HC-NI")
Disease3_BEST4_entero <- filter(Disease3_BEST4_entero, Disease3_BEST4_entero$p_val_adj < 0.05)
Disease3_BEST4_entero$cluster = ifelse(Disease3_BEST4_entero$avg_logFC > 0,"PSC-I","HC-NI")
Disease3_BEST4_entero$gene = rownames(Disease3_BEST4_entero)
PSC_Iup_BEST4_entero = filter(Disease3_BEST4_entero, Disease3_BEST4_entero$cluster == "PSC-I")
HC_NIup_BEST4_entero = filter(Disease3_BEST4_entero, Disease3_BEST4_entero$cluster == "HC-NI")
write.csv(PSC_Iup_BEST4_entero, "Results/DE/PSCIupvsHC_NI_BEST4_entero.csv")
write.csv(HC_NIup_BEST4_entero, "Results/DE/HC_NIupvsPSCI_BEST4_entero.csv")

Disease3_PLCG2_TA <- FindMarkers(data, subset.ident = "PLCG2_TA", group.by = "state", test.use = "MAST", ident.1 = "PSC-I", ident.2 = "HC-NI")
Disease3_PLCG2_TA <- filter(Disease3_PLCG2_TA, Disease3_PLCG2_TA$p_val_adj < 0.05)
Disease3_PLCG2_TA$cluster = ifelse(Disease3_PLCG2_TA$avg_logFC > 0,"PSC-I","HC-NI")
Disease3_PLCG2_TA$gene = rownames(Disease3_PLCG2_TA)
PSC_Iup_PLCG2_TA = filter(Disease3_PLCG2_TA, Disease3_PLCG2_TA$cluster == "PSC-I")
HC_NIup_PLCG2_TA = filter(Disease3_PLCG2_TA, Disease3_PLCG2_TA$cluster == "HC-NI")
write.csv(PSC_Iup_PLCG2_TA, "Results/DE/PSCIupvsHC_NI_PLCG2_TA.csv")
write.csv(HC_NIup_PLCG2_TA, "Results/DE/HC_NIupvsPSCI_PLCG2_TA.csv")

Disease3_Ribo_TA <- FindMarkers(data, subset.ident = "Ribo_TA", group.by = "state", test.use = "MAST", ident.1 = "PSC-I", ident.2 = "HC-NI")
Disease3_Ribo_TA <- filter(Disease3_Ribo_TA, Disease3_Ribo_TA$p_val_adj < 0.05)
Disease3_Ribo_TA$cluster = ifelse(Disease3_Ribo_TA$avg_logFC > 0,"PSC-I","HC-NI")
Disease3_Ribo_TA$gene = rownames(Disease3_Ribo_TA)
PSC_Iup_Ribo_TA = filter(Disease3_Ribo_TA, Disease3_Ribo_TA$cluster == "PSC-I")
HC_NIup_Ribo_TA = filter(Disease3_Ribo_TA, Disease3_Ribo_TA$cluster == "HC-NI")
write.csv(PSC_Iup_Ribo_TA, "Results/DE/PSCIupvsHC_NI_Ribo_TA.csv")
write.csv(HC_NIup_Ribo_TA, "Results/DE/HC_NIupvsPSCI_Ribo_TA.csv")

Disease3_Pericytes <- FindMarkers(data, subset.ident = "Pericytes", group.by = "state", test.use = "MAST", ident.1 = "PSC-I", ident.2 = "HC-NI")
Disease3_Pericytes <- filter(Disease3_Pericytes, Disease3_Pericytes$p_val_adj < 0.05)
Disease3_Pericytes$cluster = ifelse(Disease3_Pericytes$avg_logFC > 0,"PSC-I","HC-NI")
Disease3_Pericytes$gene = rownames(Disease3_Pericytes)
PSC_Iup_Pericytes = filter(Disease3_Pericytes, Disease3_Pericytes$cluster == "PSC-I")
HC_NIup_Pericytes = filter(Disease3_Pericytes, Disease3_Pericytes$cluster == "HC-NI")
write.csv(PSC_Iup_Pericytes, "Results/DE/PSCIupvsHC_NI_Pericytes.csv")
write.csv(HC_NIup_Pericytes, "Results/DE/HC_NIupvsPSCI_Pericytes.csv")

Disease3_PLCG2_TA <- FindMarkers(data, subset.ident = "PLCG2_TA", group.by = "state", test.use = "MAST", ident.1 = "PSC-I", ident.2 = "HC-NI")
Disease3_PLCG2_TA <- filter(Disease3_PLCG2_TA, Disease3_PLCG2_TA$p_val_adj < 0.05)
Disease3_PLCG2_TA$cluster = ifelse(Disease3_PLCG2_TA$avg_logFC > 0,"PSC-I","HC-NI")
Disease3_PLCG2_TA$gene = rownames(Disease3_PLCG2_TA)
PSC_Iup_PLCG2_TA = filter(Disease3_PLCG2_TA, Disease3_PLCG2_TA$cluster == "PSC-I")
HC_NIup_PLCG2_TA = filter(Disease3_PLCG2_TA, Disease3_PLCG2_TA$cluster == "HC-NI")
write.csv(PSC_Iup_PLCG2_TA, "Results/DE/PSCIupvsHC_NI_PLCG2_TA.csv")
write.csv(HC_NIup_PLCG2_TA, "Results/DE/HC_NIupvsPSCI_PLCG2_TA.csv")

Disease3_Ribo_TA <- FindMarkers(data, subset.ident = "Ribo_TA", group.by = "state", test.use = "MAST", ident.1 = "PSC-I", ident.2 = "HC-NI")
Disease3_Ribo_TA <- filter(Disease3_Ribo_TA, Disease3_Ribo_TA$p_val_adj < 0.05)
Disease3_Ribo_TA$cluster = ifelse(Disease3_Ribo_TA$avg_logFC > 0,"PSC-I","HC-NI")
Disease3_Ribo_TA$gene = rownames(Disease3_Ribo_TA)
PSC_Iup_Ribo_TA = filter(Disease3_Ribo_TA, Disease3_Ribo_TA$cluster == "PSC-I")
HC_NIup_Ribo_TA = filter(Disease3_Ribo_TA, Disease3_Ribo_TA$cluster == "HC-NI")
write.csv(PSC_Iup_Ribo_TA, "Results/DE/PSCIupvsHC_NI_Ribo_TA.csv")
write.csv(HC_NIup_Ribo_TA, "Results/DE/HC_NIupvsPSCI_Ribo_TA.csv")

Disease3_Pericytes <- FindMarkers(data, subset.ident = "Pericytes", group.by = "state", test.use = "MAST", ident.1 = "PSC-I", ident.2 = "HC-NI")
Disease3_Pericytes <- filter(Disease3_Pericytes, Disease3_Pericytes$p_val_adj < 0.05)
Disease3_Pericytes$cluster = ifelse(Disease3_Pericytes$avg_logFC > 0,"PSC-I","HC-NI")
Disease3_Pericytes$gene = rownames(Disease3_Pericytes)
PSC_Iup_Pericytes = filter(Disease3_Pericytes, Disease3_Pericytes$cluster == "PSC-I")
HC_NIup_Pericytes = filter(Disease3_Pericytes, Disease3_Pericytes$cluster == "HC-NI")
write.csv(PSC_Iup_Pericytes, "Results/DE/PSCIupvsHC_NI_Pericytes.csv")
write.csv(HC_NIup_Pericytes, "Results/DE/HC_NIupvsPSCI_Pericytes.csv")

Disease3_IgA <- FindMarkers(data, subset.ident = "IgA_plasma", group.by = "state", test.use = "MAST", ident.1 = "PSC-I", ident.2 = "HC-NI")
Disease3_IgA <- filter(Disease3_IgA, Disease3_IgA$p_val_adj < 0.05)
Disease3_IgA$cluster = ifelse(Disease3_IgA$avg_logFC > 0,"PSC-I","HC-NI")
Disease3_IgA$gene = rownames(Disease3_IgA)
PSC_Iup_IgA = filter(Disease3_IgA, Disease3_IgA$cluster == "PSC-I")
HC_NIup_IgA = filter(Disease3_IgA, Disease3_IgA$cluster == "HC-NI")
write.csv(PSC_Iup_IgA, "Results/DE/PSCIupvsHC_NI_IgA.csv")
write.csv(HC_NIup_IgA, "Results/DE/HC_NIupvsPSCI_IgA.csv")

Disease3_Memory_B <- FindMarkers(data, subset.ident = "Memory_B", group.by = "state", test.use = "MAST", ident.1 = "PSC-I", ident.2 = "HC-NI")
Disease3_Memory_B <- filter(Disease3_Memory_B, Disease3_Memory_B$p_val_adj < 0.05)
Disease3_Memory_B$cluster = ifelse(Disease3_Memory_B$avg_logFC > 0,"PSC-I","HC-NI")
Disease3_Memory_B$gene = rownames(Disease3_Memory_B)
PSC_Iup_Memory_B = filter(Disease3_Memory_B, Disease3_Memory_B$cluster == "PSC-I")
HC_NIup_Memory_B = filter(Disease3_Memory_B, Disease3_Memory_B$cluster == "HC-NI")
write.csv(PSC_Iup_Memory_B, "Results/DE/PSCIupvsHC_NI_Memory_B.csv")
write.csv(HC_NIup_Memory_B, "Results/DE/HC_NIupvsPSCI_Memory_B.csv")

Disease3_MAIT <- FindMarkers(data, subset.ident = "MAIT", group.by = "state", test.use = "MAST", ident.1 = "PSC-I", ident.2 = "HC-NI")
Disease3_MAIT <- filter(Disease3_MAIT, Disease3_MAIT$p_val_adj < 0.05)
Disease3_MAIT$cluster = ifelse(Disease3_MAIT$avg_logFC > 0,"PSC-I","HC-NI")
Disease3_MAIT$gene = rownames(Disease3_MAIT)
PSC_Iup_MAIT = filter(Disease3_MAIT, Disease3_MAIT$cluster == "PSC-I")
HC_NIup_MAIT = filter(Disease3_MAIT, Disease3_MAIT$cluster == "HC-NI")
write.csv(PSC_Iup_MAIT, "Results/DE/PSCIupvsHC_NI_MAIT.csv")
write.csv(HC_NIup_MAIT, "Results/DE/HC_NIupvsPSCI_MAIT.csv")

Disease3_Inflam_fibro <- FindMarkers(data, subset.ident = "Inflammatory_fibroblast", group.by = "state", test.use = "MAST", ident.1 = "PSC-I", ident.2 = "HC-NI")
Disease3_Inflam_fibro <- filter(Disease3_Inflam_fibro, Disease3_Inflam_fibro$p_val_adj < 0.05)
Disease3_Inflam_fibro$cluster = ifelse(Disease3_Inflam_fibro$avg_logFC > 0,"PSC-I","HC-NI")
Disease3_Inflam_fibro$gene = rownames(Disease3_Inflam_fibro)
PSC_Iup_Inflam_fibro = filter(Disease3_Inflam_fibro, Disease3_Inflam_fibro$cluster == "PSC-I")
HC_NIup_Inflam_fibro = filter(Disease3_Inflam_fibro, Disease3_Inflam_fibro$cluster == "HC-NI")
write.csv(PSC_Iup_Inflam_fibro, "Results/DE/PSCIupvsHC_NI_Inflam_fibro.csv")
write.csv(HC_NIup_Inflam_fibro, "Results/DE/HC_NIupvsPSCI_Inflam_fibro.csv")

Disease3_RSPO3 <- FindMarkers(data, subset.ident = "RSPO3_fibroblast", group.by = "state", test.use = "MAST", ident.1 = "PSC-I", ident.2 = "HC-NI")
Disease3_RSPO3 <- filter(Disease3_RSPO3, Disease3_RSPO3$p_val_adj < 0.05)
Disease3_RSPO3$cluster = ifelse(Disease3_RSPO3$avg_logFC > 0,"PSC-I","HC-NI")
Disease3_RSPO3$gene = rownames(Disease3_RSPO3)
PSC_Iup_RSPO3 = filter(Disease3_RSPO3, Disease3_RSPO3$cluster == "PSC-I")
HC_NIup_RSPO3 = filter(Disease3_RSPO3, Disease3_RSPO3$cluster == "HC-NI")
write.csv(PSC_Iup_RSPO3, "Results/DE/PSCIupvsHC_NI_RSPO3.csv")
write.csv(HC_NIup_RSPO3, "Results/DE/HC_NIupvsPSCI_RSPO3.csv")

Disease3_stem <- FindMarkers(data, subset.ident = "Stem", group.by = "state", test.use = "MAST", ident.1 = "PSC-I", ident.2 = "HC-NI")
Disease3_stem <- filter(Disease3_stem, Disease3_stem$p_val_adj < 0.05)
Disease3_stem$cluster = ifelse(Disease3_stem$avg_logFC > 0,"PSC-I","HC-NI")
Disease3_stem$gene = rownames(Disease3_stem)
PSC_Iup_stem = filter(Disease3_stem, Disease3_stem$cluster == "PSC-I")
HC_NIup_stem = filter(Disease3_stem, Disease3_stem$cluster == "HC-NI")
write.csv(PSC_Iup_stem, "Results/DE/PSCIupvsHC_NI_stem.csv")
write.csv(HC_NIup_stem, "Results/DE/HC_NIupvsPSCI_stem.csv")

##############
# PSC-NI vs HC-NI
Idents(data) <- "celltypes"
Disease1_IgG <- FindMarkers(data, subset.ident = "IgG_plasma", group.by = "state", test.use = "MAST", ident.1 = "PSC-NI", ident.2 = "HC-NI")
Disease1_IgG <- filter(Disease1_IgG, Disease1_IgG$p_val_adj < 0.05)
Disease1_IgG$cluster = ifelse(Disease1_IgG$avg_logFC > 0,"PSC-NI","HC-NI")
Disease1_IgG$gene = rownames(Disease1_IgG)
PSC_NIup_IgG = filter(Disease1_IgG, Disease1_IgG$cluster == "PSC-NI")
HC_NIup_IgG = filter(Disease1_IgG, Disease1_IgG$cluster == "HC-NI")
write.csv(PSC_NIup_IgG, "Results/DE/PSCNIupvsHC_NI_IgG.csv")
write.csv(HC_NIup_IgG, "Results/DE/HC_NIupvsPSCNI_IgG.csv")

Disease1_Treg <- FindMarkers(data, subset.ident = "Treg", group.by = "state", test.use = "MAST", ident.1 = "PSC-NI", ident.2 = "HC-NI")
Disease1_Treg <- filter(Disease1_Treg, Disease1_Treg$p_val_adj < 0.05)
Disease1_Treg$cluster = ifelse(Disease1_Treg$avg_logFC > 0,"PSC-NI","HC-NI")
Disease1_Treg$gene = rownames(Disease1_Treg)
PSC_NIup_Treg = filter(Disease1_Treg, Disease1_Treg$cluster == "PSC-NI")
HC_NIup_Treg = filter(Disease1_Treg, Disease1_Treg$cluster == "HC-NI")
write.csv(PSC_NIup_Treg, "Results/DE/PSCNIupvsHC_NI_Treg.csv")
write.csv(HC_NIup_Treg, "Results/DE/HC_NIupvsPSCNI_Treg.csv")

Disease1_abs_TA <- FindMarkers(data, subset.ident = "Absorptive_TA", group.by = "state", test.use = "MAST", ident.1 = "PSC-NI", ident.2 = "HC-NI")
Disease1_abs_TA <- filter(Disease1_abs_TA, Disease1_abs_TA$p_val_adj < 0.05)
Disease1_abs_TA$cluster = ifelse(Disease1_abs_TA$avg_logFC > 0,"PSC-NI","HC-NI")
Disease1_abs_TA$gene = rownames(Disease1_abs_TA)
PSC_NIup_abs_TA = filter(Disease1_abs_TA, Disease1_abs_TA$cluster == "PSC-NI")
HC_NIup_abs_TA = filter(Disease1_abs_TA, Disease1_abs_TA$cluster == "HC-NI")
write.csv(PSC_NIup_abs_TA, "Results/DE/PSCNIupvsHC_NI_abs_TA.csv")
write.csv(HC_NIup_abs_TA, "Results/DE/HC_NIupvsPSCNI_abs_TA.csv")

Disease1_DUOX2_entero <- FindMarkers(data, subset.ident = "DUOX2_enterocyte", group.by = "state", test.use = "MAST", ident.1 = "PSC-NI", ident.2 = "HC-NI")
Disease1_DUOX2_entero <- filter(Disease1_DUOX2_entero, Disease1_DUOX2_entero$p_val_adj < 0.05)
Disease1_DUOX2_entero$cluster = ifelse(Disease1_DUOX2_entero$avg_logFC > 0,"PSC-NI","HC-NI")
Disease1_DUOX2_entero$gene = rownames(Disease1_DUOX2_entero)
PSC_NIup_DUOX2_entero = filter(Disease1_DUOX2_entero, Disease1_DUOX2_entero$cluster == "PSC-NI")
HC_NIup_DUOX2_entero = filter(Disease1_DUOX2_entero, Disease1_DUOX2_entero$cluster == "HC-NI")
write.csv(PSC_NIup_DUOX2_entero, "Results/DE/PSCNIupvsHC_NI_DUOX2_entero.csv")
write.csv(HC_NIup_DUOX2_entero, "Results/DE/HC_NIupvsPSCNI_DUOX2_entero.csv")

Disease1_Cycling_TA <- FindMarkers(data, subset.ident = "Cycling_TA", group.by = "state", test.use = "MAST", ident.1 = "PSC-NI", ident.2 = "HC-NI")
Disease1_Cycling_TA <- filter(Disease1_Cycling_TA, Disease1_Cycling_TA$p_val_adj < 0.05)
Disease1_Cycling_TA$cluster = ifelse(Disease1_Cycling_TA$avg_logFC > 0,"PSC-NI","HC-NI")
Disease1_Cycling_TA$gene = rownames(Disease1_Cycling_TA)
PSC_NIup_Cycling_TA = filter(Disease1_Cycling_TA, Disease1_Cycling_TA$cluster == "PSC-NI")
HC_NIup_Cycling_TA = filter(Disease1_Cycling_TA, Disease1_Cycling_TA$cluster == "HC-NI")
write.csv(PSC_NIup_Cycling_TA, "Results/DE/PSCNIupvsHC_NI_Cycling_TA.csv")
write.csv(HC_NIup_Cycling_TA, "Results/DE/HC_NIupvsPSCNI_Cycling_TA.csv")

Disease1_BEST4_entero <- FindMarkers(data, subset.ident = "BEST4_enterocyte", group.by = "state", test.use = "MAST", ident.1 = "PSC-NI", ident.2 = "HC-NI")
Disease1_BEST4_entero <- filter(Disease1_BEST4_entero, Disease1_BEST4_entero$p_val_adj < 0.05)
Disease1_BEST4_entero$cluster = ifelse(Disease1_BEST4_entero$avg_logFC > 0,"PSC-NI","HC-NI")
Disease1_BEST4_entero$gene = rownames(Disease1_BEST4_entero)
PSC_NIup_BEST4_entero = filter(Disease1_BEST4_entero, Disease1_BEST4_entero$cluster == "PSC-NI")
HC_NIup_BEST4_entero = filter(Disease1_BEST4_entero, Disease1_BEST4_entero$cluster == "HC-NI")
write.csv(PSC_NIup_BEST4_entero, "Results/DE/PSCNIupvsHC_NI_BEST4_entero.csv")
write.csv(HC_NIup_BEST4_entero, "Results/DE/HC_NIupvsPSCNI_BEST4_entero.csv")

Disease1_PLCG2_TA <- FindMarkers(data, subset.ident = "PLCG2_TA", group.by = "state", test.use = "MAST", ident.1 = "PSC-NI", ident.2 = "HC-NI")
Disease1_PLCG2_TA <- filter(Disease1_PLCG2_TA, Disease1_PLCG2_TA$p_val_adj < 0.05)
Disease1_PLCG2_TA$cluster = ifelse(Disease1_PLCG2_TA$avg_logFC > 0,"PSC-NI","HC-NI")
Disease1_PLCG2_TA$gene = rownames(Disease1_PLCG2_TA)
PSC_NIup_PLCG2_TA = filter(Disease1_PLCG2_TA, Disease1_PLCG2_TA$cluster == "PSC-NI")
HC_NIup_PLCG2_TA = filter(Disease1_PLCG2_TA, Disease1_PLCG2_TA$cluster == "HC-NI")
write.csv(PSC_NIup_PLCG2_TA, "Results/DE/PSCNIupvsHC_NI_PLCG2_TA.csv")
write.csv(HC_NIup_PLCG2_TA, "Results/DE/HC_NIupvsPSCNI_PLCG2_TA.csv")

Disease1_Ribo_TA <- FindMarkers(data, subset.ident = "Ribo_TA", group.by = "state", test.use = "MAST", ident.1 = "PSC-NI", ident.2 = "HC-NI")
Disease1_Ribo_TA <- filter(Disease1_Ribo_TA, Disease1_Ribo_TA$p_val_adj < 0.05)
Disease1_Ribo_TA$cluster = ifelse(Disease1_Ribo_TA$avg_logFC > 0,"PSC-NI","HC-NI")
Disease1_Ribo_TA$gene = rownames(Disease1_Ribo_TA)
PSC_NIup_Ribo_TA = filter(Disease1_Ribo_TA, Disease1_Ribo_TA$cluster == "PSC-NI")
HC_NIup_Ribo_TA = filter(Disease1_Ribo_TA, Disease1_Ribo_TA$cluster == "HC-NI")
write.csv(PSC_NIup_Ribo_TA, "Results/DE/PSCNIupvsHC_NI_Ribo_TA.csv")
write.csv(HC_NIup_Ribo_TA, "Results/DE/HC_NIupvsPSCNI_Ribo_TA.csv")

Disease1_Pericytes <- FindMarkers(data, subset.ident = "Pericytes", group.by = "state", test.use = "MAST", ident.1 = "PSC-NI", ident.2 = "HC-NI")
Disease1_Pericytes <- filter(Disease1_Pericytes, Disease1_Pericytes$p_val_adj < 0.05)
Disease1_Pericytes$cluster = ifelse(Disease1_Pericytes$avg_logFC > 0,"PSC-NI","HC-NI")
Disease1_Pericytes$gene = rownames(Disease1_Pericytes)
PSC_NIup_Pericytes = filter(Disease1_Pericytes, Disease1_Pericytes$cluster == "PSC-NI")
HC_NIup_Pericytes = filter(Disease1_Pericytes, Disease1_Pericytes$cluster == "HC-NI")
write.csv(PSC_NIup_Pericytes, "Results/DE/PSCNIupvsHC_NI_Pericytes.csv")
write.csv(HC_NIup_Pericytes, "Results/DE/HC_NIupvsPSCNI_Pericytes.csv")

Disease1_PLCG2_TA <- FindMarkers(data, subset.ident = "PLCG2_TA", group.by = "state", test.use = "MAST", ident.1 = "PSC-NI", ident.2 = "HC-NI")
Disease1_PLCG2_TA <- filter(Disease1_PLCG2_TA, Disease1_PLCG2_TA$p_val_adj < 0.05)
Disease1_PLCG2_TA$cluster = ifelse(Disease1_PLCG2_TA$avg_logFC > 0,"PSC-NI","HC-NI")
Disease1_PLCG2_TA$gene = rownames(Disease1_PLCG2_TA)
PSC_NIup_PLCG2_TA = filter(Disease1_PLCG2_TA, Disease1_PLCG2_TA$cluster == "PSC-NI")
HC_NIup_PLCG2_TA = filter(Disease1_PLCG2_TA, Disease1_PLCG2_TA$cluster == "HC-NI")
write.csv(PSC_NIup_PLCG2_TA, "Results/DE/PSCNIupvsHC_NI_PLCG2_TA.csv")
write.csv(HC_NIup_PLCG2_TA, "Results/DE/HC_NIupvsPSCNI_PLCG2_TA.csv")

Disease1_Ribo_TA <- FindMarkers(data, subset.ident = "Ribo_TA", group.by = "state", test.use = "MAST", ident.1 = "PSC-NI", ident.2 = "HC-NI")
Disease1_Ribo_TA <- filter(Disease1_Ribo_TA, Disease1_Ribo_TA$p_val_adj < 0.05)
Disease1_Ribo_TA$cluster = ifelse(Disease1_Ribo_TA$avg_logFC > 0,"PSC-NI","HC-NI")
Disease1_Ribo_TA$gene = rownames(Disease1_Ribo_TA)
PSC_NIup_Ribo_TA = filter(Disease1_Ribo_TA, Disease1_Ribo_TA$cluster == "PSC-NI")
HC_NIup_Ribo_TA = filter(Disease1_Ribo_TA, Disease1_Ribo_TA$cluster == "HC-NI")
write.csv(PSC_NIup_Ribo_TA, "Results/DE/PSCNIupvsHC_NI_Ribo_TA.csv")
write.csv(HC_NIup_Ribo_TA, "Results/DE/HC_NIupvsPSCNI_Ribo_TA.csv")

Disease1_Pericytes <- FindMarkers(data, subset.ident = "Pericytes", group.by = "state", test.use = "MAST", ident.1 = "PSC-NI", ident.2 = "HC-NI")
Disease1_Pericytes <- filter(Disease1_Pericytes, Disease1_Pericytes$p_val_adj < 0.05)
Disease1_Pericytes$cluster = ifelse(Disease1_Pericytes$avg_logFC > 0,"PSC-NI","HC-NI")
Disease1_Pericytes$gene = rownames(Disease1_Pericytes)
PSC_NIup_Pericytes = filter(Disease1_Pericytes, Disease1_Pericytes$cluster == "PSC-NI")
HC_NIup_Pericytes = filter(Disease1_Pericytes, Disease1_Pericytes$cluster == "HC-NI")
write.csv(PSC_NIup_Pericytes, "Results/DE/PSCNIupvsHC_NI_Pericytes.csv")
write.csv(HC_NIup_Pericytes, "Results/DE/HC_NIupvsPSCNI_Pericytes.csv")

Disease1_IgA <- FindMarkers(data, subset.ident = "IgA_plasma", group.by = "state", test.use = "MAST", ident.1 = "PSC-NI", ident.2 = "HC-NI")
Disease1_IgA <- filter(Disease1_IgA, Disease1_IgA$p_val_adj < 0.05)
Disease1_IgA$cluster = ifelse(Disease1_IgA$avg_logFC > 0,"PSC-NI","HC-NI")
Disease1_IgA$gene = rownames(Disease1_IgA)
PSC_NIup_IgA = filter(Disease1_IgA, Disease1_IgA$cluster == "PSC-NI")
HC_NIup_IgA = filter(Disease1_IgA, Disease1_IgA$cluster == "HC-NI")
write.csv(PSC_NIup_IgA, "Results/DE/PSCNIupvsHC_NI_IgA.csv")
write.csv(HC_NIup_IgA, "Results/DE/HC_NIupvsPSCNI_IgA.csv")

Disease1_Memory_B <- FindMarkers(data, subset.ident = "Memory_B", group.by = "state", test.use = "MAST", ident.1 = "PSC-NI", ident.2 = "HC-NI")
Disease1_Memory_B <- filter(Disease1_Memory_B, Disease1_Memory_B$p_val_adj < 0.05)
Disease1_Memory_B$cluster = ifelse(Disease1_Memory_B$avg_logFC > 0,"PSC-NI","HC-NI")
Disease1_Memory_B$gene = rownames(Disease1_Memory_B)
PSC_NIup_Memory_B = filter(Disease1_Memory_B, Disease1_Memory_B$cluster == "PSC-NI")
HC_NIup_Memory_B = filter(Disease1_Memory_B, Disease1_Memory_B$cluster == "HC-NI")
write.csv(PSC_NIup_Memory_B, "Results/DE/PSCNIupvsHC_NI_Memory_B.csv")
write.csv(HC_NIup_Memory_B, "Results/DE/HC_NIupvsPSCNI_Memory_B.csv")

Disease1_MAIT <- FindMarkers(data, subset.ident = "MAIT", group.by = "state", test.use = "MAST", ident.1 = "PSC-NI", ident.2 = "HC-NI")
Disease1_MAIT <- filter(Disease1_MAIT, Disease1_MAIT$p_val_adj < 0.05)
Disease1_MAIT$cluster = ifelse(Disease1_MAIT$avg_logFC > 0,"PSC-NI","HC-NI")
Disease1_MAIT$gene = rownames(Disease1_MAIT)
PSC_NIup_MAIT = filter(Disease1_MAIT, Disease1_MAIT$cluster == "PSC-NI")
HC_NIup_MAIT = filter(Disease1_MAIT, Disease1_MAIT$cluster == "HC-NI")
write.csv(PSC_NIup_MAIT, "Results/DE/PSCNIupvsHC_NI_MAIT.csv")
write.csv(HC_NIup_MAIT, "Results/DE/HC_NIupvsPSCNI_MAIT.csv")

Disease1_Inflam_fibro <- FindMarkers(data, subset.ident = "Inflammatory_fibroblast", group.by = "state", test.use = "MAST", ident.1 = "PSC-NI", ident.2 = "HC-NI")
Disease1_Inflam_fibro <- filter(Disease1_Inflam_fibro, Disease1_Inflam_fibro$p_val_adj < 0.05)
Disease1_Inflam_fibro$cluster = ifelse(Disease1_Inflam_fibro$avg_logFC > 0,"PSC-NI","HC-NI")
Disease1_Inflam_fibro$gene = rownames(Disease1_Inflam_fibro)
PSC_NIup_Inflam_fibro = filter(Disease1_Inflam_fibro, Disease1_Inflam_fibro$cluster == "PSC-NI")
HC_NIup_Inflam_fibro = filter(Disease1_Inflam_fibro, Disease1_Inflam_fibro$cluster == "HC-NI")
write.csv(PSC_NIup_Inflam_fibro, "Results/DE/PSCNIupvsHC_NI_Inflam_fibro.csv")
write.csv(HC_NIup_Inflam_fibro, "Results/DE/HC_NIupvsPSCNI_Inflam_fibro.csv")

Disease1_RSPO3 <- FindMarkers(data, subset.ident = "RSPO3_fibroblast", group.by = "state", test.use = "MAST", ident.1 = "PSC-NI", ident.2 = "HC-NI")
Disease1_RSPO3 <- filter(Disease1_RSPO3, Disease1_RSPO3$p_val_adj < 0.05)
Disease1_RSPO3$cluster = ifelse(Disease1_RSPO3$avg_logFC > 0,"PSC-NI","HC-NI")
Disease1_RSPO3$gene = rownames(Disease1_RSPO3)
PSC_NIup_RSPO3 = filter(Disease1_RSPO3, Disease1_RSPO3$cluster == "PSC-NI")
HC_NIup_RSPO3 = filter(Disease1_RSPO3, Disease1_RSPO3$cluster == "HC-NI")
write.csv(PSC_NIup_RSPO3, "Results/DE/PSCNIupvsHC_NI_RSPO3.csv")
write.csv(HC_NIup_RSPO3, "Results/DE/HC_NIupvsPSCNI_RSPO3.csv")

Disease1_stem <- FindMarkers(data, subset.ident = "Stem", group.by = "state", test.use = "MAST", ident.1 = "PSC-NI", ident.2 = "HC-NI")
Disease1_stem <- filter(Disease1_stem, Disease1_stem$p_val_adj < 0.05)
Disease1_stem$cluster = ifelse(Disease1_stem$avg_logFC > 0,"PSC-NI","HC-NI")
Disease1_stem$gene = rownames(Disease1_stem)
PSC_NIup_stem = filter(Disease1_stem, Disease1_stem$cluster == "PSC-NI")
HC_NIup_stem = filter(Disease1_stem, Disease1_stem$cluster == "HC-NI")
write.csv(PSC_NIup_stem, "Results/DE/PSCNIupvsHC_NI_stem.csv")
write.csv(HC_NIup_stem, "Results/DE/HC_NIupvsPSCNI_stem.csv")

########
UC-NI vs HC
Idents(data) <- "celltypes"
Disease2_IgG <- FindMarkers(data, subset.ident = "IgG_plasma", group.by = "state", test.use = "MAST", ident.1 = "UC-NI", ident.2 = "HC-NI")
Disease2_IgG <- filter(Disease2_IgG, Disease2_IgG$p_val_adj < 0.05)
Disease2_IgG$cluster = ifelse(Disease2_IgG$avg_logFC > 0,"UC-NI","HC-NI")
Disease2_IgG$gene = rownames(Disease2_IgG)
UC_NIup_IgG = filter(Disease2_IgG, Disease2_IgG$cluster == "UC-NI")
HC_NIup_IgG = filter(Disease2_IgG, Disease2_IgG$cluster == "HC-NI")
write.csv(UC_NIup_IgG, "Results/DE/UCNIupvsHC_NI_IgG.csv")
write.csv(HC_NIup_IgG, "Results/DE/HC_NIupvsUCNI_IgG.csv")

Disease2_Treg <- FindMarkers(data, subset.ident = "Treg", group.by = "state", test.use = "MAST", ident.1 = "UC-NI", ident.2 = "HC-NI")
Disease2_Treg <- filter(Disease2_Treg, Disease2_Treg$p_val_adj < 0.05)
Disease2_Treg$cluster = ifelse(Disease2_Treg$avg_logFC > 0,"UC-NI","HC-NI")
Disease2_Treg$gene = rownames(Disease2_Treg)
UC_NIup_Treg = filter(Disease2_Treg, Disease2_Treg$cluster == "UC-NI")
HC_NIup_Treg = filter(Disease2_Treg, Disease2_Treg$cluster == "HC-NI")
write.csv(UC_NIup_Treg, "Results/DE/UCNIupvsHC_NI_Treg.csv")
write.csv(HC_NIup_Treg, "Results/DE/HC_NIupvsUCNI_Treg.csv")

Disease2_abs_TA <- FindMarkers(data, subset.ident = "Absorptive_TA", group.by = "state", test.use = "MAST", ident.1 = "UC-NI", ident.2 = "HC-NI")
Disease2_abs_TA <- filter(Disease2_abs_TA, Disease2_abs_TA$p_val_adj < 0.05)
Disease2_abs_TA$cluster = ifelse(Disease2_abs_TA$avg_logFC > 0,"UC-NI","HC-NI")
Disease2_abs_TA$gene = rownames(Disease2_abs_TA)
UC_NIup_abs_TA = filter(Disease2_abs_TA, Disease2_abs_TA$cluster == "UC-NI")
HC_NIup_abs_TA = filter(Disease2_abs_TA, Disease2_abs_TA$cluster == "HC-NI")
write.csv(UC_NIup_abs_TA, "Results/DE/UCNIupvsHC_NI_abs_TA.csv")
write.csv(HC_NIup_abs_TA, "Results/DE/HC_NIupvsUCNI_abs_TA.csv")

Disease2_DUOX2_entero <- FindMarkers(data, subset.ident = "DUOX2_enterocyte", group.by = "state", test.use = "MAST", ident.1 = "UC-NI", ident.2 = "HC-NI")
Disease2_DUOX2_entero <- filter(Disease2_DUOX2_entero, Disease2_DUOX2_entero$p_val_adj < 0.05)
Disease2_DUOX2_entero$cluster = ifelse(Disease2_DUOX2_entero$avg_logFC > 0,"UC-NI","HC-NI")
Disease2_DUOX2_entero$gene = rownames(Disease2_DUOX2_entero)
UC_NIup_DUOX2_entero = filter(Disease2_DUOX2_entero, Disease2_DUOX2_entero$cluster == "UC-NI")
HC_NIup_DUOX2_entero = filter(Disease2_DUOX2_entero, Disease2_DUOX2_entero$cluster == "HC-NI")
write.csv(UC_NIup_DUOX2_entero, "Results/DE/UCNIupvsHC_NI_DUOX2_entero.csv")
write.csv(HC_NIup_DUOX2_entero, "Results/DE/HC_NIupvsUCNI_DUOX2_entero.csv")

Disease2_Cycling_TA <- FindMarkers(data, subset.ident = "Cycling_TA", group.by = "state", test.use = "MAST", ident.1 = "UC-NI", ident.2 = "HC-NI")
Disease2_Cycling_TA <- filter(Disease2_Cycling_TA, Disease2_Cycling_TA$p_val_adj < 0.05)
Disease2_Cycling_TA$cluster = ifelse(Disease2_Cycling_TA$avg_logFC > 0,"UC-NI","HC-NI")
Disease2_Cycling_TA$gene = rownames(Disease2_Cycling_TA)
UC_NIup_Cycling_TA = filter(Disease2_Cycling_TA, Disease2_Cycling_TA$cluster == "UC-NI")
HC_NIup_Cycling_TA = filter(Disease2_Cycling_TA, Disease2_Cycling_TA$cluster == "HC-NI")
write.csv(UC_NIup_Cycling_TA, "Results/DE/UCNIupvsHC_NI_Cycling_TA.csv")
write.csv(HC_NIup_Cycling_TA, "Results/DE/HC_NIupvsUCNI_Cycling_TA.csv")

Disease2_BEST4_entero <- FindMarkers(data, subset.ident = "BEST4_enterocyte", group.by = "state", test.use = "MAST", ident.1 = "UC-NI", ident.2 = "HC-NI")
Disease2_BEST4_entero <- filter(Disease2_BEST4_entero, Disease2_BEST4_entero$p_val_adj < 0.05)
Disease2_BEST4_entero$cluster = ifelse(Disease2_BEST4_entero$avg_logFC > 0,"UC-NI","HC-NI")
Disease2_BEST4_entero$gene = rownames(Disease2_BEST4_entero)
UC_NIup_BEST4_entero = filter(Disease2_BEST4_entero, Disease2_BEST4_entero$cluster == "UC-NI")
HC_NIup_BEST4_entero = filter(Disease2_BEST4_entero, Disease2_BEST4_entero$cluster == "HC-NI")
write.csv(UC_NIup_BEST4_entero, "Results/DE/UCNIupvsHC_NI_BEST4_entero.csv")
write.csv(HC_NIup_BEST4_entero, "Results/DE/HC_NIupvsUCNI_BEST4_entero.csv")

Disease2_PLCG2_TA <- FindMarkers(data, subset.ident = "PLCG2_TA", group.by = "state", test.use = "MAST", ident.1 = "UC-NI", ident.2 = "HC-NI")
Disease2_PLCG2_TA <- filter(Disease2_PLCG2_TA, Disease2_PLCG2_TA$p_val_adj < 0.05)
Disease2_PLCG2_TA$cluster = ifelse(Disease2_PLCG2_TA$avg_logFC > 0,"UC-NI","HC-NI")
Disease2_PLCG2_TA$gene = rownames(Disease2_PLCG2_TA)
UC_NIup_PLCG2_TA = filter(Disease2_PLCG2_TA, Disease2_PLCG2_TA$cluster == "UC-NI")
HC_NIup_PLCG2_TA = filter(Disease2_PLCG2_TA, Disease2_PLCG2_TA$cluster == "HC-NI")
write.csv(UC_NIup_PLCG2_TA, "Results/DE/UCNIupvsHC_NI_PLCG2_TA.csv")
write.csv(HC_NIup_PLCG2_TA, "Results/DE/HC_NIupvsUCNI_PLCG2_TA.csv")

Disease2_Ribo_TA <- FindMarkers(data, subset.ident = "Ribo_TA", group.by = "state", test.use = "MAST", ident.1 = "UC-NI", ident.2 = "HC-NI")
Disease2_Ribo_TA <- filter(Disease2_Ribo_TA, Disease2_Ribo_TA$p_val_adj < 0.05)
Disease2_Ribo_TA$cluster = ifelse(Disease2_Ribo_TA$avg_logFC > 0,"UC-NI","HC-NI")
Disease2_Ribo_TA$gene = rownames(Disease2_Ribo_TA)
UC_NIup_Ribo_TA = filter(Disease2_Ribo_TA, Disease2_Ribo_TA$cluster == "UC-NI")
HC_NIup_Ribo_TA = filter(Disease2_Ribo_TA, Disease2_Ribo_TA$cluster == "HC-NI")
write.csv(UC_NIup_Ribo_TA, "Results/DE/UCNIupvsHC_NI_Ribo_TA.csv")
write.csv(HC_NIup_Ribo_TA, "Results/DE/HC_NIupvsUCNI_Ribo_TA.csv")

Disease2_Pericytes <- FindMarkers(data, subset.ident = "Pericytes", group.by = "state", test.use = "MAST", ident.1 = "UC-NI", ident.2 = "HC-NI")
Disease2_Pericytes <- filter(Disease2_Pericytes, Disease2_Pericytes$p_val_adj < 0.05)
Disease2_Pericytes$cluster = ifelse(Disease2_Pericytes$avg_logFC > 0,"UC-NI","HC-NI")
Disease2_Pericytes$gene = rownames(Disease2_Pericytes)
UC_NIup_Pericytes = filter(Disease2_Pericytes, Disease2_Pericytes$cluster == "UC-NI")
HC_NIup_Pericytes = filter(Disease2_Pericytes, Disease2_Pericytes$cluster == "HC-NI")
write.csv(UC_NIup_Pericytes, "Results/DE/UCNIupvsHC_NI_Pericytes.csv")
write.csv(HC_NIup_Pericytes, "Results/DE/HC_NIupvsUCNI_Pericytes.csv")

Disease2_PLCG2_TA <- FindMarkers(data, subset.ident = "PLCG2_TA", group.by = "state", test.use = "MAST", ident.1 = "UC-NI", ident.2 = "HC-NI")
Disease2_PLCG2_TA <- filter(Disease2_PLCG2_TA, Disease2_PLCG2_TA$p_val_adj < 0.05)
Disease2_PLCG2_TA$cluster = ifelse(Disease2_PLCG2_TA$avg_logFC > 0,"UC-NI","HC-NI")
Disease2_PLCG2_TA$gene = rownames(Disease2_PLCG2_TA)
UC_NIup_PLCG2_TA = filter(Disease2_PLCG2_TA, Disease2_PLCG2_TA$cluster == "UC-NI")
HC_NIup_PLCG2_TA = filter(Disease2_PLCG2_TA, Disease2_PLCG2_TA$cluster == "HC-NI")
write.csv(UC_NIup_PLCG2_TA, "Results/DE/UCNIupvsHC_NI_PLCG2_TA.csv")
write.csv(HC_NIup_PLCG2_TA, "Results/DE/HC_NIupvsUCNI_PLCG2_TA.csv")

Disease2_Ribo_TA <- FindMarkers(data, subset.ident = "Ribo_TA", group.by = "state", test.use = "MAST", ident.1 = "UC-NI", ident.2 = "HC-NI")
Disease2_Ribo_TA <- filter(Disease2_Ribo_TA, Disease2_Ribo_TA$p_val_adj < 0.05)
Disease2_Ribo_TA$cluster = ifelse(Disease2_Ribo_TA$avg_logFC > 0,"UC-NI","HC-NI")
Disease2_Ribo_TA$gene = rownames(Disease2_Ribo_TA)
UC_NIup_Ribo_TA = filter(Disease2_Ribo_TA, Disease2_Ribo_TA$cluster == "UC-NI")
HC_NIup_Ribo_TA = filter(Disease2_Ribo_TA, Disease2_Ribo_TA$cluster == "HC-NI")
write.csv(UC_NIup_Ribo_TA, "Results/DE/UCNIupvsHC_NI_Ribo_TA.csv")
write.csv(HC_NIup_Ribo_TA, "Results/DE/HC_NIupvsUCNI_Ribo_TA.csv")

Disease2_Pericytes <- FindMarkers(data, subset.ident = "Pericytes", group.by = "state", test.use = "MAST", ident.1 = "UC-NI", ident.2 = "HC-NI")
Disease2_Pericytes <- filter(Disease2_Pericytes, Disease2_Pericytes$p_val_adj < 0.05)
Disease2_Pericytes$cluster = ifelse(Disease2_Pericytes$avg_logFC > 0,"UC-NI","HC-NI")
Disease2_Pericytes$gene = rownames(Disease2_Pericytes)
UC_NIup_Pericytes = filter(Disease2_Pericytes, Disease2_Pericytes$cluster == "UC-NI")
HC_NIup_Pericytes = filter(Disease2_Pericytes, Disease2_Pericytes$cluster == "HC-NI")
write.csv(UC_NIup_Pericytes, "Results/DE/UCNIupvsHC_NI_Pericytes.csv")
write.csv(HC_NIup_Pericytes, "Results/DE/HC_NIupvsUCNI_Pericytes.csv")

Disease2_IgA <- FindMarkers(data, subset.ident = "IgA_plasma", group.by = "state", test.use = "MAST", ident.1 = "UC-NI", ident.2 = "HC-NI")
Disease2_IgA <- filter(Disease2_IgA, Disease2_IgA$p_val_adj < 0.05)
Disease2_IgA$cluster = ifelse(Disease2_IgA$avg_logFC > 0,"UC-NI","HC-NI")
Disease2_IgA$gene = rownames(Disease2_IgA)
UC_NIup_IgA = filter(Disease2_IgA, Disease2_IgA$cluster == "UC-NI")
HC_NIup_IgA = filter(Disease2_IgA, Disease2_IgA$cluster == "HC-NI")
write.csv(UC_NIup_IgA, "Results/DE/UCNIupvsHC_NI_IgA.csv")
write.csv(HC_NIup_IgA, "Results/DE/HC_NIupvsUCNI_IgA.csv")

Disease2_Memory_B <- FindMarkers(data, subset.ident = "Memory_B", group.by = "state", test.use = "MAST", ident.1 = "UC-NI", ident.2 = "HC-NI")
Disease2_Memory_B <- filter(Disease2_Memory_B, Disease2_Memory_B$p_val_adj < 0.05)
Disease2_Memory_B$cluster = ifelse(Disease2_Memory_B$avg_logFC > 0,"UC-NI","HC-NI")
Disease2_Memory_B$gene = rownames(Disease2_Memory_B)
UC_NIup_Memory_B = filter(Disease2_Memory_B, Disease2_Memory_B$cluster == "UC-NI")
HC_NIup_Memory_B = filter(Disease2_Memory_B, Disease2_Memory_B$cluster == "HC-NI")
write.csv(UC_NIup_Memory_B, "Results/DE/UCNIupvsHC_NI_Memory_B.csv")
write.csv(HC_NIup_Memory_B, "Results/DE/HC_NIupvsUCNI_Memory_B.csv")

Disease2_MAIT <- FindMarkers(data, subset.ident = "MAIT", group.by = "state", test.use = "MAST", ident.1 = "UC-NI", ident.2 = "HC-NI")
Disease2_MAIT <- filter(Disease2_MAIT, Disease2_MAIT$p_val_adj < 0.05)
Disease2_MAIT$cluster = ifelse(Disease2_MAIT$avg_logFC > 0,"UC-NI","HC-NI")
Disease2_MAIT$gene = rownames(Disease2_MAIT)
UC_NIup_MAIT = filter(Disease2_MAIT, Disease2_MAIT$cluster == "UC-NI")
HC_NIup_MAIT = filter(Disease2_MAIT, Disease2_MAIT$cluster == "HC-NI")
write.csv(UC_NIup_MAIT, "Results/DE/UCNIupvsHC_NI_MAIT.csv")
write.csv(HC_NIup_MAIT, "Results/DE/HC_NIupvsUCNI_MAIT.csv")

Disease2_Inflam_fibro <- FindMarkers(data, subset.ident = "Inflammatory_fibroblast", group.by = "state", test.use = "MAST", ident.1 = "UC-NI", ident.2 = "HC-NI")
Disease2_Inflam_fibro <- filter(Disease2_Inflam_fibro, Disease2_Inflam_fibro$p_val_adj < 0.05)
Disease2_Inflam_fibro$cluster = ifelse(Disease2_Inflam_fibro$avg_logFC > 0,"UC-NI","HC-NI")
Disease2_Inflam_fibro$gene = rownames(Disease2_Inflam_fibro)
UC_NIup_Inflam_fibro = filter(Disease2_Inflam_fibro, Disease2_Inflam_fibro$cluster == "UC-NI")
HC_NIup_Inflam_fibro = filter(Disease2_Inflam_fibro, Disease2_Inflam_fibro$cluster == "HC-NI")
write.csv(UC_NIup_Inflam_fibro, "Results/DE/UCNIupvsHC_NI_Inflam_fibro.csv")
write.csv(HC_NIup_Inflam_fibro, "Results/DE/HC_NIupvsUCNI_Inflam_fibro.csv")

Disease2_RSPO3 <- FindMarkers(data, subset.ident = "RSPO3_fibroblast", group.by = "state", test.use = "MAST", ident.1 = "UC-NI", ident.2 = "HC-NI")
Disease2_RSPO3 <- filter(Disease2_RSPO3, Disease2_RSPO3$p_val_adj < 0.05)
Disease2_RSPO3$cluster = ifelse(Disease2_RSPO3$avg_logFC > 0,"UC-NI","HC-NI")
Disease2_RSPO3$gene = rownames(Disease2_RSPO3)
UC_NIup_RSPO3 = filter(Disease2_RSPO3, Disease2_RSPO3$cluster == "UC-NI")
HC_NIup_RSPO3 = filter(Disease2_RSPO3, Disease2_RSPO3$cluster == "HC-NI")
write.csv(UC_NIup_RSPO3, "Results/DE/UCNIupvsHC_NI_RSPO3.csv")
write.csv(HC_NIup_RSPO3, "Results/DE/HC_NIupvsUCNI_RSPO3.csv")

Disease2_stem <- FindMarkers(data, subset.ident = "Stem", group.by = "state", test.use = "MAST", ident.1 = "UC-NI", ident.2 = "HC-NI")
Disease2_stem <- filter(Disease2_stem, Disease2_stem$p_val_adj < 0.05)
Disease2_stem$cluster = ifelse(Disease2_stem$avg_logFC > 0,"UC-NI","HC-NI")
Disease2_stem$gene = rownames(Disease2_stem)
UC_NIup_stem = filter(Disease2_stem, Disease2_stem$cluster == "UC-NI")
HC_NIup_stem = filter(Disease2_stem, Disease2_stem$cluster == "HC-NI")
write.csv(UC_NIup_stem, "Results/DE/UCNIupvsHC_NI_stem.csv")
write.csv(HC_NIup_stem, "Results/DE/HC_NIupvsUCNI_stem.csv")





###############

# PSC vs non-PSC
Idents(data) <- "celltypes"
PSC_IgG <- FindMarkers(data, subset.ident = "IgG_plasma", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "HC"), ident.2 = "PSC")
PSC_IgG <- filter(PSC_IgG, PSC_IgG$p_val_adj < 0.05)
PSC_IgG$cluster = ifelse(PSC_IgG$avg_logFC > 0,"non-PSC","PSC")
PSC_IgG$gene = rownames(PSC_IgG)
nonPSCup_IgG = filter(PSC_IgG, PSC_IgG$cluster == "non-PSC")
PSCup_IgG = filter(PSC_IgG, PSC_IgG$cluster == "PSC")
write.csv(nonPSCup_IgG, "Results/DE/nonPSCup_IgG.csv")
write.csv(PSCup_IgG, "Results/DE/PSCup_IgG.csv")



PSC_Treg <- FindMarkers(data, subset.ident = "Treg", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "HC"), ident.2 = "PSC")
PSC_Treg <- filter(PSC_Treg, PSC_Treg$p_val_adj < 0.05)
PSC_Treg$cluster = ifelse(PSC_Treg$avg_logFC > 0,"non-PSC","PSC")
PSC_Treg$gene = rownames(PSC_Treg)
nonPSCup_Treg = filter(PSC_Treg, PSC_Treg$cluster == "non-PSC")
PSCup_Treg = filter(PSC_Treg, PSC_Treg$cluster == "PSC")
write.csv(nonPSCup_Treg, "Results/DE/nonPSCup_Treg.csv")
write.csv(PSCup_Treg, "Results/DE/PSCup_Treg.csv")

PSC_BEST4_entero <- FindMarkers(data, subset.ident = "BEST4_enterocyte", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "HC"), ident.2 = "PSC")
PSC_BEST4_entero <- filter(PSC_BEST4_entero, PSC_BEST4_entero$p_val_adj < 0.05)
PSC_BEST4_entero$cluster = ifelse(PSC_BEST4_entero$avg_logFC > 0,"non-PSC","PSC")
PSC_BEST4_entero$gene = rownames(PSC_BEST4_entero)
nonPSCup_BEST4_entero = filter(PSC_BEST4_entero, PSC_BEST4_entero$cluster == "non-PSC")
PSCup_BEST4_entero = filter(PSC_BEST4_entero, PSC_BEST4_entero$cluster == "PSC")
write.csv(nonPSCup_BEST4_entero, "Results/DE/nonPSCup_BEST4_entero.csv")
write.csv(PSCup_BEST4_entero, "Results/DE/PSCup_BEST4_entero.csv")

PSC_IgA <- FindMarkers(data, subset.ident = "IgA_plasma", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "HC"), ident.2 = "PSC")
PSC_IgA <- filter(PSC_IgA, PSC_IgA$p_val_adj < 0.05)
PSC_IgA$cluster = ifelse(PSC_IgA$avg_logFC > 0,"non-PSC","PSC")
PSC_IgA$gene = rownames(PSC_IgA)
nonPSCup_IgA = filter(PSC_IgA, PSC_IgA$cluster == "non-PSC")
PSCup_IgA = filter(PSC_IgA, PSC_IgA$cluster == "PSC")
write.csv(nonPSCup_IgA, "Results/DE/nonPSCup_IgA.csv")
write.csv(PSCup_IgA, "Results/DE/PSCup_IgA.csv")

PSC_Memory_B <- FindMarkers(data, subset.ident = "Memory_B", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "HC"), ident.2 = "PSC")
PSC_Memory_B <- filter(PSC_Memory_B, PSC_Memory_B$p_val_adj < 0.05)
PSC_Memory_B$cluster = ifelse(PSC_Memory_B$avg_logFC > 0,"non-PSC","PSC")
PSC_Memory_B$gene = rownames(PSC_Memory_B)
nonPSCup_Memory_B = filter(PSC_Memory_B, PSC_Memory_B$cluster == "non-PSC")
PSCup_Memory_B = filter(PSC_Memory_B, PSC_Memory_B$cluster == "PSC")
write.csv(nonPSCup_Memory_B, "Results/DE/nonPSCup_Memory_B.csv")
write.csv(PSCup_Memory_B, "Results/DE/PSCup_Memory_B.csv")

PSC_MAIT <- FindMarkers(data, subset.ident = "MAIT", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "HC"), ident.2 = "PSC")
PSC_MAIT <- filter(PSC_MAIT, PSC_MAIT$p_val_adj < 0.05)
PSC_MAIT$cluster = ifelse(PSC_MAIT$avg_logFC > 0,"non-PSC","PSC")
PSC_MAIT$gene = rownames(PSC_MAIT)
nonPSCup_MAIT = filter(PSC_MAIT, PSC_MAIT$cluster == "non-PSC")
PSCup_MAIT = filter(PSC_MAIT, PSC_MAIT$cluster == "PSC")
write.csv(nonPSCup_MAIT, "Results/DE/nonPSCup_MAIT.csv")
write.csv(PSCup_MAIT, "Results/DE/PSCup_MAIT.csv")

PSC_Inflam_fibro <- FindMarkers(data, subset.ident = "Inflammatory_fibroblast", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "HC"), ident.2 = "PSC")
PSC_Inflam_fibro <- filter(PSC_Inflam_fibro, PSC_Inflam_fibro$p_val_adj < 0.05)
PSC_Inflam_fibro$cluster = ifelse(PSC_Inflam_fibro$avg_logFC > 0,"non-PSC","PSC")
PSC_Inflam_fibro$gene = rownames(PSC_Inflam_fibro)
nonPSCup_Inflam_fibro = filter(PSC_Inflam_fibro, PSC_Inflam_fibro$cluster == "non-PSC")
PSCup_Inflam_fibro = filter(PSC_Inflam_fibro, PSC_Inflam_fibro$cluster == "PSC")
write.csv(nonPSCup_Inflam_fibro, "Results/DE/nonPSCup_Inflam_fibro.csv")
write.csv(PSCup_Inflam_fibro, "Results/DE/PSCup_Inflam_fibro.csv")

PSC_RSPO3 <- FindMarkers(data, subset.ident = "RSPO3_fibroblast", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "HC"), ident.2 = "PSC")
PSC_RSPO3 <- filter(PSC_RSPO3, PSC_RSPO3$p_val_adj < 0.05)
PSC_RSPO3$cluster = ifelse(PSC_RSPO3$avg_logFC > 0,"non-PSC","PSC")
PSC_RSPO3$gene = rownames(PSC_RSPO3)
nonPSCup_RSPO3 = filter(PSC_RSPO3, PSC_RSPO3$cluster == "non-PSC")
PSCup_RSPO3 = filter(PSC_RSPO3, PSC_RSPO3$cluster == "PSC")
write.csv(nonPSCup_RSPO3, "Results/DE/nonPSCup_RSPO3.csv")
write.csv(PSCup_RSPO3, "Results/DE/PSCup_RSPO3.csv")

PSC_stem <- FindMarkers(data, subset.ident = "Stem", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "HC"), ident.2 = "PSC")
PSC_stem <- filter(PSC_stem, PSC_stem$p_val_adj < 0.05)
PSC_stem$cluster = ifelse(PSC_stem$avg_logFC > 0,"non-PSC","PSC")
PSC_stem$gene = rownames(PSC_stem)
nonPSCup_stem = filter(PSC_stem, PSC_stem$cluster == "non-PSC")
PSCup_stem = filter(PSC_stem, PSC_stem$cluster == "PSC")
write.csv(nonPSCup_stem, "Results/DE/nonPSCup_stem.csv")
write.csv(PSCup_stem, "Results/DE/PSCup_stem.csv")


PSC_Absorptive_enterocyte <- FindMarkers(data, subset.ident = "Absorptive_enterocyte", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "HC"), ident.2 = "PSC")
PSC_Absorptive_enterocyte <- filter(PSC_Absorptive_enterocyte, PSC_Absorptive_enterocyte$p_val_adj < 0.05)
PSC_Absorptive_enterocyte$cluster = ifelse(PSC_Absorptive_enterocyte$avg_logFC > 0,"non-PSC","PSC")
PSC_Absorptive_enterocyte$gene = rownames(PSC_Absorptive_enterocyte)
nonPSCup_Absorptive_enterocyte = filter(PSC_Absorptive_enterocyte, PSC_Absorptive_enterocyte$cluster == "non-PSC")
PSCup_Absorptive_enterocyte = filter(PSC_Absorptive_enterocyte, PSC_Absorptive_enterocyte$cluster == "PSC")
write.csv(nonPSCup_Absorptive_enterocyte, "Results/DE/nonPSCup_Absorptive_enterocyte.csv")
write.csv(PSCup_Absorptive_enterocyte, "Results/DE/PSCup_Absorptive_enterocyte.csv")

# Paired test PSC
Idents(data) = "sample"
data_PSC= subset(data, ident = c("XXXX","3069","3086","3147","3191","3317","3325"))

Idents(data_PSC) = "celltypes"
PSCINI_IgG <- FindMarkers(data_PSC, subset.ident = "IgG_plasma", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_IgG <- filter(PSCINI_IgG, PSCINI_IgG$p_val_adj < 0.05)
PSCINI_IgG$cluster = ifelse(PSCINI_IgG$avg_logFC > 0,"I","NI")
PSCINI_IgG$gene = rownames(PSCINI_IgG)
PSCIup_IgG = filter(PSCINI_IgG, PSCINI_IgG$cluster == "I")
PSCNIup_IgG = filter(PSCINI_IgG, PSCINI_IgG$cluster == "NI")
write.csv(PSCIup_IgG, "Results/DE/PSCIup_IgG.csv")
write.csv(PSCNIup_IgG, "Results/DE/PSCNIup_IgG.csv")
GO_PSCIup_IgG=enrichr(PSCIup_IgG$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_IgG <- filter(GO_PSCIup_IgG, GO_PSCIup_IgG$Adjusted.P.value< 0.05)
GO_PSCNIup_IgG=enrichr(PSCNIup_IgG$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_IgG <- filter(GO_PSCNIup_IgG, GO_PSCNIup_IgG$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_IgG, "Results/DE/GO_PSCNIup_IgG.csv")
write.csv(GO_PSCIup_IgG, "Results/DE/GO_PSCIup_IgG.csv")

PSCINI_Treg <- FindMarkers(data_PSC, subset.ident = "Treg", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Treg <- filter(PSCINI_Treg, PSCINI_Treg$p_val_adj < 0.05)
PSCINI_Treg$cluster = ifelse(PSCINI_Treg$avg_logFC > 0,"I","NI")
PSCINI_Treg$gene = rownames(PSCINI_Treg)
PSCIup_Treg = filter(PSCINI_Treg, PSCINI_Treg$cluster == "I")
PSCNIup_Treg = filter(PSCINI_Treg, PSCINI_Treg$cluster == "NI")
write.csv(PSCIup_Treg, "Results/DE/PSCIup_Treg.csv")
write.csv(PSCNIup_Treg, "Results/DE/PSCNIup_Treg.csv")
GO_PSCIup_Treg=enrichr(PSCIup_Treg$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Treg <- filter(GO_PSCIup_Treg, GO_PSCIup_Treg$Adjusted.P.value< 0.05)
GO_PSCNIup_Treg=enrichr(PSCNIup_Treg$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Treg <- filter(GO_PSCNIup_Treg, GO_PSCNIup_Treg$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Treg, "Results/DE/GO_PSCNIup_Treg.csv")
write.csv(GO_PSCIup_Treg, "Results/DE/GO_PSCIup_Treg.csv")

PSCINI_Memory_B <- FindMarkers(data_PSC, subset.ident = "Memory_B", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Memory_B <- filter(PSCINI_Memory_B, PSCINI_Memory_B$p_val_adj < 0.05)
PSCINI_Memory_B$cluster = ifelse(PSCINI_Memory_B$avg_logFC > 0,"I","NI")
PSCINI_Memory_B$gene = rownames(PSCINI_Memory_B)
PSCIup_Memory_B = filter(PSCINI_Memory_B, PSCINI_Memory_B$cluster == "I")
PSCNIup_Memory_B = filter(PSCINI_Memory_B, PSCINI_Memory_B$cluster == "NI")
write.csv(PSCIup_Memory_B, "Results/DE/PSCIup_Memory_B.csv")
write.csv(PSCNIup_Memory_B, "Results/DE/PSCNIup_Memory_B.csv")
GO_PSCIup_Memory_B=enrichr(PSCIup_Memory_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Memory_B <- filter(GO_PSCIup_Memory_B, GO_PSCIup_Memory_B$Adjusted.P.value< 0.05)
GO_PSCNIup_Memory_B=enrichr(PSCNIup_Memory_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Memory_B <- filter(GO_PSCNIup_Memory_B, GO_PSCNIup_Memory_B$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Memory_B, "Results/DE/GO_PSCNIup_Memory_B.csv")
write.csv(GO_PSCIup_Memory_B, "Results/DE/GO_PSCIup_Memory_B.csv")

PSCINI_Inflammatory_monocyte <- FindMarkers(data_PSC, subset.ident = "Inflammatory_monocyte", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Inflammatory_monocyte <- filter(PSCINI_Inflammatory_monocyte, PSCINI_Inflammatory_monocyte$p_val_adj < 0.05)
PSCINI_Inflammatory_monocyte$cluster = ifelse(PSCINI_Inflammatory_monocyte$avg_logFC > 0,"I","NI")
PSCINI_Inflammatory_monocyte$gene = rownames(PSCINI_Inflammatory_monocyte)
PSCIup_Inflammatory_monocyte = filter(PSCINI_Inflammatory_monocyte, PSCINI_Inflammatory_monocyte$cluster == "I")
PSCNIup_Inflammatory_monocyte = filter(PSCINI_Inflammatory_monocyte, PSCINI_Inflammatory_monocyte$cluster == "NI")
write.csv(PSCIup_Inflammatory_monocyte, "Results/DE/PSCIup_Inflammatory_monocyte.csv")
write.csv(PSCNIup_Inflammatory_monocyte, "Results/DE/PSCNIup_Inflammatory_monocyte.csv")
GO_PSCIup_Inflammatory_monocyte=enrichr(PSCIup_Inflammatory_monocyte$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Inflammatory_monocyte <- filter(GO_PSCIup_Inflammatory_monocyte, GO_PSCIup_Inflammatory_monocyte$Adjusted.P.value< 0.05)
GO_PSCNIup_Inflammatory_monocyte=enrichr(PSCNIup_Inflammatory_monocyte$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Inflammatory_monocyte <- filter(GO_PSCNIup_Inflammatory_monocyte, GO_PSCNIup_Inflammatory_monocyte$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Inflammatory_monocyte, "Results/DE/GO_PSCNIup_Inflammatory_monocyte.csv")
write.csv(GO_PSCIup_Inflammatory_monocyte, "Results/DE/GO_PSCIup_Inflammatory_monocyte.csv")

PSCINI_Macrophage <- FindMarkers(data_PSC, subset.ident = "Macrophage", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Macrophage <- filter(PSCINI_Macrophage, PSCINI_Macrophage$p_val_adj < 0.05)
PSCINI_Macrophage$cluster = ifelse(PSCINI_Macrophage$avg_logFC > 0,"I","NI")
PSCINI_Macrophage$gene = rownames(PSCINI_Macrophage)
PSCIup_Macrophage = filter(PSCINI_Macrophage, PSCINI_Macrophage$cluster == "I")
PSCNIup_Macrophage = filter(PSCINI_Macrophage, PSCINI_Macrophage$cluster == "NI")
write.csv(PSCIup_Macrophage, "Results/DE/PSCIup_Macrophage.csv")
write.csv(PSCNIup_Macrophage, "Results/DE/PSCNIup_Macrophage.csv")
GO_PSCIup_Macrophage=enrichr(PSCIup_Macrophage$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Macrophage <- filter(GO_PSCIup_Macrophage, GO_PSCIup_Macrophage$Adjusted.P.value< 0.05)
GO_PSCNIup_Macrophage=enrichr(PSCNIup_Macrophage$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Macrophage <- filter(GO_PSCNIup_Macrophage, GO_PSCNIup_Macrophage$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Macrophage, "Results/DE/GO_PSCNIup_Macrophage.csv")
write.csv(GO_PSCIup_Macrophage, "Results/DE/GO_PSCIup_Macrophage.csv")

PSCINI_DC <- FindMarkers(data_PSC, subset.ident = "DC", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_DC <- filter(PSCINI_DC, PSCINI_DC$p_val_adj < 0.05)
PSCINI_DC$cluster = ifelse(PSCINI_DC$avg_logFC > 0,"I","NI")
PSCINI_DC$gene = rownames(PSCINI_DC)
PSCIup_DC = filter(PSCINI_DC, PSCINI_DC$cluster == "I")
PSCNIup_DC = filter(PSCINI_DC, PSCINI_DC$cluster == "NI")
write.csv(PSCIup_DC, "Results/DE/PSCIup_DC.csv")
write.csv(PSCNIup_DC, "Results/DE/PSCNIup_DC.csv")
GO_PSCIup_DC=enrichr(PSCIup_DC$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_DC <- filter(GO_PSCIup_DC, GO_PSCIup_DC$Adjusted.P.value< 0.05)
GO_PSCNIup_DC=enrichr(PSCNIup_DC$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_DC <- filter(GO_PSCNIup_DC, GO_PSCNIup_DC$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_DC, "Results/DE/GO_PSCNIup_DC.csv")
write.csv(GO_PSCIup_DC, "Results/DE/GO_PSCIup_DC.csv")

PSCINI_IgA <- FindMarkers(data_PSC, subset.ident = "IgA_plasma", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_IgA <- filter(PSCINI_IgA, PSCINI_IgA$p_val_adj < 0.05)
PSCINI_IgA$cluster = ifelse(PSCINI_IgA$avg_logFC > 0,"I","NI")
PSCINI_IgA$gene = rownames(PSCINI_IgA)
PSCIup_IgA = filter(PSCINI_IgA, PSCINI_IgA$cluster == "I")
PSCNIup_IgA = filter(PSCINI_IgA, PSCINI_IgA$cluster == "NI")
write.csv(PSCIup_IgA, "Results/DE/PSCIup_IgA.csv")
write.csv(PSCNIup_IgA, "Results/DE/PSCNIup_IgA.csv")
GO_PSCIup_IgA=enrichr(PSCIup_IgA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_IgA <- filter(GO_PSCIup_IgA, GO_PSCIup_IgA$Adjusted.P.value< 0.05)
GO_PSCNIup_IgA=enrichr(PSCNIup_IgA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_IgA <- filter(GO_PSCNIup_IgA, GO_PSCNIup_IgA$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_IgA, "Results/DE/GO_PSCNIup_IgA.csv")
write.csv(GO_PSCIup_IgA, "Results/DE/GO_PSCIup_IgA.csv")

PSCINI_Inflam_fibro <- FindMarkers(data_PSC, subset.ident = "Inflammatory_fibroblast", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Inflam_fibro <- filter(PSCINI_Inflam_fibro, PSCINI_Inflam_fibro$p_val_adj < 0.05)
PSCINI_Inflam_fibro$cluster = ifelse(PSCINI_Inflam_fibro$avg_logFC > 0,"I","NI")
PSCINI_Inflam_fibro$gene = rownames(PSCINI_Inflam_fibro)
PSCIup_Inflam_fibro = filter(PSCINI_Inflam_fibro, PSCINI_Inflam_fibro$cluster == "I")
PSCNIup_Inflam_fibro = filter(PSCINI_Inflam_fibro, PSCINI_Inflam_fibro$cluster == "NI")
write.csv(PSCIup_Inflam_fibro, "Results/DE/PSCIup_Inflam_fibro.csv")
write.csv(PSCNIup_Inflam_fibro, "Results/DE/PSCNIup_Inflam_fibro.csv")
GO_PSCIup_Inflam_fibro=enrichr(PSCIup_Inflam_fibro$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Inflam_fibro <- filter(GO_PSCIup_Inflam_fibro, GO_PSCIup_Inflam_fibro$Adjusted.P.value< 0.05)
GO_PSCNIup_Inflam_fibro=enrichr(PSCNIup_Inflam_fibro$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Inflam_fibro <- filter(GO_PSCNIup_Inflam_fibro, GO_PSCNIup_Inflam_fibro$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Inflam_fibro, "Results/DE/GO_PSCNIup_Inflam_fibro.csv")
write.csv(GO_PSCIup_Inflam_fibro, "Results/DE/GO_PSCIup_Inflam_fibro.csv")

PSCINI_Absorptive_enterocyte <- FindMarkers(data_PSC, subset.ident = "Absorptive_enterocyte", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Absorptive_enterocyte <- filter(PSCINI_Absorptive_enterocyte, PSCINI_Absorptive_enterocyte$p_val_adj < 0.05)
PSCINI_Absorptive_enterocyte$cluster = ifelse(PSCINI_Absorptive_enterocyte$avg_logFC > 0,"I","NI")
PSCINI_Absorptive_enterocyte$gene = rownames(PSCINI_Absorptive_enterocyte)
PSCIup_Absorptive_enterocyte = filter(PSCINI_Absorptive_enterocyte, PSCINI_Absorptive_enterocyte$cluster == "I")
PSCNIup_Absorptive_enterocyte = filter(PSCINI_Absorptive_enterocyte, PSCINI_Absorptive_enterocyte$cluster == "NI")
write.csv(PSCIup_Absorptive_enterocyte, "Results/DE/PSCIup_Absorptive_enterocyte.csv")
write.csv(PSCNIup_Absorptive_enterocyte, "Results/DE/PSCNIup_Absorptive_enterocyte.csv")
GO_PSCIup_Absorptive_enterocyte=enrichr(PSCIup_Absorptive_enterocyte$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Absorptive_enterocyte <- filter(GO_PSCIup_Absorptive_enterocyte, GO_PSCIup_Absorptive_enterocyte$Adjusted.P.value< 0.05)
GO_PSCNIup_Absorptive_enterocyte=enrichr(PSCNIup_Absorptive_enterocyte$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Absorptive_enterocyte <- filter(GO_PSCNIup_Absorptive_enterocyte, GO_PSCNIup_Absorptive_enterocyte$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Absorptive_enterocyte, "Results/DE/GO_PSCNIup_Absorptive_enterocyte.csv")
write.csv(GO_PSCIup_Absorptive_enterocyte, "Results/DE/GO_PSCIup_Absorptive_enterocyte.csv")

PSCINI_stem <- FindMarkers(data_PSC, subset.ident = "Stem", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_stem <- filter(PSCINI_stem, PSCINI_stem$p_val_adj < 0.05)
PSCINI_stem$cluster = ifelse(PSCINI_stem$avg_logFC > 0,"I","NI")
PSCINI_stem$gene = rownames(PSCINI_stem)
PSCIup_stem = filter(PSCINI_stem, PSCINI_stem$cluster == "I")
PSCNIup_stem = filter(PSCINI_stem, PSCINI_stem$cluster == "NI")
write.csv(PSCIup_stem, "Results/DE/PSCIup_stem.csv")
write.csv(PSCNIup_stem, "Results/DE/PSCNIup_stem.csv")
GO_PSCIup_stem=enrichr(PSCIup_stem$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_stem <- filter(GO_PSCIup_stem, GO_PSCIup_stem$Adjusted.P.value< 0.05)
GO_PSCNIup_stem=enrichr(PSCNIup_stem$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_stem <- filter(GO_PSCNIup_stem, GO_PSCNIup_stem$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_stem, "Results/DE/GO_PSCNIup_stem.csv")
write.csv(GO_PSCIup_stem, "Results/DE/GO_PSCIup_stem.csv")

PSCINI_Enteroendocrine <- FindMarkers(data_PSC, subset.ident = "Enteroendocrine", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Enteroendocrine <- filter(PSCINI_Enteroendocrine, PSCINI_Enteroendocrine$p_val_adj < 0.05)
PSCINI_Enteroendocrine$cluster = ifelse(PSCINI_Enteroendocrine$avg_logFC > 0,"I","NI")
PSCINI_Enteroendocrine$gene = rownames(PSCINI_Enteroendocrine)
PSCIup_Enteroendocrine = filter(PSCINI_Enteroendocrine, PSCINI_Enteroendocrine$cluster == "I")
PSCNIup_Enteroendocrine = filter(PSCINI_Enteroendocrine, PSCINI_Enteroendocrine$cluster == "NI")
write.csv(PSCIup_Enteroendocrine, "Results/DE/PSCIup_Enteroendocrine.csv")
write.csv(PSCNIup_Enteroendocrine, "Results/DE/PSCNIup_Enteroendocrine.csv")
GO_PSCIup_Enteroendocrine=enrichr(PSCIup_Enteroendocrine$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Enteroendocrine <- filter(GO_PSCIup_Enteroendocrine, GO_PSCIup_Enteroendocrine$Adjusted.P.value< 0.05)
GO_PSCNIup_Enteroendocrine=enrichr(PSCNIup_Enteroendocrine$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Enteroendocrine <- filter(GO_PSCNIup_Enteroendocrine, GO_PSCNIup_Enteroendocrine$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Enteroendocrine, "Results/DE/GO_PSCNIup_Enteroendocrine.csv")
write.csv(GO_PSCIup_Enteroendocrine, "Results/DE/GO_PSCIup_Enteroendocrine.csv")

PSCINI_Goblet <- FindMarkers(data_PSC, subset.ident = "Goblet", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Goblet <- filter(PSCINI_Goblet, PSCINI_Goblet$p_val_adj < 0.05)
PSCINI_Goblet$cluster = ifelse(PSCINI_Goblet$avg_logFC > 0,"I","NI")
PSCINI_Goblet$gene = rownames(PSCINI_Goblet)
PSCIup_Goblet = filter(PSCINI_Goblet, PSCINI_Goblet$cluster == "I")
PSCNIup_Goblet = filter(PSCINI_Goblet, PSCINI_Goblet$cluster == "NI")
write.csv(PSCIup_Goblet, "Results/DE/PSCIup_Goblet.csv")
write.csv(PSCNIup_Goblet, "Results/DE/PSCNIup_Goblet.csv")
GO_PSCIup_Goblet=enrichr(PSCIup_Goblet$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Goblet <- filter(GO_PSCIup_Goblet, GO_PSCIup_Goblet$Adjusted.P.value< 0.05)
GO_PSCNIup_Goblet=enrichr(PSCNIup_Goblet$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Goblet <- filter(GO_PSCNIup_Goblet, GO_PSCNIup_Goblet$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Goblet, "Results/DE/GO_PSCNIup_Goblet.csv")
write.csv(GO_PSCIup_Goblet, "Results/DE/GO_PSCIup_Goblet.csv")

PSCINI_MAST <- FindMarkers(data_PSC, subset.ident = "MAST", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_MAST <- filter(PSCINI_MAST, PSCINI_MAST$p_val_adj < 0.05)
PSCINI_MAST$cluster = ifelse(PSCINI_MAST$avg_logFC > 0,"I","NI")
PSCINI_MAST$gene = rownames(PSCINI_MAST)
PSCIup_MAST = filter(PSCINI_MAST, PSCINI_MAST$cluster == "I")
PSCNIup_MAST = filter(PSCINI_MAST, PSCINI_MAST$cluster == "NI")
write.csv(PSCIup_MAST, "Results/DE/PSCIup_MAST.csv")
write.csv(PSCNIup_MAST, "Results/DE/PSCNIup_MAST.csv")
GO_PSCIup_MAST=enrichr(PSCIup_MAST$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_MAST <- filter(GO_PSCIup_MAST, GO_PSCIup_MAST$Adjusted.P.value< 0.05)
GO_PSCNIup_MAST=enrichr(PSCNIup_MAST$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_MAST <- filter(GO_PSCNIup_MAST, GO_PSCNIup_MAST$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_MAST, "Results/DE/GO_PSCNIup_MAST.csv")
write.csv(GO_PSCIup_MAST, "Results/DE/GO_PSCIup_MAST.csv")

PSCINI_RSPO3 <- FindMarkers(data_PSC, subset.ident = "RSPO3_fibroblast", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_RSPO3 <- filter(PSCINI_RSPO3, PSCINI_RSPO3$p_val_adj < 0.05)
PSCINI_RSPO3$cluster = ifelse(PSCINI_RSPO3$avg_logFC > 0,"I","NI")
PSCINI_RSPO3$gene = rownames(PSCINI_RSPO3)
PSCIup_RSPO3 = filter(PSCINI_RSPO3, PSCINI_RSPO3$cluster == "I")
PSCNIup_RSPO3 = filter(PSCINI_RSPO3, PSCINI_RSPO3$cluster == "NI")
write.csv(PSCIup_RSPO3, "Results/DE/PSCIup_RSPO3.csv")
write.csv(PSCNIup_RSPO3, "Results/DE/PSCNIup_RSPO3.csv")
GO_PSCIup_RSPO3=enrichr(PSCIup_RSPO3$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_RSPO3 <- filter(GO_PSCIup_RSPO3, GO_PSCIup_RSPO3$Adjusted.P.value< 0.05)
GO_PSCNIup_RSPO3=enrichr(PSCNIup_RSPO3$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_RSPO3 <- filter(GO_PSCNIup_RSPO3, GO_PSCNIup_RSPO3$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_RSPO3, "Results/DE/GO_PSCNIup_RSPO3.csv")
write.csv(GO_PSCIup_RSPO3, "Results/DE/GO_PSCIup_RSPO3.csv")

PSCINI_WNT2B <- FindMarkers(data_PSC, subset.ident = "WNT2B_fibroblast", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_WNT2B <- filter(PSCINI_WNT2B, PSCINI_WNT2B$p_val_adj < 0.05)
PSCINI_WNT2B$cluster = ifelse(PSCINI_WNT2B$avg_logFC > 0,"I","NI")
PSCINI_WNT2B$gene = rownames(PSCINI_WNT2B)
PSCIup_WNT2B = filter(PSCINI_WNT2B, PSCINI_WNT2B$cluster == "I")
PSCNIup_WNT2B = filter(PSCINI_WNT2B, PSCINI_WNT2B$cluster == "NI")
write.csv(PSCIup_WNT2B, "Results/DE/PSCIup_WNT2B.csv")
write.csv(PSCNIup_WNT2B, "Results/DE/PSCNIup_WNT2B.csv")
GO_PSCIup_WNT2B=enrichr(PSCIup_WNT2B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_WNT2B <- filter(GO_PSCIup_WNT2B, GO_PSCIup_WNT2B$Adjusted.P.value< 0.05)
GO_PSCNIup_WNT2B=enrichr(PSCNIup_WNT2B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_WNT2B <- filter(GO_PSCNIup_WNT2B, GO_PSCNIup_WNT2B$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_WNT2B, "Results/DE/GO_PSCNIup_WNT2B.csv")
write.csv(GO_PSCIup_WNT2B, "Results/DE/GO_PSCIup_WNT2B.csv")

PSCINI_WNT5B <- FindMarkers(data_PSC, subset.ident = "WNT5B_fibroblast", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_WNT5B <- filter(PSCINI_WNT5B, PSCINI_WNT5B$p_val_adj < 0.05)
PSCINI_WNT5B$cluster = ifelse(PSCINI_WNT5B$avg_logFC > 0,"I","NI")
PSCINI_WNT5B$gene = rownames(PSCINI_WNT5B)
PSCIup_WNT5B = filter(PSCINI_WNT5B, PSCINI_WNT5B$cluster == "I")
PSCNIup_WNT5B = filter(PSCINI_WNT5B, PSCINI_WNT5B$cluster == "NI")
write.csv(PSCIup_WNT5B, "Results/DE/PSCIup_WNT5B.csv")
write.csv(PSCNIup_WNT5B, "Results/DE/PSCNIup_WNT5B.csv")
GO_PSCIup_WNT5B=enrichr(PSCIup_WNT5B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_WNT5B <- filter(GO_PSCIup_WNT5B, GO_PSCIup_WNT5B$Adjusted.P.value< 0.05)
GO_PSCNIup_WNT5B=enrichr(PSCNIup_WNT5B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_WNT5B <- filter(GO_PSCNIup_WNT5B, GO_PSCNIup_WNT5B$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_WNT5B, "Results/DE/GO_PSCNIup_WNT5B.csv")
write.csv(GO_PSCIup_WNT5B, "Results/DE/GO_PSCIup_WNT5B.csv")

PSCINI_Endothelial <- FindMarkers(data_PSC, subset.ident = "Endothelial", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Endothelial <- filter(PSCINI_Endothelial, PSCINI_Endothelial$p_val_adj < 0.05)
PSCINI_Endothelial$cluster = ifelse(PSCINI_Endothelial$avg_logFC > 0,"I","NI")
PSCINI_Endothelial$gene = rownames(PSCINI_Endothelial)
PSCIup_Endothelial = filter(PSCINI_Endothelial, PSCINI_Endothelial$cluster == "I")
PSCNIup_Endothelial = filter(PSCINI_Endothelial, PSCINI_Endothelial$cluster == "NI")
write.csv(PSCIup_Endothelial, "Results/DE/PSCIup_Endothelial.csv")
write.csv(PSCNIup_Endothelial, "Results/DE/PSCNIup_Endothelial.csv")
GO_PSCIup_Endothelial=enrichr(PSCIup_Endothelial$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Endothelial <- filter(GO_PSCIup_Endothelial, GO_PSCIup_Endothelial$Adjusted.P.value< 0.05)
GO_PSCNIup_Endothelial=enrichr(PSCNIup_Endothelial$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Endothelial <- filter(GO_PSCNIup_Endothelial, GO_PSCNIup_Endothelial$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Endothelial, "Results/DE/GO_PSCNIup_Endothelial.csv")
write.csv(GO_PSCIup_Endothelial, "Results/DE/GO_PSCIup_Endothelial.csv")

PSCINI_pericyte <- FindMarkers(data_PSC, subset.ident = "Pericytes", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_pericyte <- filter(PSCINI_pericyte, PSCINI_pericyte$p_val_adj < 0.05)
PSCINI_pericyte$cluster = ifelse(PSCINI_pericyte$avg_logFC > 0,"I","NI")
PSCINI_pericyte$gene = rownames(PSCINI_pericyte)
PSCIup_pericyte = filter(PSCINI_pericyte, PSCINI_pericyte$cluster == "I")
PSCNIup_pericyte = filter(PSCINI_pericyte, PSCINI_pericyte$cluster == "NI")
write.csv(PSCIup_pericyte, "Results/DE/PSCIup_pericyte.csv")
write.csv(PSCNIup_pericyte, "Results/DE/PSCNIup_pericyte.csv")
GO_PSCIup_pericyte=enrichr(PSCIup_pericyte$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_pericyte <- filter(GO_PSCIup_pericyte, GO_PSCIup_pericyte$Adjusted.P.value< 0.05)
GO_PSCNIup_pericyte=enrichr(PSCNIup_pericyte$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_pericyte <- filter(GO_PSCNIup_pericyte, GO_PSCNIup_pericyte$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_pericyte, "Results/DE/GO_PSCNIup_pericyte.csv")
write.csv(GO_PSCIup_pericyte, "Results/DE/GO_PSCIup_pericyte.csv")

PSCINI_Glia <- FindMarkers(data_PSC, subset.ident = "Glia", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Glia <- filter(PSCINI_Glia, PSCINI_Glia$p_val_adj < 0.05)
PSCINI_Glia$cluster = ifelse(PSCINI_Glia$avg_logFC > 0,"I","NI")
PSCINI_Glia$gene = rownames(PSCINI_Glia)
PSCIup_Glia = filter(PSCINI_Glia, PSCINI_Glia$cluster == "I")
PSCNIup_Glia = filter(PSCINI_Glia, PSCINI_Glia$cluster == "NI")
write.csv(PSCIup_Glia, "Results/DE/PSCIup_Glia.csv")
write.csv(PSCNIup_Glia, "Results/DE/PSCNIup_Glia.csv")
GO_PSCIup_Glia=enrichr(PSCIup_Glia$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Glia <- filter(GO_PSCIup_Glia, GO_PSCIup_Glia$Adjusted.P.value< 0.05)
GO_PSCNIup_Glia=enrichr(PSCNIup_Glia$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Glia <- filter(GO_PSCNIup_Glia, GO_PSCNIup_Glia$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Glia, "Results/DE/GO_PSCNIup_Glia.csv")
write.csv(GO_PSCIup_Glia, "Results/DE/GO_PSCIup_Glia.csv")

PSCINI_myofibro <- FindMarkers(data_PSC, subset.ident = "Myofibroblasts", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_myofibro <- filter(PSCINI_myofibro, PSCINI_myofibro$p_val_adj < 0.05)
PSCINI_myofibro$cluster = ifelse(PSCINI_myofibro$avg_logFC > 0,"I","NI")
PSCINI_myofibro$gene = rownames(PSCINI_myofibro)
PSCIup_myofibro = filter(PSCINI_myofibro, PSCINI_myofibro$cluster == "I")
PSCNIup_myofibro = filter(PSCINI_myofibro, PSCINI_myofibro$cluster == "NI")
write.csv(PSCIup_myofibro, "Results/DE/PSCIup_myofibro.csv")
write.csv(PSCNIup_myofibro, "Results/DE/PSCNIup_myofibro.csv")
GO_PSCIup_myofibro=enrichr(PSCIup_myofibro$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_myofibro <- filter(GO_PSCIup_myofibro, GO_PSCIup_myofibro$Adjusted.P.value< 0.05)
GO_PSCNIup_myofibro=enrichr(PSCNIup_myofibro$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_myofibro <- filter(GO_PSCNIup_myofibro, GO_PSCNIup_myofibro$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_myofibro, "Results/DE/GO_PSCNIup_myofibro.csv")
write.csv(GO_PSCIup_myofibro, "Results/DE/GO_PSCIup_myofibro.csv")

PSCINI_memoryT <- FindMarkers(data_PSC, subset.ident = "Memory_CD4T", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_memoryT <- filter(PSCINI_memoryT, PSCINI_memoryT$p_val_adj < 0.05)
PSCINI_memoryT$cluster = ifelse(PSCINI_memoryT$avg_logFC > 0,"I","NI")
PSCINI_memoryT$gene = rownames(PSCINI_memoryT)
PSCIup_memoryT = filter(PSCINI_memoryT, PSCINI_memoryT$cluster == "I")
PSCNIup_memoryT = filter(PSCINI_memoryT, PSCINI_memoryT$cluster == "NI")
write.csv(PSCIup_memoryT, "Results/DE/PSCIup_memoryT.csv")
write.csv(PSCNIup_memoryT, "Results/DE/PSCNIup_memoryT.csv")
GO_PSCIup_memoryT=enrichr(PSCIup_memoryT$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_memoryT <- filter(GO_PSCIup_memoryT, GO_PSCIup_memoryT$Adjusted.P.value< 0.05)
GO_PSCNIup_memoryT=enrichr(PSCNIup_memoryT$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_memoryT <- filter(GO_PSCNIup_memoryT, GO_PSCNIup_memoryT$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_memoryT, "Results/DE/GO_PSCNIup_memoryT.csv")
write.csv(GO_PSCIup_memoryT, "Results/DE/GO_PSCIup_memoryT.csv")

PSCINI_CD8T <- FindMarkers(data_PSC, subset.ident = "CD8T", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_CD8T <- filter(PSCINI_CD8T, PSCINI_CD8T$p_val_adj < 0.05)
PSCINI_CD8T$cluster = ifelse(PSCINI_CD8T$avg_logFC > 0,"I","NI")
PSCINI_CD8T$gene = rownames(PSCINI_CD8T)
PSCIup_CD8T = filter(PSCINI_CD8T, PSCINI_CD8T$cluster == "I")
PSCNIup_CD8T = filter(PSCINI_CD8T, PSCINI_CD8T$cluster == "NI")
write.csv(PSCIup_CD8T, "Results/DE/PSCIup_CD8T.csv")
write.csv(PSCNIup_CD8T, "Results/DE/PSCNIup_CD8T.csv")
GO_PSCIup_CD8T=enrichr(PSCIup_CD8T$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_CD8T <- filter(GO_PSCIup_CD8T, GO_PSCIup_CD8T$Adjusted.P.value< 0.05)
GO_PSCNIup_CD8T=enrichr(PSCNIup_CD8T$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_CD8T <- filter(GO_PSCNIup_CD8T, GO_PSCNIup_CD8T$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_CD8T, "Results/DE/GO_PSCNIup_CD8T.csv")
write.csv(GO_PSCIup_CD8T, "Results/DE/GO_PSCIup_CD8T.csv")

PSCINI_MAIT <- FindMarkers(data_PSC, subset.ident = "MAIT", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_MAIT <- filter(PSCINI_MAIT, PSCINI_MAIT$p_val_adj < 0.05)
PSCINI_MAIT$cluster = ifelse(PSCINI_MAIT$avg_logFC > 0,"I","NI")
PSCINI_MAIT$gene = rownames(PSCINI_MAIT)
PSCIup_MAIT = filter(PSCINI_MAIT, PSCINI_MAIT$cluster == "I")
PSCNIup_MAIT = filter(PSCINI_MAIT, PSCINI_MAIT$cluster == "NI")
write.csv(PSCIup_MAIT, "Results/DE/PSCIup_MAIT.csv")
write.csv(PSCNIup_MAIT, "Results/DE/PSCNIup_MAIT.csv")
GO_PSCIup_MAIT=enrichr(PSCIup_MAIT$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_MAIT <- filter(GO_PSCIup_MAIT, GO_PSCIup_MAIT$Adjusted.P.value< 0.05)
GO_PSCNIup_MAIT=enrichr(PSCNIup_MAIT$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_MAIT <- filter(GO_PSCNIup_MAIT, GO_PSCNIup_MAIT$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_MAIT, "Results/DE/GO_PSCNIup_MAIT.csv")
write.csv(GO_PSCIup_MAIT, "Results/DE/GO_PSCIup_MAIT.csv")

PSCINI_Cycling_B <- FindMarkers(data_PSC, subset.ident = "Cycling_B", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Cycling_B <- filter(PSCINI_Cycling_B, PSCINI_Cycling_B$p_val_adj < 0.05)
PSCINI_Cycling_B$cluster = ifelse(PSCINI_Cycling_B$avg_logFC > 0,"I","NI")
PSCINI_Cycling_B$gene = rownames(PSCINI_Cycling_B)
PSCIup_Cycling_B = filter(PSCINI_Cycling_B, PSCINI_Cycling_B$cluster == "I")
PSCNIup_Cycling_B = filter(PSCINI_Cycling_B, PSCINI_Cycling_B$cluster == "NI")
write.csv(PSCIup_Cycling_B, "Results/DE/PSCIup_Cycling_B.csv")
write.csv(PSCNIup_Cycling_B, "Results/DE/PSCNIup_Cycling_B.csv")
GO_PSCIup_Cycling_B=enrichr(PSCIup_Cycling_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Cycling_B <- filter(GO_PSCIup_Cycling_B, GO_PSCIup_Cycling_B$Adjusted.P.value< 0.05)
GO_PSCNIup_Cycling_B=enrichr(PSCNIup_Cycling_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Cycling_B <- filter(GO_PSCNIup_Cycling_B, GO_PSCNIup_Cycling_B$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Cycling_B, "Results/DE/GO_PSCNIup_Cycling_B.csv")
write.csv(GO_PSCIup_Cycling_B, "Results/DE/GO_PSCIup_Cycling_B.csv")

PSCINI_Cycling_T <- FindMarkers(data_PSC, subset.ident = "Cycling_T", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Cycling_T <- filter(PSCINI_Cycling_T, PSCINI_Cycling_T$p_val_adj < 0.05)
PSCINI_Cycling_T$cluster = ifelse(PSCINI_Cycling_T$avg_logFC > 0,"I","NI")
PSCINI_Cycling_T$gene = rownames(PSCINI_Cycling_T)
PSCIup_Cycling_T = filter(PSCINI_Cycling_T, PSCINI_Cycling_T$cluster == "I")
PSCNIup_Cycling_T = filter(PSCINI_Cycling_T, PSCINI_Cycling_T$cluster == "NI")
write.csv(PSCIup_Cycling_T, "Results/DE/PSCIup_Cycling_T.csv")
write.csv(PSCNIup_Cycling_T, "Results/DE/PSCNIup_Cycling_T.csv")
GO_PSCIup_Cycling_T=enrichr(PSCIup_Cycling_T$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Cycling_T <- filter(GO_PSCIup_Cycling_T, GO_PSCIup_Cycling_T$Adjusted.P.value< 0.05)
GO_PSCNIup_Cycling_T=enrichr(PSCNIup_Cycling_T$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Cycling_T <- filter(GO_PSCNIup_Cycling_T, GO_PSCNIup_Cycling_T$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Cycling_T, "Results/DE/GO_PSCNIup_Cycling_T.csv")
write.csv(GO_PSCIup_Cycling_T, "Results/DE/GO_PSCIup_Cycling_T.csv")

PSCINI_IgM <- FindMarkers(data_PSC, subset.ident = "IgM_plasma", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_IgM <- filter(PSCINI_IgM, PSCINI_IgM$p_val_adj < 0.05)
PSCINI_IgM$cluster = ifelse(PSCINI_IgM$avg_logFC > 0,"I","NI")
PSCINI_IgM$gene = rownames(PSCINI_IgM)
PSCIup_IgM = filter(PSCINI_IgM, PSCINI_IgM$cluster == "I")
PSCNIup_IgM = filter(PSCINI_IgM, PSCINI_IgM$cluster == "NI")
write.csv(PSCIup_IgM, "Results/DE/PSCIup_IgM.csv")
write.csv(PSCNIup_IgM, "Results/DE/PSCNIup_IgM.csv")
GO_PSCIup_IgM=enrichr(PSCIup_IgM$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_IgM <- filter(GO_PSCIup_IgM, GO_PSCIup_IgM$Adjusted.P.value< 0.05)
GO_PSCNIup_IgM=enrichr(PSCNIup_IgM$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_IgM <- filter(GO_PSCNIup_IgM, GO_PSCNIup_IgM$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_IgM, "Results/DE/GO_PSCNIup_IgM.csv")
write.csv(GO_PSCIup_IgM, "Results/DE/GO_PSCIup_IgM.csv")

PSCINI_imm_entero <- FindMarkers(data_PSC, subset.ident = "Immature_enterocyte", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_imm_entero <- filter(PSCINI_imm_entero, PSCINI_imm_entero$p_val_adj < 0.05)
PSCINI_imm_entero$cluster = ifelse(PSCINI_imm_entero$avg_logFC > 0,"I","NI")
PSCINI_imm_entero$gene = rownames(PSCINI_imm_entero)
PSCIup_imm_entero = filter(PSCINI_imm_entero, PSCINI_imm_entero$cluster == "I")
PSCNIup_imm_entero = filter(PSCINI_imm_entero, PSCINI_imm_entero$cluster == "NI")
write.csv(PSCIup_imm_entero, "Results/DE/PSCIup_imm_entero.csv")
write.csv(PSCNIup_imm_entero, "Results/DE/PSCNIup_imm_entero.csv")
GO_PSCIup_imm_entero=enrichr(PSCIup_imm_entero$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_imm_entero <- filter(GO_PSCIup_imm_entero, GO_PSCIup_imm_entero$Adjusted.P.value< 0.05)
GO_PSCNIup_imm_entero=enrichr(PSCNIup_imm_entero$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_imm_entero <- filter(GO_PSCNIup_imm_entero, GO_PSCNIup_imm_entero$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_imm_entero, "Results/DE/GO_PSCNIup_imm_entero.csv")
write.csv(GO_PSCIup_imm_entero, "Results/DE/GO_PSCIup_imm_entero.csv")

PSCINI_Cycling_TA <- FindMarkers(data_PSC, subset.ident = "Cycling_TA", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Cycling_TA <- filter(PSCINI_Cycling_TA, PSCINI_Cycling_TA$p_val_adj < 0.05)
PSCINI_Cycling_TA$cluster = ifelse(PSCINI_Cycling_TA$avg_logFC > 0,"I","NI")
PSCINI_Cycling_TA$gene = rownames(PSCINI_Cycling_TA)
PSCIup_Cycling_TA = filter(PSCINI_Cycling_TA, PSCINI_Cycling_TA$cluster == "I")
PSCNIup_Cycling_TA = filter(PSCINI_Cycling_TA, PSCINI_Cycling_TA$cluster == "NI")
write.csv(PSCIup_Cycling_TA, "Results/DE/PSCIup_Cycling_TA.csv")
write.csv(PSCNIup_Cycling_TA, "Results/DE/PSCNIup_Cycling_TA.csv")
GO_PSCIup_Cycling_TA=enrichr(PSCIup_Cycling_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Cycling_TA <- filter(GO_PSCIup_Cycling_TA, GO_PSCIup_Cycling_TA$Adjusted.P.value< 0.05)
GO_PSCNIup_Cycling_TA=enrichr(PSCNIup_Cycling_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Cycling_TA <- filter(GO_PSCNIup_Cycling_TA, GO_PSCNIup_Cycling_TA$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Cycling_TA, "Results/DE/GO_PSCNIup_Cycling_TA.csv")
write.csv(GO_PSCIup_Cycling_TA, "Results/DE/GO_PSCIup_Cycling_TA.csv")

PSCINI_Ribo_TA <- FindMarkers(data_PSC, subset.ident = "Ribo_TA", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Ribo_TA <- filter(PSCINI_Ribo_TA, PSCINI_Ribo_TA$p_val_adj < 0.05)
PSCINI_Ribo_TA$cluster = ifelse(PSCINI_Ribo_TA$avg_logFC > 0,"I","NI")
PSCINI_Ribo_TA$gene = rownames(PSCINI_Ribo_TA)
PSCIup_Ribo_TA = filter(PSCINI_Ribo_TA, PSCINI_Ribo_TA$cluster == "I")
PSCNIup_Ribo_TA = filter(PSCINI_Ribo_TA, PSCINI_Ribo_TA$cluster == "NI")
write.csv(PSCIup_Ribo_TA, "Results/DE/PSCIup_Ribo_TA.csv")
write.csv(PSCNIup_Ribo_TA, "Results/DE/PSCNIup_Ribo_TA.csv")
GO_PSCIup_Ribo_TA=enrichr(PSCIup_Ribo_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Ribo_TA <- filter(GO_PSCIup_Ribo_TA, GO_PSCIup_Ribo_TA$Adjusted.P.value< 0.05)
GO_PSCNIup_Ribo_TA=enrichr(PSCNIup_Ribo_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Ribo_TA <- filter(GO_PSCNIup_Ribo_TA, GO_PSCNIup_Ribo_TA$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Ribo_TA, "Results/DE/GO_PSCNIup_Ribo_TA.csv")
write.csv(GO_PSCIup_Ribo_TA, "Results/DE/GO_PSCIup_Ribo_TA.csv")

PSCINI_BEST4 <- FindMarkers(data_PSC, subset.ident = "BEST4_enterocyte", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_BEST4 <- filter(PSCINI_BEST4, PSCINI_BEST4$p_val_adj < 0.05)
PSCINI_BEST4$cluster = ifelse(PSCINI_BEST4$avg_logFC > 0,"I","NI")
PSCINI_BEST4$gene = rownames(PSCINI_BEST4)
PSCIup_BEST4 = filter(PSCINI_BEST4, PSCINI_BEST4$cluster == "I")
PSCNIup_BEST4 = filter(PSCINI_BEST4, PSCINI_BEST4$cluster == "NI")
write.csv(PSCIup_BEST4, "Results/DE/PSCIup_BEST4.csv")
write.csv(PSCNIup_BEST4, "Results/DE/PSCNIup_BEST4.csv")
GO_PSCIup_BEST4=enrichr(PSCIup_BEST4$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_BEST4 <- filter(GO_PSCIup_BEST4, GO_PSCIup_BEST4$Adjusted.P.value< 0.05)
GO_PSCNIup_BEST4=enrichr(PSCNIup_BEST4$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_BEST4 <- filter(GO_PSCNIup_BEST4, GO_PSCNIup_BEST4$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_BEST4, "Results/DE/GO_PSCNIup_BEST4.csv")
write.csv(GO_PSCIup_BEST4, "Results/DE/GO_PSCIup_BEST4.csv")

PSCINI_imm_goblet <- FindMarkers(data_PSC, subset.ident = "Immature_goblet", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_imm_goblet <- filter(PSCINI_imm_goblet, PSCINI_imm_goblet$p_val_adj < 0.05)
PSCINI_imm_goblet$cluster = ifelse(PSCINI_imm_goblet$avg_logFC > 0,"I","NI")
PSCINI_imm_goblet$gene = rownames(PSCINI_imm_goblet)
PSCIup_imm_goblet = filter(PSCINI_imm_goblet, PSCINI_imm_goblet$cluster == "I")
PSCNIup_imm_goblet = filter(PSCINI_imm_goblet, PSCINI_imm_goblet$cluster == "NI")
write.csv(PSCIup_imm_goblet, "Results/DE/PSCIup_imm_goblet.csv")
write.csv(PSCNIup_imm_goblet, "Results/DE/PSCNIup_imm_goblet.csv")
GO_PSCIup_imm_goblet=enrichr(PSCIup_imm_goblet$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_imm_goblet <- filter(GO_PSCIup_imm_goblet, GO_PSCIup_imm_goblet$Adjusted.P.value< 0.05)
GO_PSCNIup_imm_goblet=enrichr(PSCNIup_imm_goblet$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_imm_goblet <- filter(GO_PSCNIup_imm_goblet, GO_PSCNIup_imm_goblet$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_imm_goblet, "Results/DE/GO_PSCNIup_imm_goblet.csv")
write.csv(GO_PSCIup_imm_goblet, "Results/DE/GO_PSCIup_imm_goblet.csv")

PSCINI_DUOX2 <- FindMarkers(data_PSC, subset.ident = "DUOX2_enterocyte", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_DUOX2 <- filter(PSCINI_DUOX2, PSCINI_DUOX2$p_val_adj < 0.05)
PSCINI_DUOX2$cluster = ifelse(PSCINI_DUOX2$avg_logFC > 0,"I","NI")
PSCINI_DUOX2$gene = rownames(PSCINI_DUOX2)
PSCIup_DUOX2 = filter(PSCINI_DUOX2, PSCINI_DUOX2$cluster == "I")
PSCNIup_DUOX2 = filter(PSCINI_DUOX2, PSCINI_DUOX2$cluster == "NI")
write.csv(PSCIup_DUOX2, "Results/DE/PSCIup_DUOX2.csv")
write.csv(PSCNIup_DUOX2, "Results/DE/PSCNIup_DUOX2.csv")
GO_PSCIup_DUOX2=enrichr(PSCIup_DUOX2$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_DUOX2 <- filter(GO_PSCIup_DUOX2, GO_PSCIup_DUOX2$Adjusted.P.value< 0.05)
GO_PSCNIup_DUOX2=enrichr(PSCNIup_DUOX2$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_DUOX2 <- filter(GO_PSCNIup_DUOX2, GO_PSCNIup_DUOX2$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_DUOX2, "Results/DE/GO_PSCNIup_DUOX2.csv")
write.csv(GO_PSCIup_DUOX2, "Results/DE/GO_PSCIup_DUOX2.csv")

PSCINI_PLCG2_TA <- FindMarkers(data_PSC, subset.ident = "PLCG2_TA", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_PLCG2_TA <- filter(PSCINI_PLCG2_TA, PSCINI_PLCG2_TA$p_val_adj < 0.05)
PSCINI_PLCG2_TA$cluster = ifelse(PSCINI_PLCG2_TA$avg_logFC > 0,"I","NI")
PSCINI_PLCG2_TA$gene = rownames(PSCINI_PLCG2_TA)
PSCIup_PLCG2_TA = filter(PSCINI_PLCG2_TA, PSCINI_PLCG2_TA$cluster == "I")
PSCNIup_PLCG2_TA = filter(PSCINI_PLCG2_TA, PSCINI_PLCG2_TA$cluster == "NI")
write.csv(PSCIup_PLCG2_TA, "Results/DE/PSCIup_PLCG2_TA.csv")
write.csv(PSCNIup_PLCG2_TA, "Results/DE/PSCNIup_PLCG2_TA.csv")
GO_PSCIup_PLCG2_TA=enrichr(PSCIup_PLCG2_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_PLCG2_TA <- filter(GO_PSCIup_PLCG2_TA, GO_PSCIup_PLCG2_TA$Adjusted.P.value< 0.05)
GO_PSCNIup_PLCG2_TA=enrichr(PSCNIup_PLCG2_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_PLCG2_TA <- filter(GO_PSCNIup_PLCG2_TA, GO_PSCNIup_PLCG2_TA$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_PLCG2_TA, "Results/DE/GO_PSCNIup_PLCG2_TA.csv")
write.csv(GO_PSCIup_PLCG2_TA, "Results/DE/GO_PSCIup_PLCG2_TA.csv")

PSCINI_Absorptive_TA <- FindMarkers(data_PSC, subset.ident = "Absorptive_TA", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Absorptive_TA <- filter(PSCINI_Absorptive_TA, PSCINI_Absorptive_TA$p_val_adj < 0.05)
PSCINI_Absorptive_TA$cluster = ifelse(PSCINI_Absorptive_TA$avg_logFC > 0,"I","NI")
PSCINI_Absorptive_TA$gene = rownames(PSCINI_Absorptive_TA)
PSCIup_Absorptive_TA = filter(PSCINI_Absorptive_TA, PSCINI_Absorptive_TA$cluster == "I")
PSCNIup_Absorptive_TA = filter(PSCINI_Absorptive_TA, PSCINI_Absorptive_TA$cluster == "NI")
write.csv(PSCIup_Absorptive_TA, "Results/DE/PSCIup_Absorptive_TA.csv")
write.csv(PSCNIup_Absorptive_TA, "Results/DE/PSCNIup_Absorptive_TA.csv")
GO_PSCIup_Absorptive_TA=enrichr(PSCIup_Absorptive_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Absorptive_TA <- filter(GO_PSCIup_Absorptive_TA, GO_PSCIup_Absorptive_TA$Adjusted.P.value< 0.05)
GO_PSCNIup_Absorptive_TA=enrichr(PSCNIup_Absorptive_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Absorptive_TA <- filter(GO_PSCNIup_Absorptive_TA, GO_PSCNIup_Absorptive_TA$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Absorptive_TA, "Results/DE/GO_PSCNIup_Absorptive_TA.csv")
write.csv(GO_PSCIup_Absorptive_TA, "Results/DE/GO_PSCIup_Absorptive_TA.csv")

PSCINI_Tuft <- FindMarkers(data_PSC, subset.ident = "Tuft", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Tuft <- filter(PSCINI_Tuft, PSCINI_Tuft$p_val_adj < 0.05)
PSCINI_Tuft$cluster = ifelse(PSCINI_Tuft$avg_logFC > 0,"I","NI")
PSCINI_Tuft$gene = rownames(PSCINI_Tuft)
PSCIup_Tuft = filter(PSCINI_Tuft, PSCINI_Tuft$cluster == "I")
PSCNIup_Tuft = filter(PSCINI_Tuft, PSCINI_Tuft$cluster == "NI")
write.csv(PSCIup_Tuft, "Results/DE/PSCIup_Tuft.csv")
write.csv(PSCNIup_Tuft, "Results/DE/PSCNIup_Tuft.csv")
GO_PSCIup_Tuft=enrichr(PSCIup_Tuft$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Tuft <- filter(GO_PSCIup_Tuft, GO_PSCIup_Tuft$Adjusted.P.value< 0.05)
GO_PSCNIup_Tuft=enrichr(PSCNIup_Tuft$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Tuft <- filter(GO_PSCNIup_Tuft, GO_PSCNIup_Tuft$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Tuft, "Results/DE/GO_PSCNIup_Tuft.csv")
write.csv(GO_PSCIup_Tuft, "Results/DE/GO_PSCIup_Tuft.csv")

PSCINI_REG_TA <- FindMarkers(data_PSC, subset.ident = "REG_TA", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_REG_TA <- filter(PSCINI_REG_TA, PSCINI_REG_TA$p_val_adj < 0.05)
PSCINI_REG_TA$cluster = ifelse(PSCINI_REG_TA$avg_logFC > 0,"I","NI")
PSCINI_REG_TA$gene = rownames(PSCINI_REG_TA)
PSCIup_REG_TA = filter(PSCINI_REG_TA, PSCINI_REG_TA$cluster == "I")
PSCNIup_REG_TA = filter(PSCINI_REG_TA, PSCINI_REG_TA$cluster == "NI")
write.csv(PSCIup_REG_TA, "Results/DE/PSCIup_REG_TA.csv")
write.csv(PSCNIup_REG_TA, "Results/DE/PSCNIup_REG_TA.csv")
GO_PSCIup_REG_TA=enrichr(PSCIup_REG_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_REG_TA <- filter(GO_PSCIup_REG_TA, GO_PSCIup_REG_TA$Adjusted.P.value< 0.05)
GO_PSCNIup_REG_TA=enrichr(PSCNIup_REG_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_REG_TA <- filter(GO_PSCNIup_REG_TA, GO_PSCNIup_REG_TA$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_REG_TA, "Results/DE/GO_PSCNIup_REG_TA.csv")
write.csv(GO_PSCIup_REG_TA, "Results/DE/GO_PSCIup_REG_TA.csv")


# Paired test UC
Idents(data)="sample"
data_UC= subset(data, ident = c("3006","3059","3076","3085","3107","3125","3249"))

Idents(data_UC) = "celltypes"
UCINI_IgG <- FindMarkers(data_UC, subset.ident = "IgG_plasma", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_IgG <- filter(UCINI_IgG, UCINI_IgG$p_val_adj < 0.05)
UCINI_IgG$cluster = ifelse(UCINI_IgG$avg_logFC > 0,"I","NI")
UCINI_IgG$gene = rownames(UCINI_IgG)
UCIup_IgG = filter(UCINI_IgG, UCINI_IgG$cluster == "I")
UCNIup_IgG = filter(UCINI_IgG, UCINI_IgG$cluster == "NI")
write.csv(UCIup_IgG, "Results/DE/UCIup_IgG.csv")
write.csv(UCNIup_IgG, "Results/DE/UCNIup_IgG.csv")
GO_UCIup_IgG=enrichr(UCIup_IgG$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_IgG <- filter(GO_UCIup_IgG, GO_UCIup_IgG$Adjusted.P.value< 0.05)
GO_UCNIup_IgG=enrichr(UCNIup_IgG$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_IgG <- filter(GO_UCNIup_IgG, GO_UCNIup_IgG$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_IgG, "Results/DE/GO_UCNIup_IgG.csv")
write.csv(GO_UCIup_IgG, "Results/DE/GO_UCIup_IgG.csv")

UCINI_Treg <- FindMarkers(data_UC, subset.ident = "Treg", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Treg <- filter(UCINI_Treg, UCINI_Treg$p_val_adj < 0.05)
UCINI_Treg$cluster = ifelse(UCINI_Treg$avg_logFC > 0,"I","NI")
UCINI_Treg$gene = rownames(UCINI_Treg)
UCIup_Treg = filter(UCINI_Treg, UCINI_Treg$cluster == "I")
UCNIup_Treg = filter(UCINI_Treg, UCINI_Treg$cluster == "NI")
write.csv(UCIup_Treg, "Results/DE/UCIup_Treg.csv")
write.csv(UCNIup_Treg, "Results/DE/UCNIup_Treg.csv")
GO_UCIup_Treg=enrichr(UCIup_Treg$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Treg <- filter(GO_UCIup_Treg, GO_UCIup_Treg$Adjusted.P.value< 0.05)
GO_UCNIup_Treg=enrichr(UCNIup_Treg$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Treg <- filter(GO_UCNIup_Treg, GO_UCNIup_Treg$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Treg, "Results/DE/GO_UCNIup_Treg.csv")
write.csv(GO_UCIup_Treg, "Results/DE/GO_UCIup_Treg.csv")

UCINI_Memory_B <- FindMarkers(data_UC, subset.ident = "Memory_B", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Memory_B <- filter(UCINI_Memory_B, UCINI_Memory_B$p_val_adj < 0.05)
UCINI_Memory_B$cluster = ifelse(UCINI_Memory_B$avg_logFC > 0,"I","NI")
UCINI_Memory_B$gene = rownames(UCINI_Memory_B)
UCIup_Memory_B = filter(UCINI_Memory_B, UCINI_Memory_B$cluster == "I")
UCNIup_Memory_B = filter(UCINI_Memory_B, UCINI_Memory_B$cluster == "NI")
write.csv(UCIup_Memory_B, "Results/DE/UCIup_Memory_B.csv")
write.csv(UCNIup_Memory_B, "Results/DE/UCNIup_Memory_B.csv")
GO_UCIup_Memory_B=enrichr(UCIup_Memory_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Memory_B <- filter(GO_UCIup_Memory_B, GO_UCIup_Memory_B$Adjusted.P.value< 0.05)
GO_UCNIup_Memory_B=enrichr(UCNIup_Memory_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Memory_B <- filter(GO_UCNIup_Memory_B, GO_UCNIup_Memory_B$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Memory_B, "Results/DE/GO_UCNIup_Memory_B.csv")
write.csv(GO_UCIup_Memory_B, "Results/DE/GO_UCIup_Memory_B.csv")

UCINI_Inflammatory_monocyte <- FindMarkers(data_UC, subset.ident = "Inflammatory_monocyte", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Inflammatory_monocyte <- filter(UCINI_Inflammatory_monocyte, UCINI_Inflammatory_monocyte$p_val_adj < 0.05)
UCINI_Inflammatory_monocyte$cluster = ifelse(UCINI_Inflammatory_monocyte$avg_logFC > 0,"I","NI")
UCINI_Inflammatory_monocyte$gene = rownames(UCINI_Inflammatory_monocyte)
UCIup_Inflammatory_monocyte = filter(UCINI_Inflammatory_monocyte, UCINI_Inflammatory_monocyte$cluster == "I")
UCNIup_Inflammatory_monocyte = filter(UCINI_Inflammatory_monocyte, UCINI_Inflammatory_monocyte$cluster == "NI")
write.csv(UCIup_Inflammatory_monocyte, "Results/DE/UCIup_Inflammatory_monocyte.csv")
write.csv(UCNIup_Inflammatory_monocyte, "Results/DE/UCNIup_Inflammatory_monocyte.csv")
GO_UCIup_Inflammatory_monocyte=enrichr(UCIup_Inflammatory_monocyte$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Inflammatory_monocyte <- filter(GO_UCIup_Inflammatory_monocyte, GO_UCIup_Inflammatory_monocyte$Adjusted.P.value< 0.05)
GO_UCNIup_Inflammatory_monocyte=enrichr(UCNIup_Inflammatory_monocyte$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Inflammatory_monocyte <- filter(GO_UCNIup_Inflammatory_monocyte, GO_UCNIup_Inflammatory_monocyte$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Inflammatory_monocyte, "Results/DE/GO_UCNIup_Inflammatory_monocyte.csv")
write.csv(GO_UCIup_Inflammatory_monocyte, "Results/DE/GO_UCIup_Inflammatory_monocyte.csv")

UCINI_Macrophage <- FindMarkers(data_UC, subset.ident = "Macrophage", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Macrophage <- filter(UCINI_Macrophage, UCINI_Macrophage$p_val_adj < 0.05)
UCINI_Macrophage$cluster = ifelse(UCINI_Macrophage$avg_logFC > 0,"I","NI")
UCINI_Macrophage$gene = rownames(UCINI_Macrophage)
UCIup_Macrophage = filter(UCINI_Macrophage, UCINI_Macrophage$cluster == "I")
UCNIup_Macrophage = filter(UCINI_Macrophage, UCINI_Macrophage$cluster == "NI")
write.csv(UCIup_Macrophage, "Results/DE/UCIup_Macrophage.csv")
write.csv(UCNIup_Macrophage, "Results/DE/UCNIup_Macrophage.csv")
GO_UCIup_Macrophage=enrichr(UCIup_Macrophage$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Macrophage <- filter(GO_UCIup_Macrophage, GO_UCIup_Macrophage$Adjusted.P.value< 0.05)
GO_UCNIup_Macrophage=enrichr(UCNIup_Macrophage$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Macrophage <- filter(GO_UCNIup_Macrophage, GO_UCNIup_Macrophage$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Macrophage, "Results/DE/GO_UCNIup_Macrophage.csv")
write.csv(GO_UCIup_Macrophage, "Results/DE/GO_UCIup_Macrophage.csv")

UCINI_DC <- FindMarkers(data_UC, subset.ident = "DC", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_DC <- filter(UCINI_DC, UCINI_DC$p_val_adj < 0.05)
UCINI_DC$cluster = ifelse(UCINI_DC$avg_logFC > 0,"I","NI")
UCINI_DC$gene = rownames(UCINI_DC)
UCIup_DC = filter(UCINI_DC, UCINI_DC$cluster == "I")
UCNIup_DC = filter(UCINI_DC, UCINI_DC$cluster == "NI")
write.csv(UCIup_DC, "Results/DE/UCIup_DC.csv")
write.csv(UCNIup_DC, "Results/DE/UCNIup_DC.csv")
GO_UCIup_DC=enrichr(UCIup_DC$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_DC <- filter(GO_UCIup_DC, GO_UCIup_DC$Adjusted.P.value< 0.05)
GO_UCNIup_DC=enrichr(UCNIup_DC$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_DC <- filter(GO_UCNIup_DC, GO_UCNIup_DC$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_DC, "Results/DE/GO_UCNIup_DC.csv")
write.csv(GO_UCIup_DC, "Results/DE/GO_UCIup_DC.csv")

UCINI_IgA <- FindMarkers(data_UC, subset.ident = "IgA_plasma", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_IgA <- filter(UCINI_IgA, UCINI_IgA$p_val_adj < 0.05)
UCINI_IgA$cluster = ifelse(UCINI_IgA$avg_logFC > 0,"I","NI")
UCINI_IgA$gene = rownames(UCINI_IgA)
UCIup_IgA = filter(UCINI_IgA, UCINI_IgA$cluster == "I")
UCNIup_IgA = filter(UCINI_IgA, UCINI_IgA$cluster == "NI")
write.csv(UCIup_IgA, "Results/DE/UCIup_IgA.csv")
write.csv(UCNIup_IgA, "Results/DE/UCNIup_IgA.csv")
GO_UCIup_IgA=enrichr(UCIup_IgA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_IgA <- filter(GO_UCIup_IgA, GO_UCIup_IgA$Adjusted.P.value< 0.05)
GO_UCNIup_IgA=enrichr(UCNIup_IgA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_IgA <- filter(GO_UCNIup_IgA, GO_UCNIup_IgA$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_IgA, "Results/DE/GO_UCNIup_IgA.csv")
write.csv(GO_UCIup_IgA, "Results/DE/GO_UCIup_IgA.csv")

UCINI_Inflam_fibro <- FindMarkers(data_UC, subset.ident = "Inflammatory_fibroblast", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Inflam_fibro <- filter(UCINI_Inflam_fibro, UCINI_Inflam_fibro$p_val_adj < 0.05)
UCINI_Inflam_fibro$cluster = ifelse(UCINI_Inflam_fibro$avg_logFC > 0,"I","NI")
UCINI_Inflam_fibro$gene = rownames(UCINI_Inflam_fibro)
UCIup_Inflam_fibro = filter(UCINI_Inflam_fibro, UCINI_Inflam_fibro$cluster == "I")
UCNIup_Inflam_fibro = filter(UCINI_Inflam_fibro, UCINI_Inflam_fibro$cluster == "NI")
write.csv(UCIup_Inflam_fibro, "Results/DE/UCIup_Inflam_fibro.csv")
write.csv(UCNIup_Inflam_fibro, "Results/DE/UCNIup_Inflam_fibro.csv")
GO_UCIup_Inflam_fibro=enrichr(UCIup_Inflam_fibro$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Inflam_fibro <- filter(GO_UCIup_Inflam_fibro, GO_UCIup_Inflam_fibro$Adjusted.P.value< 0.05)
GO_UCNIup_Inflam_fibro=enrichr(UCNIup_Inflam_fibro$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Inflam_fibro <- filter(GO_UCNIup_Inflam_fibro, GO_UCNIup_Inflam_fibro$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Inflam_fibro, "Results/DE/GO_UCNIup_Inflam_fibro.csv")
write.csv(GO_UCIup_Inflam_fibro, "Results/DE/GO_UCIup_Inflam_fibro.csv")

UCINI_Absorptive_enterocyte <- FindMarkers(data_UC, subset.ident = "Absorptive_enterocyte", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Absorptive_enterocyte <- filter(UCINI_Absorptive_enterocyte, UCINI_Absorptive_enterocyte$p_val_adj < 0.05)
UCINI_Absorptive_enterocyte$cluster = ifelse(UCINI_Absorptive_enterocyte$avg_logFC > 0,"I","NI")
UCINI_Absorptive_enterocyte$gene = rownames(UCINI_Absorptive_enterocyte)
UCIup_Absorptive_enterocyte = filter(UCINI_Absorptive_enterocyte, UCINI_Absorptive_enterocyte$cluster == "I")
UCNIup_Absorptive_enterocyte = filter(UCINI_Absorptive_enterocyte, UCINI_Absorptive_enterocyte$cluster == "NI")
write.csv(UCIup_Absorptive_enterocyte, "Results/DE/UCIup_Absorptive_enterocyte.csv")
write.csv(UCNIup_Absorptive_enterocyte, "Results/DE/UCNIup_Absorptive_enterocyte.csv")
GO_UCIup_Absorptive_enterocyte=enrichr(UCIup_Absorptive_enterocyte$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Absorptive_enterocyte <- filter(GO_UCIup_Absorptive_enterocyte, GO_UCIup_Absorptive_enterocyte$Adjusted.P.value< 0.05)
GO_UCNIup_Absorptive_enterocyte=enrichr(UCNIup_Absorptive_enterocyte$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Absorptive_enterocyte <- filter(GO_UCNIup_Absorptive_enterocyte, GO_UCNIup_Absorptive_enterocyte$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Absorptive_enterocyte, "Results/DE/GO_UCNIup_Absorptive_enterocyte.csv")
write.csv(GO_UCIup_Absorptive_enterocyte, "Results/DE/GO_UCIup_Absorptive_enterocyte.csv")

UCINI_stem <- FindMarkers(data_UC, subset.ident = "Stem", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_stem <- filter(UCINI_stem, UCINI_stem$p_val_adj < 0.05)
UCINI_stem$cluster = ifelse(UCINI_stem$avg_logFC > 0,"I","NI")
UCINI_stem$gene = rownames(UCINI_stem)
UCIup_stem = filter(UCINI_stem, UCINI_stem$cluster == "I")
UCNIup_stem = filter(UCINI_stem, UCINI_stem$cluster == "NI")
write.csv(UCIup_stem, "Results/DE/UCIup_stem.csv")
write.csv(UCNIup_stem, "Results/DE/UCNIup_stem.csv")
GO_UCIup_stem=enrichr(UCIup_stem$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_stem <- filter(GO_UCIup_stem, GO_UCIup_stem$Adjusted.P.value< 0.05)
GO_UCNIup_stem=enrichr(UCNIup_stem$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_stem <- filter(GO_UCNIup_stem, GO_UCNIup_stem$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_stem, "Results/DE/GO_UCNIup_stem.csv")
write.csv(GO_UCIup_stem, "Results/DE/GO_UCIup_stem.csv")

UCINI_Enteroendocrine <- FindMarkers(data_UC, subset.ident = "Enteroendocrine", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Enteroendocrine <- filter(UCINI_Enteroendocrine, UCINI_Enteroendocrine$p_val_adj < 0.05)
UCINI_Enteroendocrine$cluster = ifelse(UCINI_Enteroendocrine$avg_logFC > 0,"I","NI")
UCINI_Enteroendocrine$gene = rownames(UCINI_Enteroendocrine)
UCIup_Enteroendocrine = filter(UCINI_Enteroendocrine, UCINI_Enteroendocrine$cluster == "I")
UCNIup_Enteroendocrine = filter(UCINI_Enteroendocrine, UCINI_Enteroendocrine$cluster == "NI")
write.csv(UCIup_Enteroendocrine, "Results/DE/UCIup_Enteroendocrine.csv")
write.csv(UCNIup_Enteroendocrine, "Results/DE/UCNIup_Enteroendocrine.csv")
GO_UCIup_Enteroendocrine=enrichr(UCIup_Enteroendocrine$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Enteroendocrine <- filter(GO_UCIup_Enteroendocrine, GO_UCIup_Enteroendocrine$Adjusted.P.value< 0.05)
GO_UCNIup_Enteroendocrine=enrichr(UCNIup_Enteroendocrine$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Enteroendocrine <- filter(GO_UCNIup_Enteroendocrine, GO_UCNIup_Enteroendocrine$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Enteroendocrine, "Results/DE/GO_UCNIup_Enteroendocrine.csv")
write.csv(GO_UCIup_Enteroendocrine, "Results/DE/GO_UCIup_Enteroendocrine.csv")

UCINI_Goblet <- FindMarkers(data_UC, subset.ident = "Goblet", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Goblet <- filter(UCINI_Goblet, UCINI_Goblet$p_val_adj < 0.05)
UCINI_Goblet$cluster = ifelse(UCINI_Goblet$avg_logFC > 0,"I","NI")
UCINI_Goblet$gene = rownames(UCINI_Goblet)
UCIup_Goblet = filter(UCINI_Goblet, UCINI_Goblet$cluster == "I")
UCNIup_Goblet = filter(UCINI_Goblet, UCINI_Goblet$cluster == "NI")
write.csv(UCIup_Goblet, "Results/DE/UCIup_Goblet.csv")
write.csv(UCNIup_Goblet, "Results/DE/UCNIup_Goblet.csv")
GO_UCIup_Goblet=enrichr(UCIup_Goblet$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Goblet <- filter(GO_UCIup_Goblet, GO_UCIup_Goblet$Adjusted.P.value< 0.05)
GO_UCNIup_Goblet=enrichr(UCNIup_Goblet$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Goblet <- filter(GO_UCNIup_Goblet, GO_UCNIup_Goblet$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Goblet, "Results/DE/GO_UCNIup_Goblet.csv")
write.csv(GO_UCIup_Goblet, "Results/DE/GO_UCIup_Goblet.csv")

UCINI_MAST <- FindMarkers(data_UC, subset.ident = "MAST", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_MAST <- filter(UCINI_MAST, UCINI_MAST$p_val_adj < 0.05)
UCINI_MAST$cluster = ifelse(UCINI_MAST$avg_logFC > 0,"I","NI")
UCINI_MAST$gene = rownames(UCINI_MAST)
UCIup_MAST = filter(UCINI_MAST, UCINI_MAST$cluster == "I")
UCNIup_MAST = filter(UCINI_MAST, UCINI_MAST$cluster == "NI")
write.csv(UCIup_MAST, "Results/DE/UCIup_MAST.csv")
write.csv(UCNIup_MAST, "Results/DE/UCNIup_MAST.csv")
GO_UCIup_MAST=enrichr(UCIup_MAST$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_MAST <- filter(GO_UCIup_MAST, GO_UCIup_MAST$Adjusted.P.value< 0.05)
GO_UCNIup_MAST=enrichr(UCNIup_MAST$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_MAST <- filter(GO_UCNIup_MAST, GO_UCNIup_MAST$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_MAST, "Results/DE/GO_UCNIup_MAST.csv")
write.csv(GO_UCIup_MAST, "Results/DE/GO_UCIup_MAST.csv")

UCINI_RSPO3 <- FindMarkers(data_UC, subset.ident = "RSPO3_fibroblast", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_RSPO3 <- filter(UCINI_RSPO3, UCINI_RSPO3$p_val_adj < 0.05)
UCINI_RSPO3$cluster = ifelse(UCINI_RSPO3$avg_logFC > 0,"I","NI")
UCINI_RSPO3$gene = rownames(UCINI_RSPO3)
UCIup_RSPO3 = filter(UCINI_RSPO3, UCINI_RSPO3$cluster == "I")
UCNIup_RSPO3 = filter(UCINI_RSPO3, UCINI_RSPO3$cluster == "NI")
write.csv(UCIup_RSPO3, "Results/DE/UCIup_RSPO3.csv")
write.csv(UCNIup_RSPO3, "Results/DE/UCNIup_RSPO3.csv")
GO_UCIup_RSPO3=enrichr(UCIup_RSPO3$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_RSPO3 <- filter(GO_UCIup_RSPO3, GO_UCIup_RSPO3$Adjusted.P.value< 0.05)
GO_UCNIup_RSPO3=enrichr(UCNIup_RSPO3$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_RSPO3 <- filter(GO_UCNIup_RSPO3, GO_UCNIup_RSPO3$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_RSPO3, "Results/DE/GO_UCNIup_RSPO3.csv")
write.csv(GO_UCIup_RSPO3, "Results/DE/GO_UCIup_RSPO3.csv")

UCINI_WNT2B <- FindMarkers(data_UC, subset.ident = "WNT2B_fibroblast", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_WNT2B <- filter(UCINI_WNT2B, UCINI_WNT2B$p_val_adj < 0.05)
UCINI_WNT2B$cluster = ifelse(UCINI_WNT2B$avg_logFC > 0,"I","NI")
UCINI_WNT2B$gene = rownames(UCINI_WNT2B)
UCIup_WNT2B = filter(UCINI_WNT2B, UCINI_WNT2B$cluster == "I")
UCNIup_WNT2B = filter(UCINI_WNT2B, UCINI_WNT2B$cluster == "NI")
write.csv(UCIup_WNT2B, "Results/DE/UCIup_WNT2B.csv")
write.csv(UCNIup_WNT2B, "Results/DE/UCNIup_WNT2B.csv")
GO_UCIup_WNT2B=enrichr(UCIup_WNT2B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_WNT2B <- filter(GO_UCIup_WNT2B, GO_UCIup_WNT2B$Adjusted.P.value< 0.05)
GO_UCNIup_WNT2B=enrichr(UCNIup_WNT2B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_WNT2B <- filter(GO_UCNIup_WNT2B, GO_UCNIup_WNT2B$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_WNT2B, "Results/DE/GO_UCNIup_WNT2B.csv")
write.csv(GO_UCIup_WNT2B, "Results/DE/GO_UCIup_WNT2B.csv")

UCINI_WNT5B <- FindMarkers(data_UC, subset.ident = "WNT5B_fibroblast", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_WNT5B <- filter(UCINI_WNT5B, UCINI_WNT5B$p_val_adj < 0.05)
UCINI_WNT5B$cluster = ifelse(UCINI_WNT5B$avg_logFC > 0,"I","NI")
UCINI_WNT5B$gene = rownames(UCINI_WNT5B)
UCIup_WNT5B = filter(UCINI_WNT5B, UCINI_WNT5B$cluster == "I")
UCNIup_WNT5B = filter(UCINI_WNT5B, UCINI_WNT5B$cluster == "NI")
write.csv(UCIup_WNT5B, "Results/DE/UCIup_WNT5B.csv")
write.csv(UCNIup_WNT5B, "Results/DE/UCNIup_WNT5B.csv")
GO_UCIup_WNT5B=enrichr(UCIup_WNT5B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_WNT5B <- filter(GO_UCIup_WNT5B, GO_UCIup_WNT5B$Adjusted.P.value< 0.05)
GO_UCNIup_WNT5B=enrichr(UCNIup_WNT5B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_WNT5B <- filter(GO_UCNIup_WNT5B, GO_UCNIup_WNT5B$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_WNT5B, "Results/DE/GO_UCNIup_WNT5B.csv")
write.csv(GO_UCIup_WNT5B, "Results/DE/GO_UCIup_WNT5B.csv")

UCINI_Endothelial <- FindMarkers(data_UC, subset.ident = "Endothelial", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Endothelial <- filter(UCINI_Endothelial, UCINI_Endothelial$p_val_adj < 0.05)
UCINI_Endothelial$cluster = ifelse(UCINI_Endothelial$avg_logFC > 0,"I","NI")
UCINI_Endothelial$gene = rownames(UCINI_Endothelial)
UCIup_Endothelial = filter(UCINI_Endothelial, UCINI_Endothelial$cluster == "I")
UCNIup_Endothelial = filter(UCINI_Endothelial, UCINI_Endothelial$cluster == "NI")
write.csv(UCIup_Endothelial, "Results/DE/UCIup_Endothelial.csv")
write.csv(UCNIup_Endothelial, "Results/DE/UCNIup_Endothelial.csv")
GO_UCIup_Endothelial=enrichr(UCIup_Endothelial$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Endothelial <- filter(GO_UCIup_Endothelial, GO_UCIup_Endothelial$Adjusted.P.value< 0.05)
GO_UCNIup_Endothelial=enrichr(UCNIup_Endothelial$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Endothelial <- filter(GO_UCNIup_Endothelial, GO_UCNIup_Endothelial$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Endothelial, "Results/DE/GO_UCNIup_Endothelial.csv")
write.csv(GO_UCIup_Endothelial, "Results/DE/GO_UCIup_Endothelial.csv")

UCINI_pericyte <- FindMarkers(data_UC, subset.ident = "Pericytes", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_pericyte <- filter(UCINI_pericyte, UCINI_pericyte$p_val_adj < 0.05)
UCINI_pericyte$cluster = ifelse(UCINI_pericyte$avg_logFC > 0,"I","NI")
UCINI_pericyte$gene = rownames(UCINI_pericyte)
UCIup_pericyte = filter(UCINI_pericyte, UCINI_pericyte$cluster == "I")
UCNIup_pericyte = filter(UCINI_pericyte, UCINI_pericyte$cluster == "NI")
write.csv(UCIup_pericyte, "Results/DE/UCIup_pericyte.csv")
write.csv(UCNIup_pericyte, "Results/DE/UCNIup_pericyte.csv")
GO_UCIup_pericyte=enrichr(UCIup_pericyte$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_pericyte <- filter(GO_UCIup_pericyte, GO_UCIup_pericyte$Adjusted.P.value< 0.05)
GO_UCNIup_pericyte=enrichr(UCNIup_pericyte$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_pericyte <- filter(GO_UCNIup_pericyte, GO_UCNIup_pericyte$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_pericyte, "Results/DE/GO_UCNIup_pericyte.csv")
write.csv(GO_UCIup_pericyte, "Results/DE/GO_UCIup_pericyte.csv")

UCINI_Glia <- FindMarkers(data_UC, subset.ident = "Glia", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Glia <- filter(UCINI_Glia, UCINI_Glia$p_val_adj < 0.05)
UCINI_Glia$cluster = ifelse(UCINI_Glia$avg_logFC > 0,"I","NI")
UCINI_Glia$gene = rownames(UCINI_Glia)
UCIup_Glia = filter(UCINI_Glia, UCINI_Glia$cluster == "I")
UCNIup_Glia = filter(UCINI_Glia, UCINI_Glia$cluster == "NI")
write.csv(UCIup_Glia, "Results/DE/UCIup_Glia.csv")
write.csv(UCNIup_Glia, "Results/DE/UCNIup_Glia.csv")
GO_UCIup_Glia=enrichr(UCIup_Glia$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Glia <- filter(GO_UCIup_Glia, GO_UCIup_Glia$Adjusted.P.value< 0.05)
GO_UCNIup_Glia=enrichr(UCNIup_Glia$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Glia <- filter(GO_UCNIup_Glia, GO_UCNIup_Glia$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Glia, "Results/DE/GO_UCNIup_Glia.csv")
write.csv(GO_UCIup_Glia, "Results/DE/GO_UCIup_Glia.csv")

UCINI_myofibro <- FindMarkers(data_UC, subset.ident = "Myofibroblasts", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_myofibro <- filter(UCINI_myofibro, UCINI_myofibro$p_val_adj < 0.05)
UCINI_myofibro$cluster = ifelse(UCINI_myofibro$avg_logFC > 0,"I","NI")
UCINI_myofibro$gene = rownames(UCINI_myofibro)
UCIup_myofibro = filter(UCINI_myofibro, UCINI_myofibro$cluster == "I")
UCNIup_myofibro = filter(UCINI_myofibro, UCINI_myofibro$cluster == "NI")
write.csv(UCIup_myofibro, "Results/DE/UCIup_myofibro.csv")
write.csv(UCNIup_myofibro, "Results/DE/UCNIup_myofibro.csv")
GO_UCIup_myofibro=enrichr(UCIup_myofibro$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_myofibro <- filter(GO_UCIup_myofibro, GO_UCIup_myofibro$Adjusted.P.value< 0.05)
GO_UCNIup_myofibro=enrichr(UCNIup_myofibro$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_myofibro <- filter(GO_UCNIup_myofibro, GO_UCNIup_myofibro$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_myofibro, "Results/DE/GO_UCNIup_myofibro.csv")
write.csv(GO_UCIup_myofibro, "Results/DE/GO_UCIup_myofibro.csv")

UCINI_memoryT <- FindMarkers(data_UC, subset.ident = "Memory_CD4T", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_memoryT <- filter(UCINI_memoryT, UCINI_memoryT$p_val_adj < 0.05)
UCINI_memoryT$cluster = ifelse(UCINI_memoryT$avg_logFC > 0,"I","NI")
UCINI_memoryT$gene = rownames(UCINI_memoryT)
UCIup_memoryT = filter(UCINI_memoryT, UCINI_memoryT$cluster == "I")
UCNIup_memoryT = filter(UCINI_memoryT, UCINI_memoryT$cluster == "NI")
write.csv(UCIup_memoryT, "Results/DE/UCIup_memoryT.csv")
write.csv(UCNIup_memoryT, "Results/DE/UCNIup_memoryT.csv")
GO_UCIup_memoryT=enrichr(UCIup_memoryT$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_memoryT <- filter(GO_UCIup_memoryT, GO_UCIup_memoryT$Adjusted.P.value< 0.05)
GO_UCNIup_memoryT=enrichr(UCNIup_memoryT$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_memoryT <- filter(GO_UCNIup_memoryT, GO_UCNIup_memoryT$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_memoryT, "Results/DE/GO_UCNIup_memoryT.csv")
write.csv(GO_UCIup_memoryT, "Results/DE/GO_UCIup_memoryT.csv")

UCINI_CD8T <- FindMarkers(data_UC, subset.ident = "CD8T", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_CD8T <- filter(UCINI_CD8T, UCINI_CD8T$p_val_adj < 0.05)
UCINI_CD8T$cluster = ifelse(UCINI_CD8T$avg_logFC > 0,"I","NI")
UCINI_CD8T$gene = rownames(UCINI_CD8T)
UCIup_CD8T = filter(UCINI_CD8T, UCINI_CD8T$cluster == "I")
UCNIup_CD8T = filter(UCINI_CD8T, UCINI_CD8T$cluster == "NI")
write.csv(UCIup_CD8T, "Results/DE/UCIup_CD8T.csv")
write.csv(UCNIup_CD8T, "Results/DE/UCNIup_CD8T.csv")
GO_UCIup_CD8T=enrichr(UCIup_CD8T$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_CD8T <- filter(GO_UCIup_CD8T, GO_UCIup_CD8T$Adjusted.P.value< 0.05)
GO_UCNIup_CD8T=enrichr(UCNIup_CD8T$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_CD8T <- filter(GO_UCNIup_CD8T, GO_UCNIup_CD8T$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_CD8T, "Results/DE/GO_UCNIup_CD8T.csv")
write.csv(GO_UCIup_CD8T, "Results/DE/GO_UCIup_CD8T.csv")

UCINI_MAIT <- FindMarkers(data_UC, subset.ident = "MAIT", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_MAIT <- filter(UCINI_MAIT, UCINI_MAIT$p_val_adj < 0.05)
UCINI_MAIT$cluster = ifelse(UCINI_MAIT$avg_logFC > 0,"I","NI")
UCINI_MAIT$gene = rownames(UCINI_MAIT)
UCIup_MAIT = filter(UCINI_MAIT, UCINI_MAIT$cluster == "I")
UCNIup_MAIT = filter(UCINI_MAIT, UCINI_MAIT$cluster == "NI")
write.csv(UCIup_MAIT, "Results/DE/UCIup_MAIT.csv")
write.csv(UCNIup_MAIT, "Results/DE/UCNIup_MAIT.csv")
GO_UCIup_MAIT=enrichr(UCIup_MAIT$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_MAIT <- filter(GO_UCIup_MAIT, GO_UCIup_MAIT$Adjusted.P.value< 0.05)
GO_UCNIup_MAIT=enrichr(UCNIup_MAIT$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_MAIT <- filter(GO_UCNIup_MAIT, GO_UCNIup_MAIT$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_MAIT, "Results/DE/GO_UCNIup_MAIT.csv")
write.csv(GO_UCIup_MAIT, "Results/DE/GO_UCIup_MAIT.csv")

UCINI_Cycling_B <- FindMarkers(data_UC, subset.ident = "Cycling_B", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Cycling_B <- filter(UCINI_Cycling_B, UCINI_Cycling_B$p_val_adj < 0.05)
UCINI_Cycling_B$cluster = ifelse(UCINI_Cycling_B$avg_logFC > 0,"I","NI")
UCINI_Cycling_B$gene = rownames(UCINI_Cycling_B)
UCIup_Cycling_B = filter(UCINI_Cycling_B, UCINI_Cycling_B$cluster == "I")
UCNIup_Cycling_B = filter(UCINI_Cycling_B, UCINI_Cycling_B$cluster == "NI")
write.csv(UCIup_Cycling_B, "Results/DE/UCIup_Cycling_B.csv")
write.csv(UCNIup_Cycling_B, "Results/DE/UCNIup_Cycling_B.csv")
GO_UCIup_Cycling_B=enrichr(UCIup_Cycling_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Cycling_B <- filter(GO_UCIup_Cycling_B, GO_UCIup_Cycling_B$Adjusted.P.value< 0.05)
GO_UCNIup_Cycling_B=enrichr(UCNIup_Cycling_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Cycling_B <- filter(GO_UCNIup_Cycling_B, GO_UCNIup_Cycling_B$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Cycling_B, "Results/DE/GO_UCNIup_Cycling_B.csv")
write.csv(GO_UCIup_Cycling_B, "Results/DE/GO_UCIup_Cycling_B.csv")

UCINI_Cycling_T <- FindMarkers(data_UC, subset.ident = "Cycling_T", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Cycling_T <- filter(UCINI_Cycling_T, UCINI_Cycling_T$p_val_adj < 0.05)
UCINI_Cycling_T$cluster = ifelse(UCINI_Cycling_T$avg_logFC > 0,"I","NI")
UCINI_Cycling_T$gene = rownames(UCINI_Cycling_T)
UCIup_Cycling_T = filter(UCINI_Cycling_T, UCINI_Cycling_T$cluster == "I")
UCNIup_Cycling_T = filter(UCINI_Cycling_T, UCINI_Cycling_T$cluster == "NI")
write.csv(UCIup_Cycling_T, "Results/DE/UCIup_Cycling_T.csv")
write.csv(UCNIup_Cycling_T, "Results/DE/UCNIup_Cycling_T.csv")
GO_UCIup_Cycling_T=enrichr(UCIup_Cycling_T$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Cycling_T <- filter(GO_UCIup_Cycling_T, GO_UCIup_Cycling_T$Adjusted.P.value< 0.05)
GO_UCNIup_Cycling_T=enrichr(UCNIup_Cycling_T$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Cycling_T <- filter(GO_UCNIup_Cycling_T, GO_UCNIup_Cycling_T$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Cycling_T, "Results/DE/GO_UCNIup_Cycling_T.csv")
write.csv(GO_UCIup_Cycling_T, "Results/DE/GO_UCIup_Cycling_T.csv")

UCINI_IgM <- FindMarkers(data_UC, subset.ident = "IgM_plasma", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_IgM <- filter(UCINI_IgM, UCINI_IgM$p_val_adj < 0.05)
UCINI_IgM$cluster = ifelse(UCINI_IgM$avg_logFC > 0,"I","NI")
UCINI_IgM$gene = rownames(UCINI_IgM)
UCIup_IgM = filter(UCINI_IgM, UCINI_IgM$cluster == "I")
UCNIup_IgM = filter(UCINI_IgM, UCINI_IgM$cluster == "NI")
write.csv(UCIup_IgM, "Results/DE/UCIup_IgM.csv")
write.csv(UCNIup_IgM, "Results/DE/UCNIup_IgM.csv")
GO_UCIup_IgM=enrichr(UCIup_IgM$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_IgM <- filter(GO_UCIup_IgM, GO_UCIup_IgM$Adjusted.P.value< 0.05)
GO_UCNIup_IgM=enrichr(UCNIup_IgM$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_IgM <- filter(GO_UCNIup_IgM, GO_UCNIup_IgM$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_IgM, "Results/DE/GO_UCNIup_IgM.csv")
write.csv(GO_UCIup_IgM, "Results/DE/GO_UCIup_IgM.csv")

UCINI_imm_entero <- FindMarkers(data_UC, subset.ident = "Immature_enterocyte", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_imm_entero <- filter(UCINI_imm_entero, UCINI_imm_entero$p_val_adj < 0.05)
UCINI_imm_entero$cluster = ifelse(UCINI_imm_entero$avg_logFC > 0,"I","NI")
UCINI_imm_entero$gene = rownames(UCINI_imm_entero)
UCIup_imm_entero = filter(UCINI_imm_entero, UCINI_imm_entero$cluster == "I")
UCNIup_imm_entero = filter(UCINI_imm_entero, UCINI_imm_entero$cluster == "NI")
write.csv(UCIup_imm_entero, "Results/DE/UCIup_imm_entero.csv")
write.csv(UCNIup_imm_entero, "Results/DE/UCNIup_imm_entero.csv")
GO_UCIup_imm_entero=enrichr(UCIup_imm_entero$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_imm_entero <- filter(GO_UCIup_imm_entero, GO_UCIup_imm_entero$Adjusted.P.value< 0.05)
GO_UCNIup_imm_entero=enrichr(UCNIup_imm_entero$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_imm_entero <- filter(GO_UCNIup_imm_entero, GO_UCNIup_imm_entero$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_imm_entero, "Results/DE/GO_UCNIup_imm_entero.csv")
write.csv(GO_UCIup_imm_entero, "Results/DE/GO_UCIup_imm_entero.csv")

UCINI_Cycling_TA <- FindMarkers(data_UC, subset.ident = "Cycling_TA", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Cycling_TA <- filter(UCINI_Cycling_TA, UCINI_Cycling_TA$p_val_adj < 0.05)
UCINI_Cycling_TA$cluster = ifelse(UCINI_Cycling_TA$avg_logFC > 0,"I","NI")
UCINI_Cycling_TA$gene = rownames(UCINI_Cycling_TA)
UCIup_Cycling_TA = filter(UCINI_Cycling_TA, UCINI_Cycling_TA$cluster == "I")
UCNIup_Cycling_TA = filter(UCINI_Cycling_TA, UCINI_Cycling_TA$cluster == "NI")
write.csv(UCIup_Cycling_TA, "Results/DE/UCIup_Cycling_TA.csv")
write.csv(UCNIup_Cycling_TA, "Results/DE/UCNIup_Cycling_TA.csv")
GO_UCIup_Cycling_TA=enrichr(UCIup_Cycling_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Cycling_TA <- filter(GO_UCIup_Cycling_TA, GO_UCIup_Cycling_TA$Adjusted.P.value< 0.05)
GO_UCNIup_Cycling_TA=enrichr(UCNIup_Cycling_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Cycling_TA <- filter(GO_UCNIup_Cycling_TA, GO_UCNIup_Cycling_TA$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Cycling_TA, "Results/DE/GO_UCNIup_Cycling_TA.csv")
write.csv(GO_UCIup_Cycling_TA, "Results/DE/GO_UCIup_Cycling_TA.csv")

UCINI_Ribo_TA <- FindMarkers(data_UC, subset.ident = "Ribo_TA", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Ribo_TA <- filter(UCINI_Ribo_TA, UCINI_Ribo_TA$p_val_adj < 0.05)
UCINI_Ribo_TA$cluster = ifelse(UCINI_Ribo_TA$avg_logFC > 0,"I","NI")
UCINI_Ribo_TA$gene = rownames(UCINI_Ribo_TA)
UCIup_Ribo_TA = filter(UCINI_Ribo_TA, UCINI_Ribo_TA$cluster == "I")
UCNIup_Ribo_TA = filter(UCINI_Ribo_TA, UCINI_Ribo_TA$cluster == "NI")
write.csv(UCIup_Ribo_TA, "Results/DE/UCIup_Ribo_TA.csv")
write.csv(UCNIup_Ribo_TA, "Results/DE/UCNIup_Ribo_TA.csv")
GO_UCIup_Ribo_TA=enrichr(UCIup_Ribo_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Ribo_TA <- filter(GO_UCIup_Ribo_TA, GO_UCIup_Ribo_TA$Adjusted.P.value< 0.05)
GO_UCNIup_Ribo_TA=enrichr(UCNIup_Ribo_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Ribo_TA <- filter(GO_UCNIup_Ribo_TA, GO_UCNIup_Ribo_TA$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Ribo_TA, "Results/DE/GO_UCNIup_Ribo_TA.csv")
write.csv(GO_UCIup_Ribo_TA, "Results/DE/GO_UCIup_Ribo_TA.csv")

UCINI_BEST4 <- FindMarkers(data_UC, subset.ident = "BEST4_enterocyte", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_BEST4 <- filter(UCINI_BEST4, UCINI_BEST4$p_val_adj < 0.05)
UCINI_BEST4$cluster = ifelse(UCINI_BEST4$avg_logFC > 0,"I","NI")
UCINI_BEST4$gene = rownames(UCINI_BEST4)
UCIup_BEST4 = filter(UCINI_BEST4, UCINI_BEST4$cluster == "I")
UCNIup_BEST4 = filter(UCINI_BEST4, UCINI_BEST4$cluster == "NI")
write.csv(UCIup_BEST4, "Results/DE/UCIup_BEST4.csv")
write.csv(UCNIup_BEST4, "Results/DE/UCNIup_BEST4.csv")
GO_UCIup_BEST4=enrichr(UCIup_BEST4$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_BEST4 <- filter(GO_UCIup_BEST4, GO_UCIup_BEST4$Adjusted.P.value< 0.05)
GO_UCNIup_BEST4=enrichr(UCNIup_BEST4$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_BEST4 <- filter(GO_UCNIup_BEST4, GO_UCNIup_BEST4$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_BEST4, "Results/DE/GO_UCNIup_BEST4.csv")
write.csv(GO_UCIup_BEST4, "Results/DE/GO_UCIup_BEST4.csv")

UCINI_imm_goblet <- FindMarkers(data_UC, subset.ident = "Immature_goblet", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_imm_goblet <- filter(UCINI_imm_goblet, UCINI_imm_goblet$p_val_adj < 0.05)
UCINI_imm_goblet$cluster = ifelse(UCINI_imm_goblet$avg_logFC > 0,"I","NI")
UCINI_imm_goblet$gene = rownames(UCINI_imm_goblet)
UCIup_imm_goblet = filter(UCINI_imm_goblet, UCINI_imm_goblet$cluster == "I")
UCNIup_imm_goblet = filter(UCINI_imm_goblet, UCINI_imm_goblet$cluster == "NI")
write.csv(UCIup_imm_goblet, "Results/DE/UCIup_imm_goblet.csv")
write.csv(UCNIup_imm_goblet, "Results/DE/UCNIup_imm_goblet.csv")
GO_UCIup_imm_goblet=enrichr(UCIup_imm_goblet$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_imm_goblet <- filter(GO_UCIup_imm_goblet, GO_UCIup_imm_goblet$Adjusted.P.value< 0.05)
GO_UCNIup_imm_goblet=enrichr(UCNIup_imm_goblet$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_imm_goblet <- filter(GO_UCNIup_imm_goblet, GO_UCNIup_imm_goblet$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_imm_goblet, "Results/DE/GO_UCNIup_imm_goblet.csv")
write.csv(GO_UCIup_imm_goblet, "Results/DE/GO_UCIup_imm_goblet.csv")

UCINI_DUOX2 <- FindMarkers(data_UC, subset.ident = "DUOX2_enterocyte", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_DUOX2 <- filter(UCINI_DUOX2, UCINI_DUOX2$p_val_adj < 0.05)
UCINI_DUOX2$cluster = ifelse(UCINI_DUOX2$avg_logFC > 0,"I","NI")
UCINI_DUOX2$gene = rownames(UCINI_DUOX2)
UCIup_DUOX2 = filter(UCINI_DUOX2, UCINI_DUOX2$cluster == "I")
UCNIup_DUOX2 = filter(UCINI_DUOX2, UCINI_DUOX2$cluster == "NI")
write.csv(UCIup_DUOX2, "Results/DE/UCIup_DUOX2.csv")
write.csv(UCNIup_DUOX2, "Results/DE/UCNIup_DUOX2.csv")
GO_UCIup_DUOX2=enrichr(UCIup_DUOX2$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_DUOX2 <- filter(GO_UCIup_DUOX2, GO_UCIup_DUOX2$Adjusted.P.value< 0.05)
GO_UCNIup_DUOX2=enrichr(UCNIup_DUOX2$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_DUOX2 <- filter(GO_UCNIup_DUOX2, GO_UCNIup_DUOX2$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_DUOX2, "Results/DE/GO_UCNIup_DUOX2.csv")
write.csv(GO_UCIup_DUOX2, "Results/DE/GO_UCIup_DUOX2.csv")

UCINI_PLCG2_TA <- FindMarkers(data_UC, subset.ident = "PLCG2_TA", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_PLCG2_TA <- filter(UCINI_PLCG2_TA, UCINI_PLCG2_TA$p_val_adj < 0.05)
UCINI_PLCG2_TA$cluster = ifelse(UCINI_PLCG2_TA$avg_logFC > 0,"I","NI")
UCINI_PLCG2_TA$gene = rownames(UCINI_PLCG2_TA)
UCIup_PLCG2_TA = filter(UCINI_PLCG2_TA, UCINI_PLCG2_TA$cluster == "I")
UCNIup_PLCG2_TA = filter(UCINI_PLCG2_TA, UCINI_PLCG2_TA$cluster == "NI")
write.csv(UCIup_PLCG2_TA, "Results/DE/UCIup_PLCG2_TA.csv")
write.csv(UCNIup_PLCG2_TA, "Results/DE/UCNIup_PLCG2_TA.csv")
GO_UCIup_PLCG2_TA=enrichr(UCIup_PLCG2_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_PLCG2_TA <- filter(GO_UCIup_PLCG2_TA, GO_UCIup_PLCG2_TA$Adjusted.P.value< 0.05)
GO_UCNIup_PLCG2_TA=enrichr(UCNIup_PLCG2_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_PLCG2_TA <- filter(GO_UCNIup_PLCG2_TA, GO_UCNIup_PLCG2_TA$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_PLCG2_TA, "Results/DE/GO_UCNIup_PLCG2_TA.csv")
write.csv(GO_UCIup_PLCG2_TA, "Results/DE/GO_UCIup_PLCG2_TA.csv")

UCINI_Absorptive_TA <- FindMarkers(data_UC, subset.ident = "Absorptive_TA", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Absorptive_TA <- filter(UCINI_Absorptive_TA, UCINI_Absorptive_TA$p_val_adj < 0.05)
UCINI_Absorptive_TA$cluster = ifelse(UCINI_Absorptive_TA$avg_logFC > 0,"I","NI")
UCINI_Absorptive_TA$gene = rownames(UCINI_Absorptive_TA)
UCIup_Absorptive_TA = filter(UCINI_Absorptive_TA, UCINI_Absorptive_TA$cluster == "I")
UCNIup_Absorptive_TA = filter(UCINI_Absorptive_TA, UCINI_Absorptive_TA$cluster == "NI")
write.csv(UCIup_Absorptive_TA, "Results/DE/UCIup_Absorptive_TA.csv")
write.csv(UCNIup_Absorptive_TA, "Results/DE/UCNIup_Absorptive_TA.csv")
GO_UCIup_Absorptive_TA=enrichr(UCIup_Absorptive_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Absorptive_TA <- filter(GO_UCIup_Absorptive_TA, GO_UCIup_Absorptive_TA$Adjusted.P.value< 0.05)
GO_UCNIup_Absorptive_TA=enrichr(UCNIup_Absorptive_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Absorptive_TA <- filter(GO_UCNIup_Absorptive_TA, GO_UCNIup_Absorptive_TA$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Absorptive_TA, "Results/DE/GO_UCNIup_Absorptive_TA.csv")
write.csv(GO_UCIup_Absorptive_TA, "Results/DE/GO_UCIup_Absorptive_TA.csv")

UCINI_Tuft <- FindMarkers(data_UC, subset.ident = "Tuft", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Tuft <- filter(UCINI_Tuft, UCINI_Tuft$p_val_adj < 0.05)
UCINI_Tuft$cluster = ifelse(UCINI_Tuft$avg_logFC > 0,"I","NI")
UCINI_Tuft$gene = rownames(UCINI_Tuft)
UCIup_Tuft = filter(UCINI_Tuft, UCINI_Tuft$cluster == "I")
UCNIup_Tuft = filter(UCINI_Tuft, UCINI_Tuft$cluster == "NI")
write.csv(UCIup_Tuft, "Results/DE/UCIup_Tuft.csv")
write.csv(UCNIup_Tuft, "Results/DE/UCNIup_Tuft.csv")
GO_UCIup_Tuft=enrichr(UCIup_Tuft$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Tuft <- filter(GO_UCIup_Tuft, GO_UCIup_Tuft$Adjusted.P.value< 0.05)
GO_UCNIup_Tuft=enrichr(UCNIup_Tuft$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Tuft <- filter(GO_UCNIup_Tuft, GO_UCNIup_Tuft$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Tuft, "Results/DE/GO_UCNIup_Tuft.csv")
write.csv(GO_UCIup_Tuft, "Results/DE/GO_UCIup_Tuft.csv")

UCINI_REG_TA <- FindMarkers(data_UC, subset.ident = "REG_TA", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_REG_TA <- filter(UCINI_REG_TA, UCINI_REG_TA$p_val_adj < 0.05)
UCINI_REG_TA$cluster = ifelse(UCINI_REG_TA$avg_logFC > 0,"I","NI")
UCINI_REG_TA$gene = rownames(UCINI_REG_TA)
UCIup_REG_TA = filter(UCINI_REG_TA, UCINI_REG_TA$cluster == "I")
UCNIup_REG_TA = filter(UCINI_REG_TA, UCINI_REG_TA$cluster == "NI")
write.csv(UCIup_REG_TA, "Results/DE/UCIup_REG_TA.csv")
write.csv(UCNIup_REG_TA, "Results/DE/UCNIup_REG_TA.csv")
GO_UCIup_REG_TA=enrichr(UCIup_REG_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_REG_TA <- filter(GO_UCIup_REG_TA, GO_UCIup_REG_TA$Adjusted.P.value< 0.05)
GO_UCNIup_REG_TA=enrichr(UCNIup_REG_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_REG_TA <- filter(GO_UCNIup_REG_TA, GO_UCNIup_REG_TA$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_REG_TA, "Results/DE/GO_UCNIup_REG_TA.csv")
write.csv(GO_UCIup_REG_TA, "Results/DE/GO_UCIup_REG_TA.csv")

########### novel immune cell types
#infl_vs_nINf

Idents(data)<-"celltypes"

Inflammation_Activated_B <- FindMarkers(data, subset.ident = "Activated_B", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_Activated_B <- filter(Inflammation_Activated_B, Inflammation_Activated_B$p_val_adj < 0.05)
Inflammation_Activated_B$cluster = ifelse(Inflammation_Activated_B$avg_logFC > 0,"I","NI")
Inflammation_Activated_B$gene = rownames(Inflammation_Activated_B)
Iup_Activated_B = filter(Inflammation_Activated_B, Inflammation_Activated_B$cluster == "I")
NIup_Activated_B = filter(Inflammation_Activated_B, Inflammation_Activated_B$cluster == "NI")
write.csv(Iup_Activated_B, "Results/DE/Iup_Activated_B.csv")
write.csv(NIup_Activated_B, "Results/DE/NIup_Activated_B.csv")

#IBD_vs_HC
Disease_Activated_B <- FindMarkers(data, subset.ident = "Activated_B", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_Activated_B <- filter(Disease_Activated_B, Disease_Activated_B$p_val_adj < 0.05)
Disease_Activated_B$cluster = ifelse(Disease_Activated_B$avg_logFC > 0,"IBD","HC")
Disease_Activated_B$gene = rownames(Disease_Activated_B)
IBDup_Activated_B = filter(Disease_Activated_B, Disease_Activated_B$cluster == "IBD")
HCup_Activated_B = filter(Disease_Activated_B, Disease_Activated_B$cluster == "HC")
write.csv(IBDup_Activated_B, "Results/DE/IBDup_Activated_B.csv")
write.csv(HCup_Activated_B, "Results/DE/HCup_Activated_B.csv")

## PSC vs non PSC

PSC_Activated_B <- FindMarkers(data, subset.ident = "Activated_B", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "HC"), ident.2 = "PSC")
PSC_Activated_B <- filter(PSC_Activated_B, PSC_Activated_B$p_val_adj < 0.05)
PSC_Activated_B$cluster = ifelse(PSC_Activated_B$avg_logFC > 0,"non-PSC","PSC")
PSC_Activated_B$gene = rownames(PSC_Activated_B)
nonPSCup_Activated_B = filter(PSC_Activated_B, PSC_Activated_B$cluster == "non-PSC")
PSCup_Activated_B = filter(PSC_Activated_B, PSC_Activated_B$cluster == "PSC")
write.csv(nonPSCup_Activated_B, "Results/DE/nonPSCup_Activated_B.csv")
write.csv(PSCup_Activated_B, "Results/DE/PSCup_Activated_B.csv")

## paired_PSC
PSCINI_Activated_B <- FindMarkers(data_PSC, subset.ident = "Activated_B", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Activated_B <- filter(PSCINI_Activated_B, PSCINI_Activated_B$p_val_adj < 0.05)
PSCINI_Activated_B$cluster = ifelse(PSCINI_Activated_B$avg_logFC > 0,"I","NI")
PSCINI_Activated_B$gene = rownames(PSCINI_Activated_B)
PSCIup_Activated_B = filter(PSCINI_Activated_B, PSCINI_Activated_B$cluster == "I")
PSCNIup_Activated_B = filter(PSCINI_Activated_B, PSCINI_Activated_B$cluster == "NI")
write.csv(PSCIup_Activated_B, "Results/DE/PSCIup_Activated_B.csv")
write.csv(PSCNIup_Activated_B, "Results/DE/PSCNIup_Activated_B.csv")
GO_PSCIup_Activated_B=enrichr(PSCIup_Activated_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Activated_B <- filter(GO_PSCIup_Activated_B, GO_PSCIup_Activated_B$Adjusted.P.value< 0.05)
GO_PSCNIup_Activated_B=enrichr(PSCNIup_Activated_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Activated_B <- filter(GO_PSCNIup_Activated_B, GO_PSCNIup_Activated_B$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Activated_B, "Results/DE/GO_PSCNIup_Activated_B.csv")
write.csv(GO_PSCIup_Activated_B, "Results/DE/GO_PSCIup_Activated_B.csv")

#UCI_NI
UCINI_Activated_B <- FindMarkers(data_UC, subset.ident = "Activated_B", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Activated_B <- filter(UCINI_Activated_B, UCINI_Activated_B$p_val_adj < 0.05)
UCINI_Activated_B$cluster = ifelse(UCINI_Activated_B$avg_logFC > 0,"I","NI")
UCINI_Activated_B$gene = rownames(UCINI_Activated_B)
UCIup_Activated_B = filter(UCINI_Activated_B, UCINI_Activated_B$cluster == "I")
UCNIup_Activated_B = filter(UCINI_Activated_B, UCINI_Activated_B$cluster == "NI")
write.csv(UCIup_Activated_B, "Results/DE/UCIup_Activated_B.csv")
write.csv(UCNIup_Activated_B, "Results/DE/UCNIup_Activated_B.csv")
GO_UCIup_Activated_B=enrichr(UCIup_Activated_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Activated_B <- filter(GO_UCIup_Activated_B, GO_UCIup_Activated_B$Adjusted.P.value< 0.05)
GO_UCNIup_Activated_B=enrichr(UCNIup_Activated_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Activated_B <- filter(GO_UCNIup_Activated_B, GO_UCNIup_Activated_B$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Activated_B, "Results/DE/GO_UCNIup_Activated_B.csv")
write.csv(GO_UCIup_Activated_B, "Results/DE/GO_UCIup_Activated_B.csv")

#
Disease2_Activated_B <- FindMarkers(data, subset.ident = "Activated_B", group.by = "state", test.use = "MAST", ident.1 = "UC-NI", ident.2 = "HC-NI")
Disease2_Activated_B <- filter(Disease2_Activated_B, Disease2_Activated_B$p_val_adj < 0.05)
Disease2_Activated_B$cluster = ifelse(Disease2_Activated_B$avg_logFC > 0,"UC-NI","HC-NI")
Disease2_Activated_B$gene = rownames(Disease2_Activated_B)
UC_NIup_Activated_B = filter(Disease2_Activated_B, Disease2_Activated_B$cluster == "UC-NI")
HC_NIup_Activated_B = filter(Disease2_Activated_B, Disease2_Activated_B$cluster == "HC-NI")
write.csv(UC_NIup_Activated_B, "Results/DE/UCNIupvsHC-NI_Activated_B.csv")
write.csv(HC_NIup_Activated_B, "Results/DE/HC_NIupvsUCNI_Activated_B.csv")

Disease1_Activated_B <- FindMarkers(data, subset.ident = "Activated_B", group.by = "state", test.use = "MAST", ident.1 = "PSC-NI", ident.2 = "HC-NI")
Disease1_Activated_B <- filter(Disease1_Activated_B, Disease1_Activated_B$p_val_adj < 0.05)
Disease1_Activated_B$cluster = ifelse(Disease1_Activated_B$avg_logFC > 0,"PSC-NI","HC-NI")
Disease1_Activated_B$gene = rownames(Disease1_Activated_B)
PSC_NIup_Activated_B = filter(Disease1_Activated_B, Disease1_Activated_B$cluster == "PSC-NI")
HC_NIup_Activated_B = filter(Disease1_Activated_B, Disease1_Activated_B$cluster == "HC-NI")
write.csv(PSC_NIup_Activated_B, "Results/DE/PSCNIupvsHC-NI_Activated_B.csv")
write.csv(HC_NIup_Activated_B, "Results/DE/HC_NIupvsPSCNI_Activated_B.csv")

Disease3_Activated_B <- FindMarkers(data, subset.ident = "Activated_B", group.by = "state", test.use = "MAST", ident.1 = "PSC-I", ident.2 = "HC-NI")
Disease3_Activated_B <- filter(Disease3_Activated_B, Disease3_Activated_B$p_val_adj < 0.05)
Disease3_Activated_B$cluster = ifelse(Disease3_Activated_B$avg_logFC > 0,"PSC-I","HC-NI")
Disease3_Activated_B$gene = rownames(Disease3_Activated_B)
PSC_Iup_Activated_B = filter(Disease3_Activated_B, Disease3_Activated_B$cluster == "PSC-I")
HC_NIup_Activated_B = filter(Disease3_Activated_B, Disease3_Activated_B$cluster == "HC-NI")
write.csv(PSC_Iup_Activated_B, "Results/DE/PSCIupvsHC-NI_Activated_B.csv")
write.csv(HC_NIup_Activated_B, "Results/DE/HC_NIupvsPSCI_Activated_B.csv")

Disease4_Activated_B <- FindMarkers(data, subset.ident = "Activated_B", group.by = "state", test.use = "MAST", ident.1 = "UC-I", ident.2 = "HC-NI")
Disease4_Activated_B <- filter(Disease4_Activated_B, Disease4_Activated_B$p_val_adj < 0.05)
Disease4_Activated_B$cluster = ifelse(Disease4_Activated_B$avg_logFC > 0,"UC-I","HC-NI")
Disease4_Activated_B$gene = rownames(Disease4_Activated_B)
UC_Iup_Activated_B = filter(Disease4_Activated_B, Disease4_Activated_B$cluster == "UC-I")
HC_NIup_Activated_B = filter(Disease4_Activated_B, Disease4_Activated_B$cluster == "HC-NI")
write.csv(UC_Iup_Activated_B, "Results/DE/UCIupvsHC-NI_Activated_B.csv")
write.csv(HC_NIup_Activated_B, "Results/DE/HC_NIupvsUCI_Activated_B.csv")

#####
Idents(data)<-"celltypes"

Inflammation_MAIT <- FindMarkers(data, subset.ident = "MAIT", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_MAIT <- filter(Inflammation_MAIT, Inflammation_MAIT$p_val_adj < 0.05)
Inflammation_MAIT$cluster = ifelse(Inflammation_MAIT$avg_logFC > 0,"I","NI")
Inflammation_MAIT$gene = rownames(Inflammation_MAIT)
Iup_MAIT = filter(Inflammation_MAIT, Inflammation_MAIT$cluster == "I")
NIup_MAIT = filter(Inflammation_MAIT, Inflammation_MAIT$cluster == "NI")
write.csv(Iup_MAIT, "Results/DE/Iup_MAIT.csv")
write.csv(NIup_MAIT, "Results/DE/NIup_MAIT.csv")

#IBD_vs_HC
Disease_MAIT <- FindMarkers(data, subset.ident = "MAIT", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_MAIT <- filter(Disease_MAIT, Disease_MAIT$p_val_adj < 0.05)
Disease_MAIT$cluster = ifelse(Disease_MAIT$avg_logFC > 0,"IBD","HC")
Disease_MAIT$gene = rownames(Disease_MAIT)
IBDup_MAIT = filter(Disease_MAIT, Disease_MAIT$cluster == "IBD")
HCup_MAIT = filter(Disease_MAIT, Disease_MAIT$cluster == "HC")
write.csv(IBDup_MAIT, "Results/DE/IBDup_MAIT.csv")
write.csv(HCup_MAIT, "Results/DE/HCup_MAIT.csv")

## PSC vs non PSC

PSC_MAIT <- FindMarkers(data, subset.ident = "MAIT", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "HC"), ident.2 = "PSC")
PSC_MAIT <- filter(PSC_MAIT, PSC_MAIT$p_val_adj < 0.05)
PSC_MAIT$cluster = ifelse(PSC_MAIT$avg_logFC > 0,"non-PSC","PSC")
PSC_MAIT$gene = rownames(PSC_MAIT)
nonPSCup_MAIT = filter(PSC_MAIT, PSC_MAIT$cluster == "non-PSC")
PSCup_MAIT = filter(PSC_MAIT, PSC_MAIT$cluster == "PSC")
write.csv(nonPSCup_MAIT, "Results/DE/nonPSCup_MAIT.csv")
write.csv(PSCup_MAIT, "Results/DE/PSCup_MAIT.csv")

## paired_PSC
PSCINI_MAIT <- FindMarkers(data_PSC, subset.ident = "MAIT", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_MAIT <- filter(PSCINI_MAIT, PSCINI_MAIT$p_val_adj < 0.05)
PSCINI_MAIT$cluster = ifelse(PSCINI_MAIT$avg_logFC > 0,"I","NI")
PSCINI_MAIT$gene = rownames(PSCINI_MAIT)
PSCIup_MAIT = filter(PSCINI_MAIT, PSCINI_MAIT$cluster == "I")
PSCNIup_MAIT = filter(PSCINI_MAIT, PSCINI_MAIT$cluster == "NI")
write.csv(PSCIup_MAIT, "Results/DE/PSCIup_MAIT.csv")
write.csv(PSCNIup_MAIT, "Results/DE/PSCNIup_MAIT.csv")
GO_PSCIup_MAIT=enrichr(PSCIup_MAIT$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_MAIT <- filter(GO_PSCIup_MAIT, GO_PSCIup_MAIT$Adjusted.P.value< 0.05)
GO_PSCNIup_MAIT=enrichr(PSCNIup_MAIT$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_MAIT <- filter(GO_PSCNIup_MAIT, GO_PSCNIup_MAIT$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_MAIT, "Results/DE/GO_PSCNIup_MAIT.csv")
write.csv(GO_PSCIup_MAIT, "Results/DE/GO_PSCIup_MAIT.csv")

#UCI_NI
UCINI_MAIT <- FindMarkers(data_UC, subset.ident = "MAIT", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_MAIT <- filter(UCINI_MAIT, UCINI_MAIT$p_val_adj < 0.05)
UCINI_MAIT$cluster = ifelse(UCINI_MAIT$avg_logFC > 0,"I","NI")
UCINI_MAIT$gene = rownames(UCINI_MAIT)
UCIup_MAIT = filter(UCINI_MAIT, UCINI_MAIT$cluster == "I")
UCNIup_MAIT = filter(UCINI_MAIT, UCINI_MAIT$cluster == "NI")
write.csv(UCIup_MAIT, "Results/DE/UCIup_MAIT.csv")
write.csv(UCNIup_MAIT, "Results/DE/UCNIup_MAIT.csv")
GO_UCIup_MAIT=enrichr(UCIup_MAIT$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_MAIT <- filter(GO_UCIup_MAIT, GO_UCIup_MAIT$Adjusted.P.value< 0.05)
GO_UCNIup_MAIT=enrichr(UCNIup_MAIT$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_MAIT <- filter(GO_UCNIup_MAIT, GO_UCNIup_MAIT$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_MAIT, "Results/DE/GO_UCNIup_MAIT.csv")
write.csv(GO_UCIup_MAIT, "Results/DE/GO_UCIup_MAIT.csv")

#
Disease2_MAIT <- FindMarkers(data, subset.ident = "MAIT", group.by = "state", test.use = "MAST", ident.1 = "UC-NI", ident.2 = "HC-NI")
Disease2_MAIT <- filter(Disease2_MAIT, Disease2_MAIT$p_val_adj < 0.05)
Disease2_MAIT$cluster = ifelse(Disease2_MAIT$avg_logFC > 0,"UC-NI","HC-NI")
Disease2_MAIT$gene = rownames(Disease2_MAIT)
UC_NIup_MAIT = filter(Disease2_MAIT, Disease2_MAIT$cluster == "UC-NI")
HC_NIup_MAIT = filter(Disease2_MAIT, Disease2_MAIT$cluster == "HC-NI")
write.csv(UC_NIup_MAIT, "Results/DE/UCNIupvsHCNI_MAIT.csv")
write.csv(HC_NIup_MAIT, "Results/DE/HC_NIupvsUCNI_MAIT.csv")

Disease1_MAIT <- FindMarkers(data, subset.ident = "MAIT", group.by = "state", test.use = "MAST", ident.1 = "PSC-NI", ident.2 = "HC-NI")
Disease1_MAIT <- filter(Disease1_MAIT, Disease1_MAIT$p_val_adj < 0.05)
Disease1_MAIT$cluster = ifelse(Disease1_MAIT$avg_logFC > 0,"PSC-NI","HC-NI")
Disease1_MAIT$gene = rownames(Disease1_MAIT)
PSC_NIup_MAIT = filter(Disease1_MAIT, Disease1_MAIT$cluster == "PSC-NI")
HC_NIup_MAIT = filter(Disease1_MAIT, Disease1_MAIT$cluster == "HC-NI")
write.csv(PSC_NIup_MAIT, "Results/DE/PSCNIupvsHCNI_MAIT.csv")
write.csv(HC_NIup_MAIT, "Results/DE/HC_NIupvsPSCNI_MAIT.csv")

Disease3_MAIT <- FindMarkers(data, subset.ident = "MAIT", group.by = "state", test.use = "MAST", ident.1 = "PSC-I", ident.2 = "HC-NI")
Disease3_MAIT <- filter(Disease3_MAIT, Disease3_MAIT$p_val_adj < 0.05)
Disease3_MAIT$cluster = ifelse(Disease3_MAIT$avg_logFC > 0,"PSC-I","HC-NI")
Disease3_MAIT$gene = rownames(Disease3_MAIT)
PSC_Iup_MAIT = filter(Disease3_MAIT, Disease3_MAIT$cluster == "PSC-I")
HC_NIup_MAIT = filter(Disease3_MAIT, Disease3_MAIT$cluster == "HC-NI")
write.csv(PSC_Iup_MAIT, "Results/DE/PSCIupvsHCNI_MAIT.csv")
write.csv(HC_NIup_MAIT, "Results/DE/HC_NIupvsPSCI_MAIT.csv")

Disease4_MAIT <- FindMarkers(data, subset.ident = "MAIT", group.by = "state", test.use = "MAST", ident.1 = "UC-I", ident.2 = "HC-NI")
Disease4_MAIT <- filter(Disease4_MAIT, Disease4_MAIT$p_val_adj < 0.05)
Disease4_MAIT$cluster = ifelse(Disease4_MAIT$avg_logFC > 0,"UC-I","HC-NI")
Disease4_MAIT$gene = rownames(Disease4_MAIT)
UC_Iup_MAIT = filter(Disease4_MAIT, Disease4_MAIT$cluster == "UC-I")
HC_NIup_MAIT = filter(Disease4_MAIT, Disease4_MAIT$cluster == "HC-NI")
write.csv(UC_Iup_MAIT, "Results/DE/UCIupvsHCNI_MAIT.csv")
write.csv(HC_NIup_MAIT, "Results/DE/HC_NIupvsUCI_MAIT.csv")



#######
Inflammation_Cycling_T <- FindMarkers(data, subset.ident = "Cycling_T", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_Cycling_T <- filter(Inflammation_Cycling_T, Inflammation_Cycling_T$p_val_adj < 0.05)
Inflammation_Cycling_T$cluster = ifelse(Inflammation_Cycling_T$avg_logFC > 0,"I","NI")
Inflammation_Cycling_T$gene = rownames(Inflammation_Cycling_T)
Iup_Cycling_T = filter(Inflammation_Cycling_T, Inflammation_Cycling_T$cluster == "I")
NIup_Cycling_T = filter(Inflammation_Cycling_T, Inflammation_Cycling_T$cluster == "NI")
write.csv(Iup_Cycling_T, "Results/DE/Iup_Cycling_T.csv")
write.csv(NIup_Cycling_T, "Results/DE/NIup_Cycling_T.csv")

#IBD_vs_HC
Disease_Cycling_T <- FindMarkers(data, subset.ident = "Cycling_T", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_Cycling_T <- filter(Disease_Cycling_T, Disease_Cycling_T$p_val_adj < 0.05)
Disease_Cycling_T$cluster = ifelse(Disease_Cycling_T$avg_logFC > 0,"IBD","HC")
Disease_Cycling_T$gene = rownames(Disease_Cycling_T)
IBDup_Cycling_T = filter(Disease_Cycling_T, Disease_Cycling_T$cluster == "IBD")
HCup_Cycling_T = filter(Disease_Cycling_T, Disease_Cycling_T$cluster == "HC")
write.csv(IBDup_Cycling_T, "Results/DE/IBDup_Cycling_T.csv")
write.csv(HCup_Cycling_T, "Results/DE/HCup_Cycling_T.csv")

## PSC vs non PSC

PSC_Cycling_T <- FindMarkers(data, subset.ident = "Cycling_T", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "HC"), ident.2 = "PSC")
PSC_Cycling_T <- filter(PSC_Cycling_T, PSC_Cycling_T$p_val_adj < 0.05)
PSC_Cycling_T$cluster = ifelse(PSC_Cycling_T$avg_logFC > 0,"non-PSC","PSC")
PSC_Cycling_T$gene = rownames(PSC_Cycling_T)
nonPSCup_Cycling_T = filter(PSC_Cycling_T, PSC_Cycling_T$cluster == "non-PSC")
PSCup_Cycling_T = filter(PSC_Cycling_T, PSC_Cycling_T$cluster == "PSC")
write.csv(nonPSCup_Cycling_T, "Results/DE/nonPSCup_Cycling_T.csv")
write.csv(PSCup_Cycling_T, "Results/DE/PSCup_Cycling_T.csv")

## paired_PSC
PSCINI_Cycling_T <- FindMarkers(data_PSC, subset.ident = "Cycling_T", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Cycling_T <- filter(PSCINI_Cycling_T, PSCINI_Cycling_T$p_val_adj < 0.05)
PSCINI_Cycling_T$cluster = ifelse(PSCINI_Cycling_T$avg_logFC > 0,"I","NI")
PSCINI_Cycling_T$gene = rownames(PSCINI_Cycling_T)
PSCIup_Cycling_T = filter(PSCINI_Cycling_T, PSCINI_Cycling_T$cluster == "I")
PSCNIup_Cycling_T = filter(PSCINI_Cycling_T, PSCINI_Cycling_T$cluster == "NI")
write.csv(PSCIup_Cycling_T, "Results/DE/PSCIup_Cycling_T.csv")
write.csv(PSCNIup_Cycling_T, "Results/DE/PSCNIup_Cycling_T.csv")
GO_PSCIup_Cycling_T=enrichr(PSCIup_Cycling_T$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Cycling_T <- filter(GO_PSCIup_Cycling_T, GO_PSCIup_Cycling_T$Adjusted.P.value< 0.05)
GO_PSCNIup_Cycling_T=enrichr(PSCNIup_Cycling_T$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Cycling_T <- filter(GO_PSCNIup_Cycling_T, GO_PSCNIup_Cycling_T$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Cycling_T, "Results/DE/GO_PSCNIup_Cycling_T.csv")
write.csv(GO_PSCIup_Cycling_T, "Results/DE/GO_PSCIup_Cycling_T.csv")

#UCI_NI
UCINI_Cycling_T <- FindMarkers(data_UC, subset.ident = "Cycling_T", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Cycling_T <- filter(UCINI_Cycling_T, UCINI_Cycling_T$p_val_adj < 0.05)
UCINI_Cycling_T$cluster = ifelse(UCINI_Cycling_T$avg_logFC > 0,"I","NI")
UCINI_Cycling_T$gene = rownames(UCINI_Cycling_T)
UCIup_Cycling_T = filter(UCINI_Cycling_T, UCINI_Cycling_T$cluster == "I")
UCNIup_Cycling_T = filter(UCINI_Cycling_T, UCINI_Cycling_T$cluster == "NI")
write.csv(UCIup_Cycling_T, "Results/DE/UCIup_Cycling_T.csv")
write.csv(UCNIup_Cycling_T, "Results/DE/UCNIup_Cycling_T.csv")
GO_UCIup_Cycling_T=enrichr(UCIup_Cycling_T$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Cycling_T <- filter(GO_UCIup_Cycling_T, GO_UCIup_Cycling_T$Adjusted.P.value< 0.05)
GO_UCNIup_Cycling_T=enrichr(UCNIup_Cycling_T$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Cycling_T <- filter(GO_UCNIup_Cycling_T, GO_UCNIup_Cycling_T$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Cycling_T, "Results/DE/GO_UCNIup_Cycling_T.csv")
write.csv(GO_UCIup_Cycling_T, "Results/DE/GO_UCIup_Cycling_T.csv")

#
Disease2_Cycling_T <- FindMarkers(data, subset.ident = "Cycling_T", group.by = "state", test.use = "MAST", ident.1 = "UC-NI", ident.2 = "HC-NI")
Disease2_Cycling_T <- filter(Disease2_Cycling_T, Disease2_Cycling_T$p_val_adj < 0.05)
Disease2_Cycling_T$cluster = ifelse(Disease2_Cycling_T$avg_logFC > 0,"UC-NI","HC-NI")
Disease2_Cycling_T$gene = rownames(Disease2_Cycling_T)
UC_NIup_Cycling_T = filter(Disease2_Cycling_T, Disease2_Cycling_T$cluster == "UC-NI")
HC_NIup_Cycling_T = filter(Disease2_Cycling_T, Disease2_Cycling_T$cluster == "HC-NI")
write.csv(UC_NIup_Cycling_T, "Results/DE/UCNIupvsHCNI_Cycling_T.csv")
write.csv(HC_NIup_Cycling_T, "Results/DE/HC_NIupvsUCNI_Cycling_T.csv")

Disease1_Cycling_T <- FindMarkers(data, subset.ident = "Cycling_T", group.by = "state", test.use = "MAST", ident.1 = "PSC-NI", ident.2 = "HC-NI")
Disease1_Cycling_T <- filter(Disease1_Cycling_T, Disease1_Cycling_T$p_val_adj < 0.05)
Disease1_Cycling_T$cluster = ifelse(Disease1_Cycling_T$avg_logFC > 0,"PSC-NI","HC-NI")
Disease1_Cycling_T$gene = rownames(Disease1_Cycling_T)
PSC_NIup_Cycling_T = filter(Disease1_Cycling_T, Disease1_Cycling_T$cluster == "PSC-NI")
HC_NIup_Cycling_T = filter(Disease1_Cycling_T, Disease1_Cycling_T$cluster == "HC-NI")
write.csv(PSC_NIup_Cycling_T, "Results/DE/PSCNIupvsHCNI_Cycling_T.csv")
write.csv(HC_NIup_Cycling_T, "Results/DE/HC_NIupvsPSCNI_Cycling_T.csv")

Disease3_Cycling_T <- FindMarkers(data, subset.ident = "Cycling_T", group.by = "state", test.use = "MAST", ident.1 = "PSC-I", ident.2 = "HC-NI")
Disease3_Cycling_T <- filter(Disease3_Cycling_T, Disease3_Cycling_T$p_val_adj < 0.05)
Disease3_Cycling_T$cluster = ifelse(Disease3_Cycling_T$avg_logFC > 0,"PSC-I","HC-NI")
Disease3_Cycling_T$gene = rownames(Disease3_Cycling_T)
PSC_Iup_Cycling_T = filter(Disease3_Cycling_T, Disease3_Cycling_T$cluster == "PSC-I")
HC_NIup_Cycling_T = filter(Disease3_Cycling_T, Disease3_Cycling_T$cluster == "HC-NI")
write.csv(PSC_Iup_Cycling_T, "Results/DE/PSCIupvsHCNI_Cycling_T.csv")
write.csv(HC_NIup_Cycling_T, "Results/DE/HC_NIupvsPSCI_Cycling_T.csv")

Disease4_Cycling_T <- FindMarkers(data, subset.ident = "Cycling_T", group.by = "state", test.use = "MAST", ident.1 = "UC-I", ident.2 = "HC-NI")
Disease4_Cycling_T <- filter(Disease4_Cycling_T, Disease4_Cycling_T$p_val_adj < 0.05)
Disease4_Cycling_T$cluster = ifelse(Disease4_Cycling_T$avg_logFC > 0,"UC-I","HC-NI")
Disease4_Cycling_T$gene = rownames(Disease4_Cycling_T)
UC_Iup_Cycling_T = filter(Disease4_Cycling_T, Disease4_Cycling_T$cluster == "UC-I")
HC_NIup_Cycling_T = filter(Disease4_Cycling_T, Disease4_Cycling_T$cluster == "HC-NI")
write.csv(UC_Iup_Cycling_T, "Results/DE/UCIupvsHCNI_Cycling_T.csv")
write.csv(HC_NIup_Cycling_T, "Results/DE/HC_NIupvsUCI_Cycling_T.csv")




#########

Inflammation_Mature_B <- FindMarkers(data, subset.ident = "Mature_B", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_Mature_B <- filter(Inflammation_Mature_B, Inflammation_Mature_B$p_val_adj < 0.05)
Inflammation_Mature_B$cluster = ifelse(Inflammation_Mature_B$avg_logFC > 0,"I","NI")
Inflammation_Mature_B$gene = rownames(Inflammation_Mature_B)
Iup_Mature_B = filter(Inflammation_Mature_B, Inflammation_Mature_B$cluster == "I")
NIup_Mature_B = filter(Inflammation_Mature_B, Inflammation_Mature_B$cluster == "NI")
write.csv(Iup_Mature_B, "Results/DE/Iup_Mature_B.csv")
write.csv(NIup_Mature_B, "Results/DE/NIup_Mature_B.csv")

#IBD_vs_HC
Disease_Mature_B <- FindMarkers(data, subset.ident = "Mature_B", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_Mature_B <- filter(Disease_Mature_B, Disease_Mature_B$p_val_adj < 0.05)
Disease_Mature_B$cluster = ifelse(Disease_Mature_B$avg_logFC > 0,"IBD","HC")
Disease_Mature_B$gene = rownames(Disease_Mature_B)
IBDup_Mature_B = filter(Disease_Mature_B, Disease_Mature_B$cluster == "IBD")
HCup_Mature_B = filter(Disease_Mature_B, Disease_Mature_B$cluster == "HC")
write.csv(IBDup_Mature_B, "Results/DE/IBDup_Mature_B.csv")
write.csv(HCup_Mature_B, "Results/DE/HCup_Mature_B.csv")

## PSC vs non PSC

PSC_Mature_B <- FindMarkers(data, subset.ident = "Mature_B", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "HC"), ident.2 = "PSC")
PSC_Mature_B <- filter(PSC_Mature_B, PSC_Mature_B$p_val_adj < 0.05)
PSC_Mature_B$cluster = ifelse(PSC_Mature_B$avg_logFC > 0,"non-PSC","PSC")
PSC_Mature_B$gene = rownames(PSC_Mature_B)
nonPSCup_Mature_B = filter(PSC_Mature_B, PSC_Mature_B$cluster == "non-PSC")
PSCup_Mature_B = filter(PSC_Mature_B, PSC_Mature_B$cluster == "PSC")
write.csv(nonPSCup_Mature_B, "Results/DE/nonPSCup_Mature_B.csv")
write.csv(PSCup_Mature_B, "Results/DE/PSCup_Mature_B.csv")

## paired_PSC
PSCINI_Mature_B <- FindMarkers(data_PSC, subset.ident = "Mature_B", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Mature_B <- filter(PSCINI_Mature_B, PSCINI_Mature_B$p_val_adj < 0.05)
PSCINI_Mature_B$cluster = ifelse(PSCINI_Mature_B$avg_logFC > 0,"I","NI")
PSCINI_Mature_B$gene = rownames(PSCINI_Mature_B)
PSCIup_Mature_B = filter(PSCINI_Mature_B, PSCINI_Mature_B$cluster == "I")
PSCNIup_Mature_B = filter(PSCINI_Mature_B, PSCINI_Mature_B$cluster == "NI")
write.csv(PSCIup_Mature_B, "Results/DE/PSCIup_Mature_B.csv")
write.csv(PSCNIup_Mature_B, "Results/DE/PSCNIup_Mature_B.csv")
GO_PSCIup_Mature_B=enrichr(PSCIup_Mature_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Mature_B <- filter(GO_PSCIup_Mature_B, GO_PSCIup_Mature_B$Adjusted.P.value< 0.05)
GO_PSCNIup_Mature_B=enrichr(PSCNIup_Mature_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Mature_B <- filter(GO_PSCNIup_Mature_B, GO_PSCNIup_Mature_B$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Mature_B, "Results/DE/GO_PSCNIup_Mature_B.csv")
write.csv(GO_PSCIup_Mature_B, "Results/DE/GO_PSCIup_Mature_B.csv")

#UCI_NI
UCINI_Mature_B <- FindMarkers(data_UC, subset.ident = "Mature_B", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Mature_B <- filter(UCINI_Mature_B, UCINI_Mature_B$p_val_adj < 0.05)
UCINI_Mature_B$cluster = ifelse(UCINI_Mature_B$avg_logFC > 0,"I","NI")
UCINI_Mature_B$gene = rownames(UCINI_Mature_B)
UCIup_Mature_B = filter(UCINI_Mature_B, UCINI_Mature_B$cluster == "I")
UCNIup_Mature_B = filter(UCINI_Mature_B, UCINI_Mature_B$cluster == "NI")
write.csv(UCIup_Mature_B, "Results/DE/UCIup_Mature_B.csv")
write.csv(UCNIup_Mature_B, "Results/DE/UCNIup_Mature_B.csv")
GO_UCIup_Mature_B=enrichr(UCIup_Mature_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Mature_B <- filter(GO_UCIup_Mature_B, GO_UCIup_Mature_B$Adjusted.P.value< 0.05)
GO_UCNIup_Mature_B=enrichr(UCNIup_Mature_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Mature_B <- filter(GO_UCNIup_Mature_B, GO_UCNIup_Mature_B$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Mature_B, "Results/DE/GO_UCNIup_Mature_B.csv")
write.csv(GO_UCIup_Mature_B, "Results/DE/GO_UCIup_Mature_B.csv")

#
Disease2_Mature_B <- FindMarkers(data, subset.ident = "Mature_B", group.by = "state", test.use = "MAST", ident.1 = "UC-NI", ident.2 = "HC-NI")
Disease2_Mature_B <- filter(Disease2_Mature_B, Disease2_Mature_B$p_val_adj < 0.05)
Disease2_Mature_B$cluster = ifelse(Disease2_Mature_B$avg_logFC > 0,"UC-NI","HC-NI")
Disease2_Mature_B$gene = rownames(Disease2_Mature_B)
UC_NIup_Mature_B = filter(Disease2_Mature_B, Disease2_Mature_B$cluster == "UC-NI")
HC_NIup_Mature_B = filter(Disease2_Mature_B, Disease2_Mature_B$cluster == "HC-NI")
write.csv(UC_NIup_Mature_B, "Results/DE/UCNIupvsHCNI_Mature_B.csv")
write.csv(HC_NIup_Mature_B, "Results/DE/HC_NIupvsUCNI_Mature_B.csv")

Disease1_Mature_B <- FindMarkers(data, subset.ident = "Mature_B", group.by = "state", test.use = "MAST", ident.1 = "PSC-NI", ident.2 = "HC-NI")
Disease1_Mature_B <- filter(Disease1_Mature_B, Disease1_Mature_B$p_val_adj < 0.05)
Disease1_Mature_B$cluster = ifelse(Disease1_Mature_B$avg_logFC > 0,"PSC-NI","HC-NI")
Disease1_Mature_B$gene = rownames(Disease1_Mature_B)
PSC_NIup_Mature_B = filter(Disease1_Mature_B, Disease1_Mature_B$cluster == "PSC-NI")
HC_NIup_Mature_B = filter(Disease1_Mature_B, Disease1_Mature_B$cluster == "HC-NI")
write.csv(PSC_NIup_Mature_B, "Results/DE/PSCNIupvsHCNI_Mature_B.csv")
write.csv(HC_NIup_Mature_B, "Results/DE/HC_NIupvsPSCNI_Mature_B.csv")

Disease3_Mature_B <- FindMarkers(data, subset.ident = "Mature_B", group.by = "state", test.use = "MAST", ident.1 = "PSC-I", ident.2 = "HC-NI")
Disease3_Mature_B <- filter(Disease3_Mature_B, Disease3_Mature_B$p_val_adj < 0.05)
Disease3_Mature_B$cluster = ifelse(Disease3_Mature_B$avg_logFC > 0,"PSC-I","HC-NI")
Disease3_Mature_B$gene = rownames(Disease3_Mature_B)
PSC_Iup_Mature_B = filter(Disease3_Mature_B, Disease3_Mature_B$cluster == "PSC-I")
HC_NIup_Mature_B = filter(Disease3_Mature_B, Disease3_Mature_B$cluster == "HC-NI")
write.csv(PSC_Iup_Mature_B, "Results/DE/PSCIupvsHCNI_Mature_B.csv")
write.csv(HC_NIup_Mature_B, "Results/DE/HC_NIupvsPSCI_Mature_B.csv")

Disease4_Mature_B <- FindMarkers(data, subset.ident = "Mature_B", group.by = "state", test.use = "MAST", ident.1 = "UC-I", ident.2 = "HC-NI")
Disease4_Mature_B <- filter(Disease4_Mature_B, Disease4_Mature_B$p_val_adj < 0.05)
Disease4_Mature_B$cluster = ifelse(Disease4_Mature_B$avg_logFC > 0,"UC-I","HC-NI")
Disease4_Mature_B$gene = rownames(Disease4_Mature_B)
UC_Iup_Mature_B = filter(Disease4_Mature_B, Disease4_Mature_B$cluster == "UC-I")
HC_NIup_Mature_B = filter(Disease4_Mature_B, Disease4_Mature_B$cluster == "HC-NI")
write.csv(UC_Iup_Mature_B, "Results/DE/UCIupvsHCNI_Mature_B.csv")
write.csv(HC_NIup_Mature_B, "Results/DE/HC_NIupvsUCI_Mature_B.csv")



##########
Inflammation_Cycling_B <- FindMarkers(data, subset.ident = "Cycling_B", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_Cycling_B <- filter(Inflammation_Cycling_B, Inflammation_Cycling_B$p_val_adj < 0.05)
Inflammation_Cycling_B$cluster = ifelse(Inflammation_Cycling_B$avg_logFC > 0,"I","NI")
Inflammation_Cycling_B$gene = rownames(Inflammation_Cycling_B)
Iup_Cycling_B = filter(Inflammation_Cycling_B, Inflammation_Cycling_B$cluster == "I")
NIup_Cycling_B = filter(Inflammation_Cycling_B, Inflammation_Cycling_B$cluster == "NI")
write.csv(Iup_Cycling_B, "Results/DE/Iup_Cycling_B.csv")
write.csv(NIup_Cycling_B, "Results/DE/NIup_Cycling_B.csv")

#IBD_vs_HC
Disease_Cycling_B <- FindMarkers(data, subset.ident = "Cycling_B", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_Cycling_B <- filter(Disease_Cycling_B, Disease_Cycling_B$p_val_adj < 0.05)
Disease_Cycling_B$cluster = ifelse(Disease_Cycling_B$avg_logFC > 0,"IBD","HC")
Disease_Cycling_B$gene = rownames(Disease_Cycling_B)
IBDup_Cycling_B = filter(Disease_Cycling_B, Disease_Cycling_B$cluster == "IBD")
HCup_Cycling_B = filter(Disease_Cycling_B, Disease_Cycling_B$cluster == "HC")
write.csv(IBDup_Cycling_B, "Results/DE/IBDup_Cycling_B.csv")
write.csv(HCup_Cycling_B, "Results/DE/HCup_Cycling_B.csv")

## PSC vs non PSC

PSC_Cycling_B <- FindMarkers(data, subset.ident = "Cycling_B", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "HC"), ident.2 = "PSC")
PSC_Cycling_B <- filter(PSC_Cycling_B, PSC_Cycling_B$p_val_adj < 0.05)
PSC_Cycling_B$cluster = ifelse(PSC_Cycling_B$avg_logFC > 0,"non-PSC","PSC")
PSC_Cycling_B$gene = rownames(PSC_Cycling_B)
nonPSCup_Cycling_B = filter(PSC_Cycling_B, PSC_Cycling_B$cluster == "non-PSC")
PSCup_Cycling_B = filter(PSC_Cycling_B, PSC_Cycling_B$cluster == "PSC")
write.csv(nonPSCup_Cycling_B, "Results/DE/nonPSCup_Cycling_B.csv")
write.csv(PSCup_Cycling_B, "Results/DE/PSCup_Cycling_B.csv")

## paired_PSC
PSCINI_Cycling_B <- FindMarkers(data_PSC, subset.ident = "Cycling_B", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Cycling_B <- filter(PSCINI_Cycling_B, PSCINI_Cycling_B$p_val_adj < 0.05)
PSCINI_Cycling_B$cluster = ifelse(PSCINI_Cycling_B$avg_logFC > 0,"I","NI")
PSCINI_Cycling_B$gene = rownames(PSCINI_Cycling_B)
PSCIup_Cycling_B = filter(PSCINI_Cycling_B, PSCINI_Cycling_B$cluster == "I")
PSCNIup_Cycling_B = filter(PSCINI_Cycling_B, PSCINI_Cycling_B$cluster == "NI")
write.csv(PSCIup_Cycling_B, "Results/DE/PSCIup_Cycling_B.csv")
write.csv(PSCNIup_Cycling_B, "Results/DE/PSCNIup_Cycling_B.csv")
GO_PSCIup_Cycling_B=enrichr(PSCIup_Cycling_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Cycling_B <- filter(GO_PSCIup_Cycling_B, GO_PSCIup_Cycling_B$Adjusted.P.value< 0.05)
GO_PSCNIup_Cycling_B=enrichr(PSCNIup_Cycling_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Cycling_B <- filter(GO_PSCNIup_Cycling_B, GO_PSCNIup_Cycling_B$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Cycling_B, "Results/DE/GO_PSCNIup_Cycling_B.csv")
write.csv(GO_PSCIup_Cycling_B, "Results/DE/GO_PSCIup_Cycling_B.csv")

#UCI_NI
UCINI_Cycling_B <- FindMarkers(data_UC, subset.ident = "Cycling_B", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Cycling_B <- filter(UCINI_Cycling_B, UCINI_Cycling_B$p_val_adj < 0.05)
UCINI_Cycling_B$cluster = ifelse(UCINI_Cycling_B$avg_logFC > 0,"I","NI")
UCINI_Cycling_B$gene = rownames(UCINI_Cycling_B)
UCIup_Cycling_B = filter(UCINI_Cycling_B, UCINI_Cycling_B$cluster == "I")
UCNIup_Cycling_B = filter(UCINI_Cycling_B, UCINI_Cycling_B$cluster == "NI")
write.csv(UCIup_Cycling_B, "Results/DE/UCIup_Cycling_B.csv")
write.csv(UCNIup_Cycling_B, "Results/DE/UCNIup_Cycling_B.csv")
GO_UCIup_Cycling_B=enrichr(UCIup_Cycling_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Cycling_B <- filter(GO_UCIup_Cycling_B, GO_UCIup_Cycling_B$Adjusted.P.value< 0.05)
GO_UCNIup_Cycling_B=enrichr(UCNIup_Cycling_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Cycling_B <- filter(GO_UCNIup_Cycling_B, GO_UCNIup_Cycling_B$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Cycling_B, "Results/DE/GO_UCNIup_Cycling_B.csv")
write.csv(GO_UCIup_Cycling_B, "Results/DE/GO_UCIup_Cycling_B.csv")

#
Disease2_Cycling_B <- FindMarkers(data, subset.ident = "Cycling_B", group.by = "state", test.use = "MAST", ident.1 = "UC-NI", ident.2 = "HC-NI")
Disease2_Cycling_B <- filter(Disease2_Cycling_B, Disease2_Cycling_B$p_val_adj < 0.05)
Disease2_Cycling_B$cluster = ifelse(Disease2_Cycling_B$avg_logFC > 0,"UC-NI","HC-NI")
Disease2_Cycling_B$gene = rownames(Disease2_Cycling_B)
UC_NIup_Cycling_B = filter(Disease2_Cycling_B, Disease2_Cycling_B$cluster == "UC-NI")
HC_NIup_Cycling_B = filter(Disease2_Cycling_B, Disease2_Cycling_B$cluster == "HC-NI")
write.csv(UC_NIup_Cycling_B, "Results/DE/UCNIupvsHCNI_Cycling_B.csv")
write.csv(HC_NIup_Cycling_B, "Results/DE/HC_NIupvsUCNI_Cycling_B.csv")

Disease1_Cycling_B <- FindMarkers(data, subset.ident = "Cycling_B", group.by = "state", test.use = "MAST", ident.1 = "PSC-NI", ident.2 = "HC-NI")
Disease1_Cycling_B <- filter(Disease1_Cycling_B, Disease1_Cycling_B$p_val_adj < 0.05)
Disease1_Cycling_B$cluster = ifelse(Disease1_Cycling_B$avg_logFC > 0,"PSC-NI","HC-NI")
Disease1_Cycling_B$gene = rownames(Disease1_Cycling_B)
PSC_NIup_Cycling_B = filter(Disease1_Cycling_B, Disease1_Cycling_B$cluster == "PSC-NI")
HC_NIup_Cycling_B = filter(Disease1_Cycling_B, Disease1_Cycling_B$cluster == "HC-NI")
write.csv(PSC_NIup_Cycling_B, "Results/DE/PSCNIupvsHCNI_Cycling_B.csv")
write.csv(HC_NIup_Cycling_B, "Results/DE/HC_NIupvsPSCNI_Cycling_B.csv")

Disease3_Cycling_B <- FindMarkers(data, subset.ident = "Cycling_B", group.by = "state", test.use = "MAST", ident.1 = "PSC-I", ident.2 = "HC-NI")
Disease3_Cycling_B <- filter(Disease3_Cycling_B, Disease3_Cycling_B$p_val_adj < 0.05)
Disease3_Cycling_B$cluster = ifelse(Disease3_Cycling_B$avg_logFC > 0,"PSC-I","HC-NI")
Disease3_Cycling_B$gene = rownames(Disease3_Cycling_B)
PSC_Iup_Cycling_B = filter(Disease3_Cycling_B, Disease3_Cycling_B$cluster == "PSC-I")
HC_NIup_Cycling_B = filter(Disease3_Cycling_B, Disease3_Cycling_B$cluster == "HC-NI")
write.csv(PSC_Iup_Cycling_B, "Results/DE/PSCIupvsHCNI_Cycling_B.csv")
write.csv(HC_NIup_Cycling_B, "Results/DE/HC_NIupvsPSCI_Cycling_B.csv")

Disease4_Cycling_B <- FindMarkers(data, subset.ident = "Cycling_B", group.by = "state", test.use = "MAST", ident.1 = "UC-I", ident.2 = "HC-NI")
Disease4_Cycling_B <- filter(Disease4_Cycling_B, Disease4_Cycling_B$p_val_adj < 0.05)
Disease4_Cycling_B$cluster = ifelse(Disease4_Cycling_B$avg_logFC > 0,"UC-I","HC-NI")
Disease4_Cycling_B$gene = rownames(Disease4_Cycling_B)
UC_Iup_Cycling_B = filter(Disease4_Cycling_B, Disease4_Cycling_B$cluster == "UC-I")
HC_NIup_Cycling_B = filter(Disease4_Cycling_B, Disease4_Cycling_B$cluster == "HC-NI")
write.csv(UC_Iup_Cycling_B, "Results/DE/UCIupvsHCNI_Cycling_B.csv")
write.csv(HC_NIup_Cycling_B, "Results/DE/HC_NIupvsUCI_Cycling_B.csv")

########

Inflammation_DC <- FindMarkers(data, subset.ident = "DC", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_DC <- filter(Inflammation_DC, Inflammation_DC$p_val_adj < 0.05)
Inflammation_DC$cluster = ifelse(Inflammation_DC$avg_logFC > 0,"I","NI")
Inflammation_DC$gene = rownames(Inflammation_DC)
Iup_DC = filter(Inflammation_DC, Inflammation_DC$cluster == "I")
NIup_DC = filter(Inflammation_DC, Inflammation_DC$cluster == "NI")
write.csv(Iup_DC, "Results/DE/Iup_DC.csv")
write.csv(NIup_DC, "Results/DE/NIup_DC.csv")

#IBD_vs_HC
Disease_DC <- FindMarkers(data, subset.ident = "DC", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_DC <- filter(Disease_DC, Disease_DC$p_val_adj < 0.05)
Disease_DC$cluster = ifelse(Disease_DC$avg_logFC > 0,"IBD","HC")
Disease_DC$gene = rownames(Disease_DC)
IBDup_DC = filter(Disease_DC, Disease_DC$cluster == "IBD")
HCup_DC = filter(Disease_DC, Disease_DC$cluster == "HC")
write.csv(IBDup_DC, "Results/DE/IBDup_DC.csv")
write.csv(HCup_DC, "Results/DE/HCup_DC.csv")

## PSC vs non PSC

PSC_DC <- FindMarkers(data, subset.ident = "DC", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "HC"), ident.2 = "PSC")
PSC_DC <- filter(PSC_DC, PSC_DC$p_val_adj < 0.05)
PSC_DC$cluster = ifelse(PSC_DC$avg_logFC > 0,"non-PSC","PSC")
PSC_DC$gene = rownames(PSC_DC)
nonPSCup_DC = filter(PSC_DC, PSC_DC$cluster == "non-PSC")
PSCup_DC = filter(PSC_DC, PSC_DC$cluster == "PSC")
write.csv(nonPSCup_DC, "Results/DE/nonPSCup_DC.csv")
write.csv(PSCup_DC, "Results/DE/PSCup_DC.csv")

## paired_PSC
PSCINI_DC <- FindMarkers(data_PSC, subset.ident = "DC", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_DC <- filter(PSCINI_DC, PSCINI_DC$p_val_adj < 0.05)
PSCINI_DC$cluster = ifelse(PSCINI_DC$avg_logFC > 0,"I","NI")
PSCINI_DC$gene = rownames(PSCINI_DC)
PSCIup_DC = filter(PSCINI_DC, PSCINI_DC$cluster == "I")
PSCNIup_DC = filter(PSCINI_DC, PSCINI_DC$cluster == "NI")
write.csv(PSCIup_DC, "Results/DE/PSCIup_DC.csv")
write.csv(PSCNIup_DC, "Results/DE/PSCNIup_DC.csv")
GO_PSCIup_DC=enrichr(PSCIup_DC$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_DC <- filter(GO_PSCIup_DC, GO_PSCIup_DC$Adjusted.P.value< 0.05)
GO_PSCNIup_DC=enrichr(PSCNIup_DC$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_DC <- filter(GO_PSCNIup_DC, GO_PSCNIup_DC$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_DC, "Results/DE/GO_PSCNIup_DC.csv")
write.csv(GO_PSCIup_DC, "Results/DE/GO_PSCIup_DC.csv")

#UCI_NI
UCINI_DC <- FindMarkers(data_UC, subset.ident = "DC", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_DC <- filter(UCINI_DC, UCINI_DC$p_val_adj < 0.05)
UCINI_DC$cluster = ifelse(UCINI_DC$avg_logFC > 0,"I","NI")
UCINI_DC$gene = rownames(UCINI_DC)
UCIup_DC = filter(UCINI_DC, UCINI_DC$cluster == "I")
UCNIup_DC = filter(UCINI_DC, UCINI_DC$cluster == "NI")
write.csv(UCIup_DC, "Results/DE/UCIup_DC.csv")
write.csv(UCNIup_DC, "Results/DE/UCNIup_DC.csv")
GO_UCIup_DC=enrichr(UCIup_DC$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_DC <- filter(GO_UCIup_DC, GO_UCIup_DC$Adjusted.P.value< 0.05)
GO_UCNIup_DC=enrichr(UCNIup_DC$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_DC <- filter(GO_UCNIup_DC, GO_UCNIup_DC$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_DC, "Results/DE/GO_UCNIup_DC.csv")
write.csv(GO_UCIup_DC, "Results/DE/GO_UCIup_DC.csv")

#
Disease2_DC <- FindMarkers(data, subset.ident = "DC", group.by = "state", test.use = "MAST", ident.1 = "UC-NI", ident.2 = "HC-NI")
Disease2_DC <- filter(Disease2_DC, Disease2_DC$p_val_adj < 0.05)
Disease2_DC$cluster = ifelse(Disease2_DC$avg_logFC > 0,"UC-NI","HC-NI")
Disease2_DC$gene = rownames(Disease2_DC)
UC_NIup_DC = filter(Disease2_DC, Disease2_DC$cluster == "UC-NI")
HC_NIup_DC = filter(Disease2_DC, Disease2_DC$cluster == "HC-NI")
write.csv(UC_NIup_DC, "Results/DE/UCNIupvsHCNI_DC.csv")
write.csv(HC_NIup_DC, "Results/DE/HC_NIupvsUCNI_DC.csv")

Disease1_DC <- FindMarkers(data, subset.ident = "DC", group.by = "state", test.use = "MAST", ident.1 = "PSC-NI", ident.2 = "HC-NI")
Disease1_DC <- filter(Disease1_DC, Disease1_DC$p_val_adj < 0.05)
Disease1_DC$cluster = ifelse(Disease1_DC$avg_logFC > 0,"PSC-NI","HC-NI")
Disease1_DC$gene = rownames(Disease1_DC)
PSC_NIup_DC = filter(Disease1_DC, Disease1_DC$cluster == "PSC-NI")
HC_NIup_DC = filter(Disease1_DC, Disease1_DC$cluster == "HC-NI")
write.csv(PSC_NIup_DC, "Results/DE/PSCNIupvsHCNI_DC.csv")
write.csv(HC_NIup_DC, "Results/DE/HC_NIupvsPSCNI_DC.csv")

Disease3_DC <- FindMarkers(data, subset.ident = "DC", group.by = "state", test.use = "MAST", ident.1 = "PSC-I", ident.2 = "HC-NI")
Disease3_DC <- filter(Disease3_DC, Disease3_DC$p_val_adj < 0.05)
Disease3_DC$cluster = ifelse(Disease3_DC$avg_logFC > 0,"PSC-I","HC-NI")
Disease3_DC$gene = rownames(Disease3_DC)
PSC_Iup_DC = filter(Disease3_DC, Disease3_DC$cluster == "PSC-I")
HC_NIup_DC = filter(Disease3_DC, Disease3_DC$cluster == "HC-NI")
write.csv(PSC_Iup_DC, "Results/DE/PSCIupvsHCNI_DC.csv")
write.csv(HC_NIup_DC, "Results/DE/HC_NIupvsPSCI_DC.csv")

Disease4_DC <- FindMarkers(data, subset.ident = "DC", group.by = "state", test.use = "MAST", ident.1 = "UC-I", ident.2 = "HC-NI")
Disease4_DC <- filter(Disease4_DC, Disease4_DC$p_val_adj < 0.05)
Disease4_DC$cluster = ifelse(Disease4_DC$avg_logFC > 0,"UC-I","HC-NI")
Disease4_DC$gene = rownames(Disease4_DC)
UC_Iup_DC = filter(Disease4_DC, Disease4_DC$cluster == "UC-I")
HC_NIup_DC = filter(Disease4_DC, Disease4_DC$cluster == "HC-NI")
write.csv(UC_Iup_DC, "Results/DE/UCIupvsHCNI_DC.csv")
write.csv(HC_NIup_DC, "Results/DE/HC_NIupvsUCI_DC.csv")



########
Inflammation_Mature_B <- FindMarkers(data, subset.ident = "Mature_B", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_Mature_B <- filter(Inflammation_Mature_B, Inflammation_Mature_B$p_val_adj < 0.05)
Inflammation_Mature_B$cluster = ifelse(Inflammation_Mature_B$avg_logFC > 0,"I","NI")
Inflammation_Mature_B$gene = rownames(Inflammation_Mature_B)
Iup_Mature_B = filter(Inflammation_Mature_B, Inflammation_Mature_B$cluster == "I")
NIup_Mature_B = filter(Inflammation_Mature_B, Inflammation_Mature_B$cluster == "NI")
write.csv(Iup_Mature_B, "Results/DE/Iup_Mature_B.csv")
write.csv(NIup_Mature_B, "Results/DE/NIup_Mature_B.csv")

#IBD_vs_HC
Disease_Mature_B <- FindMarkers(data, subset.ident = "Mature_B", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_Mature_B <- filter(Disease_Mature_B, Disease_Mature_B$p_val_adj < 0.05)
Disease_Mature_B$cluster = ifelse(Disease_Mature_B$avg_logFC > 0,"IBD","HC")
Disease_Mature_B$gene = rownames(Disease_Mature_B)
IBDup_Mature_B = filter(Disease_Mature_B, Disease_Mature_B$cluster == "IBD")
HCup_Mature_B = filter(Disease_Mature_B, Disease_Mature_B$cluster == "HC")
write.csv(IBDup_Mature_B, "Results/DE/IBDup_Mature_B.csv")
write.csv(HCup_Mature_B, "Results/DE/HCup_Mature_B.csv")

## PSC vs non PSC

PSC_Mature_B <- FindMarkers(data, subset.ident = "Mature_B", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "HC"), ident.2 = "PSC")
PSC_Mature_B <- filter(PSC_Mature_B, PSC_Mature_B$p_val_adj < 0.05)
PSC_Mature_B$cluster = ifelse(PSC_Mature_B$avg_logFC > 0,"non-PSC","PSC")
PSC_Mature_B$gene = rownames(PSC_Mature_B)
nonPSCup_Mature_B = filter(PSC_Mature_B, PSC_Mature_B$cluster == "non-PSC")
PSCup_Mature_B = filter(PSC_Mature_B, PSC_Mature_B$cluster == "PSC")
write.csv(nonPSCup_Mature_B, "Results/DE/nonPSCup_Mature_B.csv")
write.csv(PSCup_Mature_B, "Results/DE/PSCup_Mature_B.csv")

## paired_PSC
PSCINI_Mature_B <- FindMarkers(data_PSC, subset.ident = "Mature_B", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Mature_B <- filter(PSCINI_Mature_B, PSCINI_Mature_B$p_val_adj < 0.05)
PSCINI_Mature_B$cluster = ifelse(PSCINI_Mature_B$avg_logFC > 0,"I","NI")
PSCINI_Mature_B$gene = rownames(PSCINI_Mature_B)
PSCIup_Mature_B = filter(PSCINI_Mature_B, PSCINI_Mature_B$cluster == "I")
PSCNIup_Mature_B = filter(PSCINI_Mature_B, PSCINI_Mature_B$cluster == "NI")
write.csv(PSCIup_Mature_B, "Results/DE/PSCIup_Mature_B.csv")
write.csv(PSCNIup_Mature_B, "Results/DE/PSCNIup_Mature_B.csv")
GO_PSCIup_Mature_B=enrichr(PSCIup_Mature_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Mature_B <- filter(GO_PSCIup_Mature_B, GO_PSCIup_Mature_B$Adjusted.P.value< 0.05)
GO_PSCNIup_Mature_B=enrichr(PSCNIup_Mature_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Mature_B <- filter(GO_PSCNIup_Mature_B, GO_PSCNIup_Mature_B$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Mature_B, "Results/DE/GO_PSCNIup_Mature_B.csv")
write.csv(GO_PSCIup_Mature_B, "Results/DE/GO_PSCIup_Mature_B.csv")

#UCI_NI
UCINI_Mature_B <- FindMarkers(data_UC, subset.ident = "Mature_B", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Mature_B <- filter(UCINI_Mature_B, UCINI_Mature_B$p_val_adj < 0.05)
UCINI_Mature_B$cluster = ifelse(UCINI_Mature_B$avg_logFC > 0,"I","NI")
UCINI_Mature_B$gene = rownames(UCINI_Mature_B)
UCIup_Mature_B = filter(UCINI_Mature_B, UCINI_Mature_B$cluster == "I")
UCNIup_Mature_B = filter(UCINI_Mature_B, UCINI_Mature_B$cluster == "NI")
write.csv(UCIup_Mature_B, "Results/DE/UCIup_Mature_B.csv")
write.csv(UCNIup_Mature_B, "Results/DE/UCNIup_Mature_B.csv")
GO_UCIup_Mature_B=enrichr(UCIup_Mature_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Mature_B <- filter(GO_UCIup_Mature_B, GO_UCIup_Mature_B$Adjusted.P.value< 0.05)
GO_UCNIup_Mature_B=enrichr(UCNIup_Mature_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Mature_B <- filter(GO_UCNIup_Mature_B, GO_UCNIup_Mature_B$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Mature_B, "Results/DE/GO_UCNIup_Mature_B.csv")
write.csv(GO_UCIup_Mature_B, "Results/DE/GO_UCIup_Mature_B.csv")

#
Disease2_Mature_B <- FindMarkers(data, subset.ident = "Mature_B", group.by = "state", test.use = "MAST", ident.1 = "UC-NI", ident.2 = "HC-NI")
Disease2_Mature_B <- filter(Disease2_Mature_B, Disease2_Mature_B$p_val_adj < 0.05)
Disease2_Mature_B$cluster = ifelse(Disease2_Mature_B$avg_logFC > 0,"UC-NI","HC-NI")
Disease2_Mature_B$gene = rownames(Disease2_Mature_B)
UC_NIup_Mature_B = filter(Disease2_Mature_B, Disease2_Mature_B$cluster == "UC-NI")
HC_NIup_Mature_B = filter(Disease2_Mature_B, Disease2_Mature_B$cluster == "HC-NI")
write.csv(UC_NIup_Mature_B, "Results/DE/UCNIupvsHCNI_Mature_B.csv")
write.csv(HC_NIup_Mature_B, "Results/DE/HC_NIupvsUCNI_Mature_B.csv")

Disease1_Mature_B <- FindMarkers(data, subset.ident = "Mature_B", group.by = "state", test.use = "MAST", ident.1 = "PSC-NI", ident.2 = "HC-NI")
Disease1_Mature_B <- filter(Disease1_Mature_B, Disease1_Mature_B$p_val_adj < 0.05)
Disease1_Mature_B$cluster = ifelse(Disease1_Mature_B$avg_logFC > 0,"PSC-NI","HC-NI")
Disease1_Mature_B$gene = rownames(Disease1_Mature_B)
PSC_NIup_Mature_B = filter(Disease1_Mature_B, Disease1_Mature_B$cluster == "PSC-NI")
HC_NIup_Mature_B = filter(Disease1_Mature_B, Disease1_Mature_B$cluster == "HC-NI")
write.csv(PSC_NIup_Mature_B, "Results/DE/PSCNIupvsHCNI_Mature_B.csv")
write.csv(HC_NIup_Mature_B, "Results/DE/HC_NIupvsPSCNI_Mature_B.csv")

Disease3_Mature_B <- FindMarkers(data, subset.ident = "Mature_B", group.by = "state", test.use = "MAST", ident.1 = "PSC-I", ident.2 = "HC-NI")
Disease3_Mature_B <- filter(Disease3_Mature_B, Disease3_Mature_B$p_val_adj < 0.05)
Disease3_Mature_B$cluster = ifelse(Disease3_Mature_B$avg_logFC > 0,"PSC-I","HC-NI")
Disease3_Mature_B$gene = rownames(Disease3_Mature_B)
PSC_Iup_Mature_B = filter(Disease3_Mature_B, Disease3_Mature_B$cluster == "PSC-I")
HC_NIup_Mature_B = filter(Disease3_Mature_B, Disease3_Mature_B$cluster == "HC-NI")
write.csv(PSC_Iup_Mature_B, "Results/DE/PSCIupvsHCNI_Mature_B.csv")
write.csv(HC_NIup_Mature_B, "Results/DE/HC_NIupvsPSCI_Mature_B.csv")

Disease4_Mature_B <- FindMarkers(data, subset.ident = "Mature_B", group.by = "state", test.use = "MAST", ident.1 = "UC-I", ident.2 = "HC-NI")
Disease4_Mature_B <- filter(Disease4_Mature_B, Disease4_Mature_B$p_val_adj < 0.05)
Disease4_Mature_B$cluster = ifelse(Disease4_Mature_B$avg_logFC > 0,"UC-I","HC-NI")
Disease4_Mature_B$gene = rownames(Disease4_Mature_B)
UC_Iup_Mature_B = filter(Disease4_Mature_B, Disease4_Mature_B$cluster == "UC-I")
HC_NIup_Mature_B = filter(Disease4_Mature_B, Disease4_Mature_B$cluster == "HC-NI")
write.csv(UC_Iup_Mature_B, "Results/DE/UCIupvsHCNI_Mature_B.csv")
write.csv(HC_NIup_Mature_B, "Results/DE/HC_NIupvsUCI_Mature_B.csv")

###########
########
Inflammation_Inflammatory_monocyte <- FindMarkers(data, subset.ident = "Inflammatory_monocyte", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_Inflammatory_monocyte <- filter(Inflammation_Inflammatory_monocyte, Inflammation_Inflammatory_monocyte$p_val_adj < 0.05)
Inflammation_Inflammatory_monocyte$cluster = ifelse(Inflammation_Inflammatory_monocyte$avg_logFC > 0,"I","NI")
Inflammation_Inflammatory_monocyte$gene = rownames(Inflammation_Inflammatory_monocyte)
Iup_Inflammatory_monocyte = filter(Inflammation_Inflammatory_monocyte, Inflammation_Inflammatory_monocyte$cluster == "I")
NIup_Inflammatory_monocyte = filter(Inflammation_Inflammatory_monocyte, Inflammation_Inflammatory_monocyte$cluster == "NI")
write.csv(Iup_Inflammatory_monocyte, "Results/DE/Iup_Inflammatory_monocyte.csv")
write.csv(NIup_Inflammatory_monocyte, "Results/DE/NIup_Inflammatory_monocyte.csv")

#IBD_vs_HC
Disease_Inflammatory_monocyte <- FindMarkers(data, subset.ident = "Inflammatory_monocyte", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_Inflammatory_monocyte <- filter(Disease_Inflammatory_monocyte, Disease_Inflammatory_monocyte$p_val_adj < 0.05)
Disease_Inflammatory_monocyte$cluster = ifelse(Disease_Inflammatory_monocyte$avg_logFC > 0,"IBD","HC")
Disease_Inflammatory_monocyte$gene = rownames(Disease_Inflammatory_monocyte)
IBDup_Inflammatory_monocyte = filter(Disease_Inflammatory_monocyte, Disease_Inflammatory_monocyte$cluster == "IBD")
HCup_Inflammatory_monocyte = filter(Disease_Inflammatory_monocyte, Disease_Inflammatory_monocyte$cluster == "HC")
write.csv(IBDup_Inflammatory_monocyte, "Results/DE/IBDup_Inflammatory_monocyte.csv")
write.csv(HCup_Inflammatory_monocyte, "Results/DE/HCup_Inflammatory_monocyte.csv")

## PSC vs non PSC

PSC_Inflammatory_monocyte <- FindMarkers(data, subset.ident = "Inflammatory_monocyte", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "HC"), ident.2 = "PSC")
PSC_Inflammatory_monocyte <- filter(PSC_Inflammatory_monocyte, PSC_Inflammatory_monocyte$p_val_adj < 0.05)
PSC_Inflammatory_monocyte$cluster = ifelse(PSC_Inflammatory_monocyte$avg_logFC > 0,"non-PSC","PSC")
PSC_Inflammatory_monocyte$gene = rownames(PSC_Inflammatory_monocyte)
nonPSCup_Inflammatory_monocyte = filter(PSC_Inflammatory_monocyte, PSC_Inflammatory_monocyte$cluster == "non-PSC")
PSCup_Inflammatory_monocyte = filter(PSC_Inflammatory_monocyte, PSC_Inflammatory_monocyte$cluster == "PSC")
write.csv(nonPSCup_Inflammatory_monocyte, "Results/DE/nonPSCup_Inflammatory_monocyte.csv")
write.csv(PSCup_Inflammatory_monocyte, "Results/DE/PSCup_Inflammatory_monocyte.csv")

## paired_PSC
PSCINI_Inflammatory_monocyte <- FindMarkers(data_PSC, subset.ident = "Inflammatory_monocyte", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Inflammatory_monocyte <- filter(PSCINI_Inflammatory_monocyte, PSCINI_Inflammatory_monocyte$p_val_adj < 0.05)
PSCINI_Inflammatory_monocyte$cluster = ifelse(PSCINI_Inflammatory_monocyte$avg_logFC > 0,"I","NI")
PSCINI_Inflammatory_monocyte$gene = rownames(PSCINI_Inflammatory_monocyte)
PSCIup_Inflammatory_monocyte = filter(PSCINI_Inflammatory_monocyte, PSCINI_Inflammatory_monocyte$cluster == "I")
PSCNIup_Inflammatory_monocyte = filter(PSCINI_Inflammatory_monocyte, PSCINI_Inflammatory_monocyte$cluster == "NI")
write.csv(PSCIup_Inflammatory_monocyte, "Results/DE/PSCIup_Inflammatory_monocyte.csv")
write.csv(PSCNIup_Inflammatory_monocyte, "Results/DE/PSCNIup_Inflammatory_monocyte.csv")
GO_PSCIup_Inflammatory_monocyte=enrichr(PSCIup_Inflammatory_monocyte$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Inflammatory_monocyte <- filter(GO_PSCIup_Inflammatory_monocyte, GO_PSCIup_Inflammatory_monocyte$Adjusted.P.value< 0.05)
GO_PSCNIup_Inflammatory_monocyte=enrichr(PSCNIup_Inflammatory_monocyte$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Inflammatory_monocyte <- filter(GO_PSCNIup_Inflammatory_monocyte, GO_PSCNIup_Inflammatory_monocyte$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Inflammatory_monocyte, "Results/DE/GO_PSCNIup_Inflammatory_monocyte.csv")
write.csv(GO_PSCIup_Inflammatory_monocyte, "Results/DE/GO_PSCIup_Inflammatory_monocyte.csv")

#UCI_NI
UCINI_Inflammatory_monocyte <- FindMarkers(data_UC, subset.ident = "Inflammatory_monocyte", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Inflammatory_monocyte <- filter(UCINI_Inflammatory_monocyte, UCINI_Inflammatory_monocyte$p_val_adj < 0.05)
UCINI_Inflammatory_monocyte$cluster = ifelse(UCINI_Inflammatory_monocyte$avg_logFC > 0,"I","NI")
UCINI_Inflammatory_monocyte$gene = rownames(UCINI_Inflammatory_monocyte)
UCIup_Inflammatory_monocyte = filter(UCINI_Inflammatory_monocyte, UCINI_Inflammatory_monocyte$cluster == "I")
UCNIup_Inflammatory_monocyte = filter(UCINI_Inflammatory_monocyte, UCINI_Inflammatory_monocyte$cluster == "NI")
write.csv(UCIup_Inflammatory_monocyte, "Results/DE/UCIup_Inflammatory_monocyte.csv")
write.csv(UCNIup_Inflammatory_monocyte, "Results/DE/UCNIup_Inflammatory_monocyte.csv")
GO_UCIup_Inflammatory_monocyte=enrichr(UCIup_Inflammatory_monocyte$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Inflammatory_monocyte <- filter(GO_UCIup_Inflammatory_monocyte, GO_UCIup_Inflammatory_monocyte$Adjusted.P.value< 0.05)
GO_UCNIup_Inflammatory_monocyte=enrichr(UCNIup_Inflammatory_monocyte$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Inflammatory_monocyte <- filter(GO_UCNIup_Inflammatory_monocyte, GO_UCNIup_Inflammatory_monocyte$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Inflammatory_monocyte, "Results/DE/GO_UCNIup_Inflammatory_monocyte.csv")
write.csv(GO_UCIup_Inflammatory_monocyte, "Results/DE/GO_UCIup_Inflammatory_monocyte.csv")

#
Disease2_Inflammatory_monocyte <- FindMarkers(data, subset.ident = "Inflammatory_monocyte", group.by = "state", test.use = "MAST", ident.1 = "UC-NI", ident.2 = "HC-NI")
Disease2_Inflammatory_monocyte <- filter(Disease2_Inflammatory_monocyte, Disease2_Inflammatory_monocyte$p_val_adj < 0.05)
Disease2_Inflammatory_monocyte$cluster = ifelse(Disease2_Inflammatory_monocyte$avg_logFC > 0,"UC-NI","HC-NI")
Disease2_Inflammatory_monocyte$gene = rownames(Disease2_Inflammatory_monocyte)
UC_NIup_Inflammatory_monocyte = filter(Disease2_Inflammatory_monocyte, Disease2_Inflammatory_monocyte$cluster == "UC-NI")
HC_NIup_Inflammatory_monocyte = filter(Disease2_Inflammatory_monocyte, Disease2_Inflammatory_monocyte$cluster == "HC-NI")
write.csv(UC_NIup_Inflammatory_monocyte, "Results/DE/UCNIupvsHCNI_Inflammatory_monocyte.csv")
write.csv(HC_NIup_Inflammatory_monocyte, "Results/DE/HC_NIupvsUCNI_Inflammatory_monocyte.csv")

Disease1_Inflammatory_monocyte <- FindMarkers(data, subset.ident = "Inflammatory_monocyte", group.by = "state", test.use = "MAST", ident.1 = "PSC-NI", ident.2 = "HC-NI")
Disease1_Inflammatory_monocyte <- filter(Disease1_Inflammatory_monocyte, Disease1_Inflammatory_monocyte$p_val_adj < 0.05)
Disease1_Inflammatory_monocyte$cluster = ifelse(Disease1_Inflammatory_monocyte$avg_logFC > 0,"PSC-NI","HC-NI")
Disease1_Inflammatory_monocyte$gene = rownames(Disease1_Inflammatory_monocyte)
PSC_NIup_Inflammatory_monocyte = filter(Disease1_Inflammatory_monocyte, Disease1_Inflammatory_monocyte$cluster == "PSC-NI")
HC_NIup_Inflammatory_monocyte = filter(Disease1_Inflammatory_monocyte, Disease1_Inflammatory_monocyte$cluster == "HC-NI")
write.csv(PSC_NIup_Inflammatory_monocyte, "Results/DE/PSCNIupvsHCNI_Inflammatory_monocyte.csv")
write.csv(HC_NIup_Inflammatory_monocyte, "Results/DE/HC_NIupvsPSCNI_Inflammatory_monocyte.csv")

Disease3_Inflammatory_monocyte <- FindMarkers(data, subset.ident = "Inflammatory_monocyte", group.by = "state", test.use = "MAST", ident.1 = "PSC-I", ident.2 = "HC-NI")
Disease3_Inflammatory_monocyte <- filter(Disease3_Inflammatory_monocyte, Disease3_Inflammatory_monocyte$p_val_adj < 0.05)
Disease3_Inflammatory_monocyte$cluster = ifelse(Disease3_Inflammatory_monocyte$avg_logFC > 0,"PSC-I","HC-NI")
Disease3_Inflammatory_monocyte$gene = rownames(Disease3_Inflammatory_monocyte)
PSC_Iup_Inflammatory_monocyte = filter(Disease3_Inflammatory_monocyte, Disease3_Inflammatory_monocyte$cluster == "PSC-I")
HC_NIup_Inflammatory_monocyte = filter(Disease3_Inflammatory_monocyte, Disease3_Inflammatory_monocyte$cluster == "HC-NI")
write.csv(PSC_Iup_Inflammatory_monocyte, "Results/DE/PSCIupvsHCNI_Inflammatory_monocyte.csv")
write.csv(HC_NIup_Inflammatory_monocyte, "Results/DE/HC_NIupvsPSCI_Inflammatory_monocyte.csv")

Disease4_Inflammatory_monocyte <- FindMarkers(data, subset.ident = "Inflammatory_monocyte", group.by = "state", test.use = "MAST", ident.1 = "UC-I", ident.2 = "HC-NI")
Disease4_Inflammatory_monocyte <- filter(Disease4_Inflammatory_monocyte, Disease4_Inflammatory_monocyte$p_val_adj < 0.05)
Disease4_Inflammatory_monocyte$cluster = ifelse(Disease4_Inflammatory_monocyte$avg_logFC > 0,"UC-I","HC-NI")
Disease4_Inflammatory_monocyte$gene = rownames(Disease4_Inflammatory_monocyte)
UC_Iup_Inflammatory_monocyte = filter(Disease4_Inflammatory_monocyte, Disease4_Inflammatory_monocyte$cluster == "UC-I")
HC_NIup_Inflammatory_monocyte = filter(Disease4_Inflammatory_monocyte, Disease4_Inflammatory_monocyte$cluster == "HC-NI")
write.csv(UC_Iup_Inflammatory_monocyte, "Results/DE/UCIupvsHCNI_Inflammatory_monocyte.csv")
write.csv(HC_NIup_Inflammatory_monocyte, "Results/DE/HC_NIupvsUCI_Inflammatory_monocyte.csv")
